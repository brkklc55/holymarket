(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,286879,e=>{"use strict";let t;function i(e){return new Promise((t,i)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>i(e.error)})}function s(e,t){let s=indexedDB.open(e);s.onupgradeneeded=()=>s.result.createObjectStore(t);let r=i(s);return(e,i)=>r.then(s=>i(s.transaction(t,e).objectStore(t)))}function r(){return t||(t=s("keyval-store","keyval")),t}function n(e,t=r()){return t("readonly",t=>i(t.get(e)))}function a(e,t,s=r()){return s("readwrite",s=>(s.put(t,e),i(s.transaction)))}function o(e,t=r()){return t("readwrite",t=>(t.delete(e),i(t.transaction)))}function d(e=r()){return e("readwrite",e=>(e.clear(),i(e.transaction)))}function c(e=r()){return e("readonly",e=>{var t;if(e.getAllKeys)return i(e.getAllKeys());let s=[];return(t=e=>s.push(e.key),e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},i(e.transaction)).then(()=>s)})}e.s(["clear",()=>d,"createStore",()=>s,"del",()=>o,"get",()=>n,"keys",()=>c,"set",()=>a])},787384,e=>{e.v({name:"@base-org/account",version:"2.4.0",description:"Base Account SDK",keywords:["base","account","sdk","web3"],publishConfig:{access:"public"},type:"module",main:"dist/index.js",types:"dist/index.d.ts",browser:"dist/base-account.min.js",exports:{".":{types:"./dist/index.d.ts",browser:{import:"./dist/index.js",require:"./dist/index.js"},node:{import:"./dist/index.node.js",require:"./dist/index.node.js"},default:"./dist/index.js"},"./browser":{types:"./dist/index.d.ts",import:"./dist/index.js",require:"./dist/index.js"},"./node":{types:"./dist/index.node.d.ts",import:"./dist/index.node.js",require:"./dist/index.node.js"},"./payment/browser":{types:"./dist/interface/payment/index.d.ts",import:"./dist/interface/payment/index.js",require:"./dist/interface/payment/index.js"},"./payment/node":{types:"./dist/interface/payment/index.node.d.ts",import:"./dist/interface/payment/index.node.js",require:"./dist/interface/payment/index.node.js"},"./payment":{types:"./dist/interface/payment/index.d.ts",browser:{types:"./dist/interface/payment/index.d.ts",import:"./dist/interface/payment/index.js",require:"./dist/interface/payment/index.js"},node:{types:"./dist/interface/payment/index.node.d.ts",import:"./dist/interface/payment/index.node.js",require:"./dist/interface/payment/index.node.js"}},"./spend-permission/browser":{types:"./dist/interface/public-utilities/spend-permission/index.d.ts",import:"./dist/interface/public-utilities/spend-permission/index.js",require:"./dist/interface/public-utilities/spend-permission/index.js"},"./spend-permission/node":{types:"./dist/interface/public-utilities/spend-permission/index.node.d.ts",import:"./dist/interface/public-utilities/spend-permission/index.node.js",require:"./dist/interface/public-utilities/spend-permission/index.node.js"},"./spend-permission":{types:"./dist/interface/public-utilities/spend-permission/index.d.ts",browser:{types:"./dist/interface/public-utilities/spend-permission/index.d.ts",import:"./dist/interface/public-utilities/spend-permission/index.js",require:"./dist/interface/public-utilities/spend-permission/index.js"},node:{types:"./dist/interface/public-utilities/spend-permission/index.node.d.ts",import:"./dist/interface/public-utilities/spend-permission/index.node.js",require:"./dist/interface/public-utilities/spend-permission/index.node.js"}},"./ui-assets":{types:"./dist/ui/assets/index.d.ts",import:"./dist/ui/assets/index.js",require:"./dist/ui/assets/index.js"}},files:["dist","README.md","LICENSE"],sideEffects:!1,repository:"https://github.com/base/account-sdk.git",author:"Base",license:"Apache-2.0",scripts:{clean:"rm -rf dist && rm -rf node_modules",pretest:"node compile-assets.cjs",test:"vitest","test:coverage":"vitest --coverage",prebuild:"rm -rf ./dist",build:"node compile-assets.cjs && tsc -p ./tsconfig.build.json && tsc-alias && yarn build:browser","build:browser":"rollup -c rollup.config.js",prepublishOnly:"yarn build",dev:"yarn build && tsc --watch & nodemon --watch dist --delay 1 --exec tsc-alias",typecheck:"tsc --noEmit",lint:"biome lint .",format:"biome format . --write","format:check":"biome check . --formatter-enabled=true --linter-enabled=false --organize-imports-enabled=false",size:"size-limit"},dependencies:{"@coinbase/cdp-sdk":"^1.0.0","@noble/hashes":"1.4.0",clsx:"1.2.1",eventemitter3:"5.0.1","idb-keyval":"6.2.1",ox:"0.6.9",preact:"10.24.2",viem:"^2.31.7",zustand:"5.0.3"},devDependencies:{"@rollup/plugin-commonjs":"^25.0.7","@rollup/plugin-json":"^6.1.0","@rollup/plugin-node-resolve":"^15.2.3","@rollup/plugin-replace":"^5.0.5","@rollup/plugin-typescript":"^11.1.6","@size-limit/preset-big-lib":"^11.1.6","@testing-library/jest-dom":"^6.5.0","@testing-library/preact":"^3.2.4","@types/node":"^14.18.54","@vitest/coverage-v8":"2.1.2","@vitest/web-worker":"3.2.1","fake-indexeddb":"^6.0.0",glob:"^11.0.0","jest-websocket-mock":"^2.4.0",jsdom:"^25.0.1",nodemon:"^3.1.0",rollup:"^4.9.6","rollup-plugin-terser":"^7.0.2",sass:"^1.64.1","size-limit":"^11.1.6","tsc-alias":"^1.8.8",tslib:"^2.6.0",typescript:"^5.1.6",vitest:"^2.1.9"},"size-limit":[{path:"./dist/index.js",limit:"31 KB",import:"*"}]})},577890,e=>{"use strict";var t=e.i(464265),i=e.i(624323);function s(e){let{key:s="public",name:r="Public Client"}=e;return(0,t.createClient)({...e,key:s,name:r,type:"publicClient"}).extend(i.publicActions)}e.s(["createPublicClient",()=>s])},834819,786387,e=>{"use strict";var t=e.i(534516),i=e.i(12933),s=e.i(225984),r=e.i(914862),n=e.i(828848),a=e.i(47034);async function o(e,o){let{account:d=e.account,chainId:c,nonce:l}=o;if(!d)throw new i.AccountNotFoundError({docsPath:"/docs/eip7702/prepareAuthorization"});let u=(0,t.parseAccount)(d),p=(()=>{if(o.executor)return"self"===o.executor?o.executor:(0,t.parseAccount)(o.executor)})(),m={address:o.contractAddress??o.address,chainId:c,nonce:l};return void 0===m.chainId&&(m.chainId=e.chain?.id??await (0,r.getAction)(e,n.getChainId,"getChainId")({})),void 0===m.nonce&&(m.nonce=await (0,r.getAction)(e,a.getTransactionCount,"getTransactionCount")({address:u.address,blockTag:"pending"}),("self"===p||p?.address&&(0,s.isAddressEqual)(p.address,u.address))&&(m.nonce+=1)),m}e.s(["prepareAuthorization",()=>o],834819);var d=e.i(45710);class c extends d.BaseError{constructor(e){super(`Call bundle failed with status: ${e.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=e}}e.s(["BundleFailedError",()=>c],786387)},541370,627956,503501,427015,e=>{"use strict";var t=e.i(241806),i=e.i(49570),s=e.i(509778),r=e.i(943446),n=e.i(534516),a=e.i(45710),o=e.i(478260),d=e.i(967868),c=e.i(425218),l=e.i(656460),u=e.i(936179),p=e.i(12933),m=e.i(229921),f=e.i(204534);function h({chain:e,currentChainId:t}){if(!e)throw new f.ChainNotFoundError;if(t!==e.id)throw new f.ChainMismatchError({chain:e,currentChainId:t})}e.s(["assertCurrentChain",()=>h],627956);var b=e.i(862440),w=e.i(526766),y=e.i(914862),g=e.i(866010),x=e.i(967944),v=e.i(828848),j=e.i(465321),C=e.i(206807);let T=new g.LruMap(128);async function E(e,t){let{account:i=e.account,chain:s=e.chain,accessList:r,authorizationList:o,blobs:d,data:c,gas:l,gasPrice:f,maxFeePerBlobGas:g,maxFeePerGas:E,maxPriorityFeePerGas:A,nonce:q,type:I,value:N,...B}=t;if(void 0===i)throw new p.AccountNotFoundError({docsPath:"/docs/actions/wallet/sendTransaction"});let S=i?(0,n.parseAccount)(i):null;try{(0,x.assertRequest)(t);let i=await (async()=>t.to?t.to:null!==t.to&&o&&o.length>0?await (0,m.recoverAuthorizationAddress)({authorization:o[0]}).catch(()=>{throw new a.BaseError("`to` is required. Could not infer from `authorizationList`.")}):void 0)();if(S?.type==="json-rpc"||null===S){let t;null!==s&&(t=await (0,y.getAction)(e,v.getChainId,"getChainId")({}),h({currentChainId:t,chain:s}));let n=e.chain?.formatters?.transactionRequest?.format,a=(n||w.formatTransactionRequest)({...(0,b.extract)(B,{format:n}),accessList:r,account:S,authorizationList:o,blobs:d,chainId:t,data:c,gas:l,gasPrice:f,maxFeePerBlobGas:g,maxFeePerGas:E,maxPriorityFeePerGas:A,nonce:q,to:i,type:I,value:N},"sendTransaction"),u=T.get(e.uid);try{return await e.request({method:u?"wallet_sendTransaction":"eth_sendTransaction",params:[a]},{retryCount:0})}catch(t){if(!1===u)throw t;if("InvalidInputRpcError"===t.name||"InvalidParamsRpcError"===t.name||"MethodNotFoundRpcError"===t.name||"MethodNotSupportedRpcError"===t.name)return await e.request({method:"wallet_sendTransaction",params:[a]},{retryCount:0}).then(t=>(T.set(e.uid,!0),t)).catch(i=>{if("MethodNotFoundRpcError"===i.name||"MethodNotSupportedRpcError"===i.name)throw T.set(e.uid,!1),t;throw i});throw t}}if(S?.type==="local"){let t=await (0,y.getAction)(e,j.prepareTransactionRequest,"prepareTransactionRequest")({account:S,accessList:r,authorizationList:o,blobs:d,chain:s,data:c,gas:l,gasPrice:f,maxFeePerBlobGas:g,maxFeePerGas:E,maxPriorityFeePerGas:A,nonce:q,nonceManager:S.nonceManager,parameters:[...j.defaultParameters,"sidecars"],type:I,value:N,...B,to:i}),n=s?.serializers?.transaction,a=await S.signTransaction(t,{serializer:n});return await (0,y.getAction)(e,C.sendRawTransaction,"sendRawTransaction")({serializedTransaction:a})}if(S?.type==="smart")throw new p.AccountTypeNotSupportedError({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"});throw new p.AccountTypeNotSupportedError({docsPath:"/docs/actions/wallet/sendTransaction",type:S?.type})}catch(e){if(e instanceof p.AccountTypeNotSupportedError)throw e;throw(0,u.getTransactionError)(e,{...t,account:S,chain:t.chain||void 0})}}e.s(["sendTransaction",()=>E],503501);let A="0x5792579257925792579257925792579257925792579257925792579257925792",q=(0,l.numberToHex)(0,{size:32});async function I(e,t){let{account:i=e.account,capabilities:r,chain:p=e.chain,experimental_fallback:m,experimental_fallbackDelay:f=32,forceAtomic:h=!1,id:b,version:w="2.0.0"}=t,y=i?(0,n.parseAccount)(i):null,g=t.calls.map(e=>{let t=e.abi?(0,d.encodeFunctionData)({abi:e.abi,functionName:e.functionName,args:e.args}):e.data;return{data:e.dataSuffix&&t?(0,c.concat)([t,e.dataSuffix]):t,to:e.to,value:e.value?(0,l.numberToHex)(e.value):void 0}});try{let t=await e.request({method:"wallet_sendCalls",params:[{atomicRequired:h,calls:g,capabilities:r,chainId:(0,l.numberToHex)(p.id),from:y?.address,id:b,version:w}]},{retryCount:0});if("string"==typeof t)return{id:t};return t}catch(i){if(m&&("MethodNotFoundRpcError"===i.name||"MethodNotSupportedRpcError"===i.name||"UnknownRpcError"===i.name||i.details.toLowerCase().includes("does not exist / is not available")||i.details.toLowerCase().includes("missing or invalid. request()")||i.details.toLowerCase().includes("did not match any variant of untagged enum")||i.details.toLowerCase().includes("account upgraded to unsupported contract")||i.details.toLowerCase().includes("eip-7702 not supported")||i.details.toLowerCase().includes("unsupported wc_ method")||i.details.toLowerCase().includes("feature toggled misconfigured")||i.details.toLowerCase().includes("jsonrpcengine: response has no error or result for request"))){if(r&&Object.values(r).some(e=>!e.optional)){let e="non-optional `capabilities` are not supported on fallback to `eth_sendTransaction`.";throw new o.UnsupportedNonOptionalCapabilityError(new a.BaseError(e,{details:e}))}if(h&&g.length>1){let e="`forceAtomic` is not supported on fallback to `eth_sendTransaction`.";throw new o.AtomicityNotSupportedError(new a.BaseError(e,{details:e}))}let t=[];for(let i of g){let r=E(e,{account:y,chain:p,data:i.data,to:i.to,value:i.value?(0,s.hexToBigInt)(i.value):void 0});t.push(r),f>0&&await new Promise(e=>setTimeout(e,f))}let i=await Promise.allSettled(t);if(i.every(e=>"rejected"===e.status))throw i[0].reason;let n=i.map(e=>"fulfilled"===e.status?e.value:q);return{id:(0,c.concat)([...n,(0,l.numberToHex)(p.id,{size:32}),A])}}throw(0,u.getTransactionError)(i,{...t,account:y,chain:t.chain})}}async function N(e,n){let a;async function o(r){if(r.endsWith(A.slice(2))){let n=(0,i.trim)((0,t.sliceHex)(r,-64,-32)),a=(0,t.sliceHex)(r,0,-64).slice(2).match(/.{1,64}/g),o=await Promise.all(a.map(t=>q.slice(2)!==t?e.request({method:"eth_getTransactionReceipt",params:[`0x${t}`]},{dedupe:!0}):void 0)),d=o.some(e=>null===e)?100:o.every(e=>e?.status==="0x1")?200:o.every(e=>e?.status==="0x0")?500:600;return{atomic:!1,chainId:(0,s.hexToNumber)(n),receipts:o.filter(Boolean),status:d,version:"2.0.0"}}return e.request({method:"wallet_getCallsStatus",params:[r]})}let{atomic:d=!1,chainId:c,receipts:l,version:u="2.0.0",...p}=await o(n.id),[m,f]=(a=p.status)>=100&&a<200?["pending",a]:a>=200&&a<300?["success",a]:a>=300&&a<700?["failure",a]:"CONFIRMED"===a?["success",200]:"PENDING"===a?["pending",100]:[void 0,a];return{...p,atomic:d,chainId:c?(0,s.hexToNumber)(c):void 0,receipts:l?.map(e=>({...e,blockNumber:(0,s.hexToBigInt)(e.blockNumber),gasUsed:(0,s.hexToBigInt)(e.gasUsed),status:r.receiptStatuses[e.status]}))??[],statusCode:f,status:m,version:u}}e.s(["fallbackMagicIdentifier",0,A,"fallbackTransactionErrorMagicIdentifier",0,q,"sendCalls",()=>I],427015),e.s(["getCallsStatus",()=>N],541370)},93083,e=>{"use strict";var t=e.i(45710),i=e.i(786387),s=e.i(914862),r=e.i(576483),n=e.i(421045),a=e.i(202905),o=e.i(381552),d=e.i(13567),c=e.i(541370);async function l(e,t){let l,{id:p,pollingInterval:m=e.pollingInterval,status:f=({statusCode:e})=>200===e||e>=300,retryCount:h=4,retryDelay:b=({count:e})=>200*~~(1<<e),timeout:w=6e4,throwOnFailure:y=!1}=t,g=(0,d.stringify)(["waitForCallsStatus",e.uid,p]),{promise:x,resolve:v,reject:j}=(0,a.withResolvers)(),C=(0,r.observe)(g,{resolve:v,reject:j},t=>{let r=(0,n.poll)(async()=>{let n=e=>{clearTimeout(l),r(),e(),C()};try{let r=await (0,o.withRetry)(async()=>{let t=await (0,s.getAction)(e,c.getCallsStatus,"getCallsStatus")({id:p});if(y&&"failure"===t.status)throw new i.BundleFailedError(t);return t},{retryCount:h,delay:b});if(!f(r))return;n(()=>t.resolve(r))}catch(e){n(()=>t.reject(e))}},{interval:m,emitOnBegin:!0});return r});return l=w?setTimeout(()=>{C(),clearTimeout(l),j(new u({id:p}))},w):void 0,await x}class u extends t.BaseError{constructor({id:e}){super(`Timed out while waiting for call bundle with id "${e}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}e.s(["waitForCallsStatus",()=>l])},364775,e=>{"use strict";var t=e.i(45710);class i extends t.BaseError{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function s(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new i({value:e});let[s,r="0"]=e.split("."),n=s.startsWith("-");if(n&&(s=s.slice(1)),r=r.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${r}`))&&(s=`${BigInt(s)+1n}`),r="";else if(r.length>t){let[e,i,n]=[r.slice(0,t-1),r.slice(t-1,t),r.slice(t)],a=Math.round(Number(`${i}.${n}`));(r=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>t&&(r=r.slice(1),s=`${BigInt(s)+1n}`),r=r.slice(0,t)}else r=r.padEnd(t,"0");return BigInt(`${n?"-":""}${s}${r}`)}e.s(["parseUnits",()=>s],364775)}]);