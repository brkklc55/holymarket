(()=>{var a={};a.id=8211,a.ids=[8211],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3181:(a,b,c)=>{"use strict";c.d(b,{Y:()=>d,a:()=>e});let d="0xd62a41360a66f748ae3777a27a86b47b84a80a08",e=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"marketId",type:"uint256"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"bool",name:"outcome",type:"bool"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"BetPlaced",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"marketId",type:"uint256"},{indexed:!1,internalType:"string",name:"question",type:"string"},{indexed:!1,internalType:"uint256",name:"endTime",type:"uint256"}],name:"MarketCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"marketId",type:"uint256"},{indexed:!1,internalType:"bool",name:"outcome",type:"bool"}],name:"MarketResolved",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"marketId",type:"uint256"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"WinningsClaimed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"marketId",type:"uint256"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"EmergencyWithdrawn",type:"event"},{inputs:[],name:"admin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_marketId",type:"uint256"},{internalType:"bool",name:"_outcome",type:"bool"}],name:"bet",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"_marketId",type:"uint256"}],name:"claim",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_question",type:"string"},{internalType:"uint256",name:"_duration",type:"uint256"}],name:"createMarket",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"emergencyReset",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_marketId",type:"uint256"}],name:"emergencyWithdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_marketId",type:"uint256"},{internalType:"address",name:"_user",type:"address"}],name:"getUserBet",outputs:[{internalType:"uint256",name:"yesAmount",type:"uint256"},{internalType:"uint256",name:"noAmount",type:"uint256"},{internalType:"bool",name:"claimed",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"marketCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"resetAfterMarketId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"markets",outputs:[{internalType:"string",name:"question",type:"string"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"uint256",name:"yesPool",type:"uint256"},{internalType:"uint256",name:"noPool",type:"uint256"},{internalType:"bool",name:"resolved",type:"bool"},{internalType:"bool",name:"outcome",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_marketId",type:"uint256"},{internalType:"bool",name:"_outcome",type:"bool"}],name:"resolveMarket",outputs:[],stateMutability:"nonpayable",type:"function"}]},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:a=>{"use strict";a.exports=require("node:crypto")},78335:()=>{},86138:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>af,patchFetch:()=>ae,routeModule:()=>aa,serverHooks:()=>ad,workAsyncStorage:()=>ab,workUnitAsyncStorage:()=>ac});var d={};c.r(d),c.d(d,{GET:()=>$,POST:()=>_,runtime:()=>G});var e=c(19225),f=c(84006),g=c(8317),h=c(99373),i=c(34775),j=c(24235),k=c(261),l=c(54365),m=c(90771),n=c(73461),o=c(67798),p=c(92280),q=c(62018),r=c(45696),s=c(47929),t=c(86439),u=c(37527),v=c(45592),w=c(29021),x=c.n(w),y=c(33873),z=c.n(y),A=c(35728),B=c(58289),C=c(39241),D=c(39812);let E=(0,c(57676).x)({id:97,name:"BNB Smart Chain Testnet",nativeCurrency:{decimals:18,name:"BNB",symbol:"tBNB"},rpcUrls:{default:{http:["https://data-seed-prebsc-1-s1.bnbchain.org:8545"]}},blockExplorers:{default:{name:"BscScan",url:"https://testnet.bscscan.com",apiUrl:"https://api-testnet.bscscan.com/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0x109d893}},testnet:!0});var F=c(3181);let G="nodejs",H=z().join(process.cwd(),"data","points.json"),I=["0x33713b87bab352c46bba4953ab6cb11afe895d93","0x96a445dd060efd79ab27742de12128f24b4edaec"],J=new Map;function K(a){let b=new Date(a),c=b.getUTCFullYear(),d=String(b.getUTCMonth()+1).padStart(2,"0"),e=String(b.getUTCDate()).padStart(2,"0");return`${c}-${d}-${e}`}function L(a){if(null==a||""===a||"string"!=typeof a)return;let b=a.trim();if(!b)return;let c=Date.parse(b);if(Number.isFinite(c))return new Date(c).toISOString()}function M(a,b,c){let d=Date.now(),e=J.get(a);return!e||e.resetAt<=d?(J.set(a,{count:1,resetAt:d+c}),{ok:!0,remaining:b-1,resetAt:d+c}):e.count>=b?{ok:!1,remaining:0,resetAt:e.resetAt}:(e.count+=1,J.set(a,e),{ok:!0,remaining:b-e.count,resetAt:e.resetAt})}function N(){return new Date().toISOString()}function O(a){return a.trim().toLowerCase()}let P=(0,A.l)({chain:E,transport:(0,B.L)(process.env.BSC_RPC_URL||"https://data-seed-prebsc-1-s1.binance.org:8545")});async function Q(a){let b,c=Math.floor(Date.now()/1e3),d=O(a.user),e=a.txHash,f=await P.getTransaction({hash:e});if(!f.to)return{ok:!1,error:"Invalid tx"};if(O(f.to)!==O(F.Y))return{ok:!1,error:"Tx not sent to market contract"};if(O(f.from)!==d)return{ok:!1,error:"Tx not sent from this wallet"};try{b=(0,C.J)({abi:F.a,data:f.input})}catch{return{ok:!1,error:"Tx is not a valid contract call"}}if("bet"!==b.functionName)return{ok:!1,error:"Tx is not a bet()"};if(!f.value||f.value<=0n)return{ok:!1,error:"Bet value is zero"};let g=await P.getTransactionReceipt({hash:e}),h=c-Number((await P.getBlock({blockNumber:g.blockNumber})).timestamp);return h>600?{ok:!1,error:"Bet is too old to claim a boost"}:{ok:!0,valueBnb:Number((0,D.c)(f.value)),ageSec:h}}function R(){if(!x().existsSync(H)){x().mkdirSync(z().dirname(H),{recursive:!0});let a={users:{},devices:{},admins:{},shareBoosts:{},tasks:[],taskClaims:{}};return I.forEach((b,c)=>{let d=O(b);a.admins[d]={role:0===c?"superadmin":"admin",createdAt:N(),updatedAt:N()}}),x().writeFileSync(H,JSON.stringify(a,null,2)),a}let a=JSON.parse(x().readFileSync(H,"utf8"));return(!a.devices||"object"!=typeof a.devices||Array.isArray(a.devices))&&(a.devices={}),(!a.admins||"object"!=typeof a.admins||Array.isArray(a.admins))&&(a.admins={}),(!a.shareBoosts||"object"!=typeof a.shareBoosts||Array.isArray(a.shareBoosts))&&(a.shareBoosts={}),Array.isArray(a.tasks)||(a.tasks=[]),(!a.taskClaims||"object"!=typeof a.taskClaims||Array.isArray(a.taskClaims))&&(a.taskClaims={}),0===Object.keys(a.admins).length&&I.length>0&&(I.forEach((b,c)=>{let d=O(b);a.admins[d]={role:0===c?"superadmin":"admin",createdAt:N(),updatedAt:N()}}),S(a)),a}function S(a){x().writeFileSync(H,JSON.stringify(a,null,2))}function T(a,b){let c=O(b),d=a.users[c];if(d)return d;let e={points:0,volumeBnb:0,createdAt:N(),updatedAt:N()};return a.users[c]=e,e}function U(a,b){let c=O(b),d=a.tasks||[],e=a.taskClaims||{},f=0;for(let a of d)"follow"===a.type&&e[a.id]?.[c]&&(f+=1);return f}function V(a,b,c){let d=b||"unknown";a.devices||(a.devices={});let e=O(c),f=N(),g=a.devices[d]||{accounts:[],firstSeenAt:f,lastSeenAt:f};return g.lastSeenAt=f,g.accounts.includes(e)||g.accounts.push(e),a.devices[d]=g,g}function W(a,b){if(!b)return null;let c=O(b),d=a.admins?.[c];return d?.role||null}function X(a,b,c="admin"){let d=W(a,b);return d?"superadmin"===c&&"superadmin"!==d?{ok:!1,role:d}:{ok:!0,role:d}:{ok:!1,role:null}}function Y(a){return Object.entries(a.users).map(([a,b])=>({user:a,points:b.points})).sort((a,b)=>b.points-a.points).slice(0,50)}function Z(){let a=Number(process.env.NEXT_PUBLIC_BNB_USD||process.env.BNB_USD||"300");return Number.isFinite(a)&&a>0?a:300}async function $(a){let b=R(),c=new URL(a.url),d=c.searchParams.get("user"),e=c.searchParams.get("whoami"),f=c.searchParams.get("tasks");if(e){let a=W(b,e);return v.NextResponse.json({role:a})}if(f){let a=d?O(d):null,c=(b.tasks||[]).slice().sort((a,b)=>b.createdAt.localeCompare(a.createdAt)),e=b.taskClaims||{},f=K(Date.now()),g=a?Object.fromEntries(c.map(b=>{let c=e[b.id],d=c?.[a];return"daily"===b.repeat?[b.id,!!d?.[f]]:[b.id,!!d]})):{},h=a?{points:b.users?.[a]?.points||0,volumeBnb:b.users?.[a]?.volumeBnb||0,followTasks:U(b,a)}:null;return v.NextResponse.json({tasks:c,claims:g,stats:h})}if(d){let a=O(d),c=b.users[a];return v.NextResponse.json({user:c?{user:a,points:c.points,referrer:c.referrer||null}:null,leaderboard:Y(b)})}return v.NextResponse.json({leaderboard:Y(b)})}async function _(a){let b,c=R(),d=function(a){let b=a.headers.get("x-forwarded-for");if(b)return b.split(",")[0]?.trim()||"unknown";let c=a.headers.get("x-real-ip");return c?c.trim():"unknown"}(a),e=(a.headers.get("x-device-id")||"unknown").slice(0,128);try{b=await a.json()}catch{return v.NextResponse.json({error:"Invalid JSON"},{status:400})}let f=b?.action;if(!f)return v.NextResponse.json({error:"Missing action"},{status:400});if("bindReferral"===f&&!M(`bind:${d}:${e}`,10,864e5).ok||"earn"===f&&!M(`earn:${d}:${e}`,120,36e5).ok||"shareBoost"===f&&!M(`share:${d}:${e}`,30,864e5).ok)return v.NextResponse.json({error:"Rate limited"},{status:429});if("bindReferral"===f){let a=b?.user,d=b?.referrer;if(!a||!d)return v.NextResponse.json({error:"Missing user/referrer"},{status:400});let f=O(a),g=O(d);if(f===g)return v.NextResponse.json({ok:!0,skipped:!0});if(V(c,e,f).accounts.length>3)return S(c),v.NextResponse.json({error:"Device account limit reached"},{status:403});let h=T(c,f);if(T(c,g),h.referrer)return v.NextResponse.json({ok:!0,skipped:!0,reason:"already_bound"});h.referrer=g,h.points+=50,h.updatedAt=N();let i=c.users[g];return i.points+=50,i.updatedAt=N(),S(c),v.NextResponse.json({ok:!0,awarded:50})}if("earn"===f){let a=b?.user,d=b?.amountUsd,f=b?.amountBnb;if(!a)return v.NextResponse.json({error:"Missing user"},{status:400});let g=O(a);if(V(c,e,g).accounts.length>3)return S(c),v.NextResponse.json({error:"Device account limit reached"},{status:403});let h=T(c,g),i=null;if(null!=d){let a=Number(d);i=Number.isFinite(a)&&a>0?a:null}else if(null!=f){let a=Number(f);Number.isFinite(a)&&a>0&&(i=a*Z())}if(!i)return v.NextResponse.json({error:"Missing/invalid amountUsd or amountBnb"},{status:400});if(null!=f){let a=Number(f);Number.isFinite(a)&&a>0&&(h.volumeBnb=Number(h.volumeBnb||0)+a)}let j=Math.floor(10*i);if(j<=0)return v.NextResponse.json({ok:!0,earned:0,bonus:0});h.points+=j,h.updatedAt=N();let k=0;if(h.referrer){let a=T(c,h.referrer);(k=Math.floor(.1*j))>0&&(a.points+=k,a.updatedAt=N())}return S(c),v.NextResponse.json({ok:!0,earned:j,bonus:k,leaderboard:Y(c)})}if("shareBoost"===f){let a=b?.user,d=b?.txHash,f=b?.amountUsd,g=b?.amountBnb;if(!a)return v.NextResponse.json({error:"Missing user"},{status:400});if(!d||"string"!=typeof d)return v.NextResponse.json({error:"Missing txHash"},{status:400});let h=d.trim();if(!/^0x[a-fA-F0-9]{64}$/.test(h))return v.NextResponse.json({error:"Invalid txHash"},{status:400});let i=O(a);try{let a=await Q({txHash:h,user:i});if(!a.ok)return v.NextResponse.json({error:a.error},{status:400});a.valueBnb>0&&(b.amountBnb=a.valueBnb)}catch{return v.NextResponse.json({error:"Failed to validate bet tx"},{status:400})}if(V(c,e,i).accounts.length>3)return S(c),v.NextResponse.json({error:"Device account limit reached"},{status:403});if(c.shareBoosts||(c.shareBoosts={}),c.shareBoosts[h])return v.NextResponse.json({ok:!0,skipped:!0,reason:"already_boosted"});let j=null;if(null!=f){let a=Number(f);j=Number.isFinite(a)&&a>0?a:null}else if(null!=g){let a=Number(g);Number.isFinite(a)&&a>0&&(j=a*Z())}if(!j)return v.NextResponse.json({error:"Missing/invalid amountUsd or amountBnb"},{status:400});let k=Math.floor(10*j);if(k<=0)return v.NextResponse.json({ok:!0,extra:0,skipped:!0});let l=T(c,i);if(l.points+=k,void 0!==b.amountBnb&&null!==b.amountBnb){let a=Number(b.amountBnb);Number.isFinite(a)&&a>0&&(l.volumeBnb=Number(l.volumeBnb||0)+a)}return l.updatedAt=N(),c.shareBoosts[h]={user:i,extra:k,createdAt:N()},S(c),v.NextResponse.json({ok:!0,extra:k,leaderboard:Y(c)})}if("taskClaim"===f){var g;let a,d,f=b?.user,h=b?.taskId;if(!f||!h)return v.NextResponse.json({error:"Missing user/taskId"},{status:400});let i=O(f),j=String(h).slice(0,64);if(V(c,e,i).accounts.length>3)return S(c),v.NextResponse.json({error:"Device account limit reached"},{status:403});let k=(c.tasks||[]).find(a=>a.id===j);if(!k)return v.NextResponse.json({error:"Task not found"},{status:404});if(!k.active)return v.NextResponse.json({error:"Task inactive"},{status:400});let l=(g=Date.now(),a=k.startAt?Date.parse(k.startAt):NaN,d=k.endAt?Date.parse(k.endAt):NaN,k.startAt&&Number.isFinite(a)&&g<a?{ok:!1,reason:"not_started"}:k.endAt&&Number.isFinite(d)&&g>d?{ok:!1,reason:"ended"}:{ok:!0});if(!l.ok)return v.NextResponse.json({error:"not_started"===l.reason?"Task not started":"Task ended"},{status:400});let m=function(a,b,c){if(!c)return{ok:!0};let d=T(a,b);if(void 0!==c.minPoints&&d.points<c.minPoints)return{ok:!1,error:`Requires at least ${c.minPoints} points`};let e=Number(d.volumeBnb||0);return void 0!==c.minVolumeBnb&&e<c.minVolumeBnb?{ok:!1,error:`Requires at least ${c.minVolumeBnb} BNB volume`}:void 0!==c.minFollowTasks&&U(a,b)<c.minFollowTasks?{ok:!1,error:`Requires completing ${c.minFollowTasks} follow tasks`}:{ok:!0}}(c,i,k.requirements);if(!m.ok)return v.NextResponse.json({error:m.error},{status:400});c.taskClaims||(c.taskClaims={}),c.taskClaims[j]||(c.taskClaims[j]={});let n="daily"===k.repeat?"daily":"none",o=K(Date.now()),p=c.taskClaims[j][i];if("daily"===n){if(p&&"object"==typeof p&&p?.[o])return v.NextResponse.json({ok:!0,skipped:!0,reason:"already_claimed_today"})}else if(p)return v.NextResponse.json({ok:!0,skipped:!0,reason:"already_claimed"});let q=T(c,i);q.points+=Math.max(0,Math.floor(Number(k.points)||0)),q.updatedAt=N();let r={claimedAt:N(),points:Math.max(0,Math.floor(Number(k.points)||0))};if("daily"===n){let a=p&&"object"==typeof p?p:{};a[o]=r,c.taskClaims[j][i]=a}else c.taskClaims[j][i]=r;return S(c),v.NextResponse.json({ok:!0,awarded:Math.max(0,Math.floor(Number(k.points)||0)),leaderboard:Y(c)})}if("adminTaskList"===f){if(!X(c,b?.adminAddress,"admin").ok)return v.NextResponse.json({error:"Not authorized"},{status:403});let a=(c.tasks||[]).slice().sort((a,b)=>b.createdAt.localeCompare(a.createdAt));return v.NextResponse.json({ok:!0,tasks:a})}if("adminTaskUpsert"===f){if(!X(c,b?.adminAddress,"admin").ok)return v.NextResponse.json({error:"Not authorized"},{status:403});let a=b?.id,d=b?.type,e=b?.title,f=b?.url,g=b?.points,h=b?.active;if("link"!==d&&"follow"!==d&&"checkin"!==d)return v.NextResponse.json({error:"Invalid type"},{status:400});if(!e)return v.NextResponse.json({error:"Missing title"},{status:400});if("checkin"!==d&&!f)return v.NextResponse.json({error:"Missing url"},{status:400});let i=(a?String(a):`task_${Date.now()}_${Math.random().toString(16).slice(2)}`).slice(0,64),j=String(e).slice(0,80),k=b?.description?String(b.description).slice(0,240):"",l="checkin"===d?"":String(f).slice(0,500),m=Math.max(0,Math.floor(Number(g)||0)),n=function(a){if(!a||"object"!=typeof a)return;let b={};if(void 0!==a.minPoints&&null!==a.minPoints){let c=Number(a.minPoints);Number.isFinite(c)&&c>=0&&(b.minPoints=Math.floor(c))}if(void 0!==a.minVolumeBnb&&null!==a.minVolumeBnb){let c=Number(a.minVolumeBnb);Number.isFinite(c)&&c>=0&&(b.minVolumeBnb=c)}if(void 0!==a.minFollowTasks&&null!==a.minFollowTasks){let c=Number(a.minFollowTasks);Number.isFinite(c)&&c>=0&&(b.minFollowTasks=Math.floor(c))}return Object.keys(b).length?b:void 0}(b?.requirements),o=L(b?.startAt),p=L(b?.endAt),q=b?.repeat;if(o&&p){let a=Date.parse(o),b=Date.parse(p);if(Number.isFinite(a)&&Number.isFinite(b)&&b<=a)return v.NextResponse.json({error:"endAt must be after startAt"},{status:400})}c.tasks||(c.tasks=[]);let r=N(),s=c.tasks.findIndex(a=>a.id===i),t={id:i,type:d,repeat:"daily"===q?"daily":"none",title:j,description:k,url:l,points:m,active:!!h,startAt:o,endAt:p,requirements:n,createdAt:s>=0?c.tasks[s].createdAt:r,updatedAt:r};return s>=0?c.tasks[s]=t:c.tasks.unshift(t),S(c),v.NextResponse.json({ok:!0,task:t})}if("adminTaskRemove"===f){if(!X(c,b?.adminAddress,"admin").ok)return v.NextResponse.json({error:"Not authorized"},{status:403});let a=b?.id;if(!a)return v.NextResponse.json({error:"Missing id"},{status:400});let d=String(a).slice(0,64);return c.tasks=(c.tasks||[]).filter(a=>a.id!==d),c.taskClaims&&delete c.taskClaims[d],S(c),v.NextResponse.json({ok:!0})}if("adminResetAll"===f)return X(c,b?.adminAddress,"superadmin").ok?(c.users={},c.devices={},S(c),v.NextResponse.json({ok:!0})):v.NextResponse.json({error:"Not authorized"},{status:403});if("adminAdjust"===f){if(!X(c,b?.adminAddress,"admin").ok)return v.NextResponse.json({error:"Not authorized"},{status:403});let a=b?.user,d=b?.delta;if(!a||null==d)return v.NextResponse.json({error:"Missing user/delta"},{status:400});let e=O(a),f=Number(d);if(!Number.isFinite(f))return v.NextResponse.json({error:"Invalid delta"},{status:400});let g=T(c,e);return g.points=Math.max(0,Math.floor(g.points+f)),g.updatedAt=N(),S(c),v.NextResponse.json({ok:!0,user:{user:e,points:g.points},leaderboard:Y(c)})}if("adminList"===f){let a=X(c,b?.adminAddress,"admin");if(!a.ok)return v.NextResponse.json({error:"Not authorized"},{status:403});let d=Object.entries(c.admins||{}).map(([a,b])=>({address:a,role:b.role,createdAt:b.createdAt,updatedAt:b.updatedAt}));return d.sort((a,b)=>a.role===b.role?a.address.localeCompare(b.address):"superadmin"===a.role?-1:1),v.NextResponse.json({ok:!0,role:a.role,admins:d})}if("adminUpsert"===f){if(!X(c,b?.adminAddress,"superadmin").ok)return v.NextResponse.json({error:"Not authorized"},{status:403});let a=b?.target,d=b?.role;if(!a||"admin"!==d&&"superadmin"!==d)return v.NextResponse.json({error:"Missing/invalid target/role"},{status:400});let e=O(a),f=N();c.admins||(c.admins={});let g=c.admins[e];return c.admins[e]={role:d,createdAt:g?.createdAt||f,updatedAt:f},S(c),v.NextResponse.json({ok:!0})}if("adminRemove"===f){if(!X(c,b?.adminAddress,"superadmin").ok)return v.NextResponse.json({error:"Not authorized"},{status:403});let a=b?.target;if(!a)return v.NextResponse.json({error:"Missing target"},{status:400});let d=O(a),e=c.admins?.[d];return e?"superadmin"===e.role&&Object.values(c.admins||{}).filter(a=>"superadmin"===a.role).length<=1?v.NextResponse.json({error:"Cannot remove last superadmin"},{status:400}):(delete c.admins[d],S(c),v.NextResponse.json({ok:!0})):v.NextResponse.json({ok:!0,skipped:!0})}return v.NextResponse.json({error:"Unknown action"},{status:400})}let aa=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/points/route",pathname:"/api/points",filename:"route",bundlePath:"app/api/points/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\brkkl\\.gemini\\antigravity\\scratch\\folymarket\\app\\api\\points\\route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:ab,workUnitAsyncStorage:ac,serverHooks:ad}=aa;function ae(){return(0,g.patchFetch)({workAsyncStorage:ab,workUnitAsyncStorage:ac})}async function af(a,b,c){aa.isDev&&(0,h.addRequestMeta)(a,"devRequestTimingInternalsEnd",process.hrtime.bigint());let d="/api/points/route";"/index"===d&&(d="/");let e=await aa.prepare(a,b,{srcPage:d,multiZoneDraftMode:!1});if(!e)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:v,nextConfig:w,parsedUrl:x,isDraftMode:y,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D,clientReferenceManifest:E,serverActionsManifest:F}=e,G=(0,k.normalizeAppPath)(d),H=!!(z.dynamicRoutes[G]||z.routes[D]),I=async()=>((null==A?void 0:A.render404)?await A.render404(a,b,x,!1):b.end("This page could not be found"),null);if(H&&!y){let a=!!z.routes[D],b=z.dynamicRoutes[G];if(b&&!1===b.fallback&&!a){if(w.experimental.adapterPath)return await I();throw new t.NoFallbackError}}let J=null;!H||aa.isDev||y||(J="/index"===(J=D)?"/":J);let K=!0===aa.isDev||!H,L=H&&!K;F&&E&&(0,j.setManifestsSingleton)({page:d,clientReferenceManifest:E,serverActionsManifest:F});let M=a.method||"GET",N=(0,i.getTracer)(),O=N.getActiveScopeSpan(),P={params:v,prerenderManifest:z,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:K,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d,e)=>aa.onRequestError(a,b,d,e,A)},sharedContext:{buildId:g}},Q=new l.NodeNextRequest(a),R=new l.NodeNextResponse(b),S=m.NextRequestAdapter.fromNodeNextRequest(Q,(0,m.signalFromNodeResponse)(b));try{let e=async a=>aa.handle(S,P).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let c=N.getRootSpanAttributes();if(!c)return;if(c.get("next.span_type")!==n.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${c.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=c.get("next.route");if(e){let b=`${M} ${e}`;a.setAttributes({"next.route":e,"http.route":e,"next.span_name":b}),a.updateName(b)}else a.updateName(`${M} ${d}`)}),g=!!(0,h.getRequestMeta)(a,"minimalMode"),j=async h=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!g&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let d=await e(h);a.fetchMetrics=P.renderOpts.fetchMetrics;let i=P.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=P.renderOpts.collectedTags;if(!H)return await (0,p.I)(Q,R,d,P.renderOpts.pendingWaitUntil),null;{let a=await d.blob(),b=(0,q.toNodeOutgoingHttpHeaders)(d.headers);j&&(b[s.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==P.renderOpts.collectedRevalidate&&!(P.renderOpts.collectedRevalidate>=s.INFINITE_CACHE)&&P.renderOpts.collectedRevalidate,e=void 0===P.renderOpts.collectedExpire||P.renderOpts.collectedExpire>=s.INFINITE_CACHE?void 0:P.renderOpts.collectedExpire;return{value:{kind:u.CachedRouteKind.APP_ROUTE,status:d.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:e}}}}catch(b){throw(null==f?void 0:f.isStale)&&await aa.onRequestError(a,b,{routerKind:"App Router",routePath:d,routeType:"route",revalidateReason:(0,o.c)({isStaticGeneration:L,isOnDemandRevalidate:B})},!1,A),b}},l=await aa.handleResponse({req:a,nextConfig:w,cacheKey:J,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil,isMinimalMode:g});if(!H)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==u.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});g||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),y&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,q.fromNodeOutgoingHttpHeaders)(l.value.headers);return g&&H||m.delete(s.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,r.getCacheControlHeader)(l.cacheControl)),await (0,p.I)(Q,R,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};O?await j(O):await N.withPropagatedContext(a.headers,()=>N.trace(n.BaseServerSpan.handleRequest,{spanName:`${M} ${d}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":a.url}},j))}catch(b){if(b instanceof t.NoFallbackError||await aa.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"route",revalidateReason:(0,o.c)({isStaticGeneration:L,isOnDemandRevalidate:B})},!1,A),H)throw b;return await (0,p.I)(Q,R,new Response(null,{status:500})),null}}},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96487:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[3445,1813,9718,8358],()=>b(b.s=86138));module.exports=c})();