"use strict";exports.id=1082,exports.ids=[1082],exports.modules={2592:(a,b,c)=>{let{Duplex:d}=c(27910);function e(a){a.emit("close")}function f(){!this.destroyed&&this._writableState.finished&&this.destroy()}function g(a){this.removeListener("error",g),this.destroy(),0===this.listenerCount("error")&&this.emit("error",a)}a.exports=function(a,b){let c=!0,h=!0;function i(){c&&a._socket.resume()}a.readyState===a.CONNECTING?a.once("open",function(){a._receiver.removeAllListeners("drain"),a._receiver.on("drain",i)}):(a._receiver.removeAllListeners("drain"),a._receiver.on("drain",i));let j=new d({...b,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return a.on("message",function(b){j.push(b)||(c=!1,a._socket.pause())}),a.once("error",function(a){j.destroyed||(h=!1,j.destroy(a))}),a.once("close",function(){j.destroyed||j.push(null)}),j._destroy=function(b,c){if(a.readyState===a.CLOSED){c(b),process.nextTick(e,j);return}let d=!1;a.once("error",function(a){d=!0,c(a)}),a.once("close",function(){d||c(b),process.nextTick(e,j)}),h&&a.terminate()},j._final=function(b){a.readyState===a.CONNECTING?a.once("open",function(){j._final(b)}):null!==a._socket&&(a._socket._writableState.finished?(b(),j._readableState.endEmitted&&j.destroy()):(a._socket.once("finish",function(){b()}),a.close()))},j._read=function(){(a.readyState===a.OPEN||a.readyState===a.CLOSING)&&!c&&(c=!0,a._receiver._writableState.needDrain||a._socket.resume())},j._write=function(b,c,d){a.readyState===a.CONNECTING?a.once("open",function(){j._write(b,c,d)}):a.send(b,d)},j.on("end",f),j.on("error",g),j}},5183:a=>{a.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},6220:(a,b,c)=>{let d,e=c(74075),f=c(81707),g=c(41982),{kStatusCode:h,NOOP:i}=c(5183),j=Buffer.from([0,0,255,255]),k=Symbol("permessage-deflate"),l=Symbol("total-length"),m=Symbol("callback"),n=Symbol("buffers"),o=Symbol("error");class p{constructor(a,b,c){this._maxPayload=0|c,this._options=a||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!b,this._deflate=null,this._inflate=null,this.params=null,d||(d=new g(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let a={};return this._options.serverNoContextTakeover&&(a.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(a.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(a.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?a.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(a.client_max_window_bits=!0),a}accept(a){return a=this.normalizeParams(a),this.params=this._isServer?this.acceptAsServer(a):this.acceptAsClient(a),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let a=this._deflate[m];this._deflate.close(),this._deflate=null,a&&a(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(a){let b=this._options,c=a.find(a=>(!1!==b.serverNoContextTakeover||!a.server_no_context_takeover)&&(!a.server_max_window_bits||!1!==b.serverMaxWindowBits&&("number"!=typeof b.serverMaxWindowBits||!(b.serverMaxWindowBits>a.server_max_window_bits)))&&("number"!=typeof b.clientMaxWindowBits||!!a.client_max_window_bits));if(!c)throw Error("None of the extension offers can be accepted");return b.serverNoContextTakeover&&(c.server_no_context_takeover=!0),b.clientNoContextTakeover&&(c.client_no_context_takeover=!0),"number"==typeof b.serverMaxWindowBits&&(c.server_max_window_bits=b.serverMaxWindowBits),"number"==typeof b.clientMaxWindowBits?c.client_max_window_bits=b.clientMaxWindowBits:(!0===c.client_max_window_bits||!1===b.clientMaxWindowBits)&&delete c.client_max_window_bits,c}acceptAsClient(a){let b=a[0];if(!1===this._options.clientNoContextTakeover&&b.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(b.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&b.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(b.client_max_window_bits=this._options.clientMaxWindowBits);return b}normalizeParams(a){return a.forEach(a=>{Object.keys(a).forEach(b=>{let c=a[b];if(c.length>1)throw Error(`Parameter "${b}" must have only a single value`);if(c=c[0],"client_max_window_bits"===b){if(!0!==c){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else if("server_max_window_bits"===b){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if("client_no_context_takeover"===b||"server_no_context_takeover"===b){if(!0!==c)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else throw Error(`Unknown parameter "${b}"`);a[b]=c})}),a}decompress(a,b,c){d.add(d=>{this._decompress(a,b,(a,b)=>{d(),c(a,b)})})}compress(a,b,c){d.add(d=>{this._compress(a,b,(a,b)=>{d(),c(a,b)})})}_decompress(a,b,c){let d=this._isServer?"client":"server";if(!this._inflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:b}),this._inflate[k]=this,this._inflate[l]=0,this._inflate[n]=[],this._inflate.on("error",s),this._inflate.on("data",r)}this._inflate[m]=c,this._inflate.write(a),b&&this._inflate.write(j),this._inflate.flush(()=>{let a=this._inflate[o];if(a){this._inflate.close(),this._inflate=null,c(a);return}let e=f.concat(this._inflate[n],this._inflate[l]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[l]=0,this._inflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._inflate.reset()),c(null,e)})}_compress(a,b,c){let d=this._isServer?"server":"client";if(!this._deflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:b}),this._deflate[l]=0,this._deflate[n]=[],this._deflate.on("error",i),this._deflate.on("data",q)}this._deflate[m]=c,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let a=f.concat(this._deflate[n],this._deflate[l]);b&&(a=a.slice(0,a.length-4)),this._deflate[m]=null,this._deflate[l]=0,this._deflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._deflate.reset(),c(null,a)})}}function q(a){this[n].push(a),this[l]+=a.length}function r(a){(this[l]+=a.length,this[k]._maxPayload<1||this[l]<=this[k]._maxPayload)?this[n].push(a):(this[o]=RangeError("Max payload size exceeded"),this[o].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[o][h]=1009,this.removeListener("data",r),this.reset())}function s(a){this[k]._inflate=null,a[h]=1007,this[m](a)}a.exports=p},10143:a=>{let b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function c(a,b,c){void 0===a[b]?a[b]=[c]:a[b].push(c)}a.exports={format:function(a){return Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>[b].concat(Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>!0===a?b:`${b}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){let d,e,f=Object.create(null);if(void 0===a||""===a)return f;let g=Object.create(null),h=!1,i=!1,j=!1,k=-1,l=-1,m=0;for(;m<a.length;m++){let n=a.charCodeAt(m);if(void 0===d)if(-1===l&&1===b[n])-1===k&&(k=m);else if(32===n||9===n)-1===l&&-1!==k&&(l=m);else if(59===n||44===n){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m);let b=a.slice(k,l);44===n?(c(f,b,g),g=Object.create(null)):d=b,k=l=-1}else throw SyntaxError(`Unexpected character at index ${m}`);else if(void 0===e)if(-1===l&&1===b[n])-1===k&&(k=m);else if(32===n||9===n)-1===l&&-1!==k&&(l=m);else if(59===n||44===n){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m),c(g,a.slice(k,l),!0),44===n&&(c(f,d,g),g=Object.create(null),d=void 0),k=l=-1}else if(61===n&&-1!==k&&-1===l)e=a.slice(k,m),k=l=-1;else throw SyntaxError(`Unexpected character at index ${m}`);else if(i){if(1!==b[n])throw SyntaxError(`Unexpected character at index ${m}`);-1===k?k=m:h||(h=!0),i=!1}else if(j)if(1===b[n])-1===k&&(k=m);else if(34===n&&-1!==k)j=!1,l=m;else if(92===n)i=!0;else throw SyntaxError(`Unexpected character at index ${m}`);else if(34===n&&61===a.charCodeAt(m-1))j=!0;else if(-1===l&&1===b[n])-1===k&&(k=m);else if(-1!==k&&(32===n||9===n))-1===l&&(l=m);else if(59===n||44===n){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m);let b=a.slice(k,l);h&&(b=b.replace(/\\/g,""),h=!1),c(g,e,b),44===n&&(c(f,d,g),g=Object.create(null),d=void 0),e=void 0,k=l=-1}else throw SyntaxError(`Unexpected character at index ${m}`)}if(-1===k||j)throw SyntaxError("Unexpected end of input");-1===l&&(l=m);let n=a.slice(k,l);return void 0===d?c(f,n,g):(void 0===e?c(g,n,!0):h?c(g,e,n.replace(/\\/g,"")):c(g,e,n),c(f,d,g)),f}}},15445:(a,b,c)=>{let d=c(94735),e=c(81630);c(55591),c(91645),c(34631);let{createHash:f}=c(55511),g=c(6220),h=c(22757),{format:i,parse:j}=c(10143),{GUID:k,kWebSocket:l}=c(5183),m=/^[+/0-9A-Za-z]{22}==$/;class n extends d{constructor(a,b){if(super(),null==(a={maxPayload:0x6400000,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...a}).port&&!a.server&&!a.noServer||null!=a.port&&(a.server||a.noServer)||a.server&&a.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=a.port?(this._server=e.createServer((a,b)=>{let c=e.STATUS_CODES[426];b.writeHead(426,{"Content-Length":c.length,"Content-Type":"text/plain"}),b.end(c)}),this._server.listen(a.port,a.host,a.backlog,b)):a.server&&(this._server=a.server),this._server){const a=this.emit.bind(this,"connection");this._removeListeners=function(a,b){for(let c of Object.keys(b))a.on(c,b[c]);return function(){for(let c of Object.keys(b))a.removeListener(c,b[c])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(b,c,d)=>{this.handleUpgrade(b,c,d,a)}})}!0===a.perMessageDeflate&&(a.perMessageDeflate={}),a.clientTracking&&(this.clients=new Set),this.options=a,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(a){if(a&&this.once("close",a),2===this._state)return void process.nextTick(o,this);if(1===this._state)return;if(this._state=1,this.clients)for(let a of this.clients)a.terminate();let b=this._server;b&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)?b.close(o.bind(void 0,this)):process.nextTick(o,this)}shouldHandle(a){if(this.options.path){let b=a.url.indexOf("?");if((-1!==b?a.url.slice(0,b):a.url)!==this.options.path)return!1}return!0}handleUpgrade(a,b,c,d){b.on("error",p);let e=void 0!==a.headers["sec-websocket-key"]&&a.headers["sec-websocket-key"].trim(),f=a.headers.upgrade,h=+a.headers["sec-websocket-version"],i={};if("GET"!==a.method||void 0===f||"websocket"!==f.toLowerCase()||!e||!m.test(e)||8!==h&&13!==h||!this.shouldHandle(a))return q(b,400);if(this.options.perMessageDeflate){let c=new g(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let b=j(a.headers["sec-websocket-extensions"]);b[g.extensionName]&&(c.accept(b[g.extensionName]),i[g.extensionName]=c)}catch(a){return q(b,400)}}if(this.options.verifyClient){let f={origin:a.headers[`${8===h?"sec-websocket-origin":"origin"}`],secure:!!(a.socket.authorized||a.socket.encrypted),req:a};if(2===this.options.verifyClient.length)return void this.options.verifyClient(f,(f,g,h,j)=>{if(!f)return q(b,g||401,h,j);this.completeUpgrade(e,i,a,b,c,d)});if(!this.options.verifyClient(f))return q(b,401)}this.completeUpgrade(e,i,a,b,c,d)}completeUpgrade(a,b,c,d,e,j){if(!d.readable||!d.writable)return d.destroy();if(d[l])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return q(d,503);let m=f("sha1").update(a+k).digest("base64"),n=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${m}`],o=new h(null),s=c.headers["sec-websocket-protocol"];if(s&&(s=s.split(",").map(r),(s=this.options.handleProtocols?this.options.handleProtocols(s,c):s[0])&&(n.push(`Sec-WebSocket-Protocol: ${s}`),o._protocol=s)),b[g.extensionName]){let a=b[g.extensionName].params,c=i({[g.extensionName]:[a]});n.push(`Sec-WebSocket-Extensions: ${c}`),o._extensions=b}this.emit("headers",n,c),d.write(n.concat("\r\n").join("\r\n")),d.removeListener("error",p),o.setSocket(d,e,this.options.maxPayload),this.clients&&(this.clients.add(o),o.on("close",()=>this.clients.delete(o))),j(o,c)}}function o(a){a._state=2,a.emit("close")}function p(){this.destroy()}function q(a,b,c,d){a.writable&&(c=c||e.STATUS_CODES[b],d={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(c),...d},a.write(`HTTP/1.1 ${b} ${e.STATUS_CODES[b]}\r
`+Object.keys(d).map(a=>`${a}: ${d[a]}`).join("\r\n")+"\r\n\r\n"+c)),a.removeListener("error",p),a.destroy()}function r(a){return a.trim()}a.exports=n},19473:(a,b,c)=>{let{Writable:d}=c(27910),e=c(6220),{BINARY_TYPES:f,EMPTY_BUFFER:g,kStatusCode:h,kWebSocket:i}=c(5183),{concat:j,toArrayBuffer:k,unmask:l}=c(81707),{isValidStatusCode:m,isValidUTF8:n}=c(67927);class o extends d{constructor(a,b,c,d){super(),this._binaryType=a||f[0],this[i]=void 0,this._extensions=b||{},this._isServer=!!c,this._maxPayload=0|d,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(a,b,c){if(8===this._opcode&&0==this._state)return c();this._bufferedBytes+=a.length,this._buffers.push(a),this.startLoop(c)}consume(a){if(this._bufferedBytes-=a,a===this._buffers[0].length)return this._buffers.shift();if(a<this._buffers[0].length){let b=this._buffers[0];return this._buffers[0]=b.slice(a),b.slice(0,a)}let b=Buffer.allocUnsafe(a);do{let c=this._buffers[0],d=b.length-a;a>=c.length?b.set(this._buffers.shift(),d):(b.set(new Uint8Array(c.buffer,c.byteOffset,a),d),this._buffers[0]=c.slice(a)),a-=c.length}while(a>0);return b}startLoop(a){let b;this._loop=!0;do switch(this._state){case 0:b=this.getInfo();break;case 1:b=this.getPayloadLength16();break;case 2:b=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:b=this.getData(a);break;default:this._loop=!1;return}while(this._loop);a(b)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let a=this.consume(2);if((48&a[0])!=0)return this._loop=!1,p(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let b=(64&a[0])==64;if(b&&!this._extensions[e.extensionName])return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(128&a[0])==128,this._opcode=15&a[0],this._payloadLength=127&a[1],0===this._opcode){if(b)return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,p(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,p(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=b}else{if(!(this._opcode>7)||!(this._opcode<11))return this._loop=!1,p(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,p(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(b)return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,p(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&a[1])==128,this._isServer){if(!this._masked)return this._loop=!1,p(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,p(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let a=this.consume(8),b=a.readUInt32BE(0);return b>2097151?(this._loop=!1,p(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*b+a.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,p(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(a){let b=g;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}b=this.consume(this._payloadLength),this._masked&&l(b,this._mask)}if(this._opcode>7)return this.controlMessage(b);if(this._compressed){this._state=5,this.decompress(b,a);return}return b.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(b)),this.dataMessage()}decompress(a,b){this._extensions[e.extensionName].decompress(a,this._fin,(a,c)=>{if(a)return b(a);if(c.length){if(this._messageLength+=c.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return b(p(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(c)}let d=this.dataMessage();if(d)return b(d);this.startLoop(b)})}dataMessage(){if(this._fin){let a=this._messageLength,b=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let c;c="nodebuffer"===this._binaryType?j(b,a):"arraybuffer"===this._binaryType?k(j(b,a)):b,this.emit("message",c)}else{let c=j(b,a);if(!n(c))return this._loop=!1,p(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",c.toString())}}this._state=0}controlMessage(a){if(8===this._opcode)if(this._loop=!1,0===a.length)this.emit("conclude",1005,""),this.end();else{if(1===a.length)return p(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");let b=a.readUInt16BE(0);if(!m(b))return p(RangeError,`invalid status code ${b}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let c=a.slice(2);if(!n(c))return p(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",b,c.toString()),this.end()}else 9===this._opcode?this.emit("ping",a):this.emit("pong",a);this._state=0}}function p(a,b,c,d,e){let f=new a(c?`Invalid WebSocket frame: ${b}`:b);return Error.captureStackTrace(f,p),f.code=e,f[h]=d,f}a.exports=o},22757:(a,b,c)=>{let d=c(94735),e=c(55591),f=c(81630),g=c(91645),h=c(34631),{randomBytes:i,createHash:j}=c(55511),{Readable:k}=c(27910),{URL:l}=c(1932),m=c(6220),n=c(19473),o=c(33457),{BINARY_TYPES:p,EMPTY_BUFFER:q,GUID:r,kStatusCode:s,kWebSocket:t,NOOP:u}=c(5183),{addEventListener:v,removeEventListener:w}=c(25402),{format:x,parse:y}=c(10143),{toBuffer:z}=c(81707),A=["CONNECTING","OPEN","CLOSING","CLOSED"],B=[8,13];class C extends d{constructor(a,b,c){super(),this._binaryType=p[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=C.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==a?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,Array.isArray(b)?b=b.join(", "):"object"==typeof b&&null!==b&&(c=b,b=void 0),function a(b,c,d,g){let h,k,n={protocolVersion:B[1],maxPayload:0x6400000,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...g,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!B.includes(n.protocolVersion))throw RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${B.join(", ")})`);c instanceof l?(h=c,b._url=c.href):(h=new l(c),b._url=c);let o="ws+unix:"===h.protocol;if(!h.host&&(!o||!h.pathname)){let a=Error(`Invalid URL: ${b.url}`);if(0!==b._redirects)return void D(b,a);throw a}let p="wss:"===h.protocol||"https:"===h.protocol,q=p?443:80,s=i(16).toString("base64"),t=p?e.get:f.get;if(n.createConnection=p?F:E,n.defaultPort=n.defaultPort||q,n.port=h.port||q,n.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,n.headers={"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":s,Connection:"Upgrade",Upgrade:"websocket",...n.headers},n.path=h.pathname+h.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(k=new m(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=x({[m.extensionName]:k.offer()})),d&&(n.headers["Sec-WebSocket-Protocol"]=d),n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(h.username||h.password)&&(n.auth=`${h.username}:${h.password}`),o){let a=n.path.split(":");n.socketPath=a[0],n.path=a[1]}if(n.followRedirects){if(0===b._redirects){b._originalUnixSocket=o,b._originalSecure=p,b._originalHostOrSocketPath=o?n.socketPath:h.host;let a=g&&g.headers;if(g={...g,headers:{}},a)for(let[b,c]of Object.entries(a))g.headers[b.toLowerCase()]=c}else{let a=o?!!b._originalUnixSocket&&n.socketPath===b._originalHostOrSocketPath:!b._originalUnixSocket&&h.host===b._originalHostOrSocketPath;a&&(!b._originalSecure||p)||(delete n.headers.authorization,delete n.headers.cookie,a||delete n.headers.host,n.auth=void 0)}n.auth&&!g.headers.authorization&&(g.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64"))}let u=b._req=t(n);n.timeout&&u.on("timeout",()=>{G(b,u,"Opening handshake has timed out")}),u.on("error",a=>{null===u||u.aborted||(u=b._req=null,D(b,a))}),u.on("response",e=>{let f=e.headers.location,h=e.statusCode;if(f&&n.followRedirects&&h>=300&&h<400){let e;if(++b._redirects>n.maxRedirects)return void G(b,u,"Maximum redirects exceeded");u.abort();try{e=new l(f,c)}catch(a){D(b,a);return}a(b,e,d,g)}else b.emit("unexpected-response",u,e)||G(b,u,`Unexpected server response: ${e.statusCode}`)}),u.on("upgrade",(a,c,e)=>{let f;if(b.emit("upgrade",a),b.readyState!==C.CONNECTING)return;u=b._req=null;let g=a.headers.upgrade;if(void 0===g||"websocket"!==g.toLowerCase())return void G(b,c,"Invalid Upgrade header");let h=j("sha1").update(s+r).digest("base64");if(a.headers["sec-websocket-accept"]!==h)return void G(b,c,"Invalid Sec-WebSocket-Accept header");let i=a.headers["sec-websocket-protocol"],l=(d||"").split(/, */);if(!d&&i?f="Server sent a subprotocol but none was requested":d&&!i?f="Server sent no subprotocol":i&&!l.includes(i)&&(f="Server sent an invalid subprotocol"),f)return void G(b,c,f);i&&(b._protocol=i);let o=a.headers["sec-websocket-extensions"];if(void 0!==o){let a;if(!k)return void G(b,c,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{a=y(o)}catch(a){G(b,c,"Invalid Sec-WebSocket-Extensions header");return}let d=Object.keys(a);if(d.length){if(1!==d.length||d[0]!==m.extensionName)return void G(b,c,"Server indicated an extension that was not requested");try{k.accept(a[m.extensionName])}catch(a){G(b,c,"Invalid Sec-WebSocket-Extensions header");return}b._extensions[m.extensionName]=k}}b.setSocket(c,e,n.maxPayload)})}(this,a,b,c)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(a){p.includes(a)&&(this._binaryType=a,this._receiver&&(this._receiver._binaryType=a))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){}set onclose(a){}get onerror(){}set onerror(a){}get onopen(){}set onopen(a){}get onmessage(){}set onmessage(a){}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(a,b,c){let d=new n(this.binaryType,this._extensions,this._isServer,c);this._sender=new o(a,this._extensions),this._receiver=d,this._socket=a,d[t]=this,a[t]=this,d.on("conclude",I),d.on("drain",J),d.on("error",K),d.on("message",M),d.on("ping",N),d.on("pong",O),a.setTimeout(0),a.setNoDelay(),b.length>0&&a.unshift(b),a.on("close",Q),a.on("data",R),a.on("end",S),a.on("error",T),this._readyState=C.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[m.extensionName]&&this._extensions[m.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(a,b){if(this.readyState!==C.CLOSED){if(this.readyState===C.CONNECTING)return G(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===C.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=C.CLOSING,this._sender.close(a,b,!this._isServer,a=>{!a&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)}}ping(a,b,c){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==C.OPEN)?H(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.ping(a||q,b,c))}pong(a,b,c){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==C.OPEN)?H(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.pong(a||q,b,c))}send(a,b,c){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof b&&(c=b,b={}),"number"==typeof a&&(a=a.toString()),this.readyState!==C.OPEN)return void H(this,a,c);let d={binary:"string"!=typeof a,mask:!this._isServer,compress:!0,fin:!0,...b};this._extensions[m.extensionName]||(d.compress=!1),this._sender.send(a||q,d,c)}terminate(){if(this.readyState!==C.CLOSED){if(this.readyState===C.CONNECTING)return G(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=C.CLOSING,this._socket.destroy())}}}function D(a,b){a._readyState=C.CLOSING,a.emit("error",b),a.emitClose()}function E(a){return a.path=a.socketPath,g.connect(a)}function F(a){return a.path=void 0,a.servername||""===a.servername||(a.servername=g.isIP(a.host)?"":a.host),h.connect(a)}function G(a,b,c){a._readyState=C.CLOSING;let d=Error(c);Error.captureStackTrace(d,G),b.setHeader?(b.abort(),b.socket&&!b.socket.destroyed&&b.socket.destroy(),b.once("abort",a.emitClose.bind(a)),a.emit("error",d)):(b.destroy(d),b.once("error",a.emit.bind(a,"error")),b.once("close",a.emitClose.bind(a)))}function H(a,b,c){if(b){let c=z(b).length;a._socket?a._sender._bufferedBytes+=c:a._bufferedAmount+=c}c&&c(Error(`WebSocket is not open: readyState ${a.readyState} (${A[a.readyState]})`))}function I(a,b){let c=this[t];c._closeFrameReceived=!0,c._closeMessage=b,c._closeCode=a,void 0!==c._socket[t]&&(c._socket.removeListener("data",R),process.nextTick(P,c._socket),1005===a?c.close():c.close(a,b))}function J(){this[t]._socket.resume()}function K(a){let b=this[t];void 0!==b._socket[t]&&(b._socket.removeListener("data",R),process.nextTick(P,b._socket),b.close(a[s])),b.emit("error",a)}function L(){this[t].emitClose()}function M(a){this[t].emit("message",a)}function N(a){let b=this[t];b.pong(a,!b._isServer,u),b.emit("ping",a)}function O(a){this[t].emit("pong",a)}function P(a){a.resume()}function Q(){let a,b=this[t];this.removeListener("close",Q),this.removeListener("data",R),this.removeListener("end",S),b._readyState=C.CLOSING,this._readableState.endEmitted||b._closeFrameReceived||b._receiver._writableState.errorEmitted||null===(a=b._socket.read())||b._receiver.write(a),b._receiver.end(),this[t]=void 0,clearTimeout(b._closeTimer),b._receiver._writableState.finished||b._receiver._writableState.errorEmitted?b.emitClose():(b._receiver.on("error",L),b._receiver.on("finish",L))}function R(a){this[t]._receiver.write(a)||this.pause()}function S(){let a=this[t];a._readyState=C.CLOSING,a._receiver.end(),this.end()}function T(){let a=this[t];this.removeListener("error",T),this.on("error",u),a&&(a._readyState=C.CLOSING,this.destroy())}Object.defineProperty(C,"CONNECTING",{enumerable:!0,value:A.indexOf("CONNECTING")}),Object.defineProperty(C.prototype,"CONNECTING",{enumerable:!0,value:A.indexOf("CONNECTING")}),Object.defineProperty(C,"OPEN",{enumerable:!0,value:A.indexOf("OPEN")}),Object.defineProperty(C.prototype,"OPEN",{enumerable:!0,value:A.indexOf("OPEN")}),Object.defineProperty(C,"CLOSING",{enumerable:!0,value:A.indexOf("CLOSING")}),Object.defineProperty(C.prototype,"CLOSING",{enumerable:!0,value:A.indexOf("CLOSING")}),Object.defineProperty(C,"CLOSED",{enumerable:!0,value:A.indexOf("CLOSED")}),Object.defineProperty(C.prototype,"CLOSED",{enumerable:!0,value:A.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(a=>{Object.defineProperty(C.prototype,a,{enumerable:!0})}),["open","error","close","message"].forEach(a=>{Object.defineProperty(C.prototype,`on${a}`,{enumerable:!0,get(){let b=this.listeners(a);for(let a=0;a<b.length;a++)if(b[a]._listener)return b[a]._listener},set(b){let c=this.listeners(a);for(let b=0;b<c.length;b++)c[b]._listener&&this.removeListener(a,c[b]);this.addEventListener(a,b)}})}),C.prototype.addEventListener=v,C.prototype.removeEventListener=w,a.exports=C},25402:a=>{class b{constructor(a,b){this.target=b,this.type=a}}class c extends b{constructor(a,b){super("message",b),this.data=a}}class d extends b{constructor(a,b,c){super("close",c),this.wasClean=c._closeFrameReceived&&c._closeFrameSent,this.reason=b,this.code=a}}class e extends b{constructor(a){super("open",a)}}class f extends b{constructor(a,b){super("error",b),this.message=a.message,this.error=a}}a.exports={addEventListener(a,b,g){if("function"!=typeof b)return;function h(a){b.call(this,new c(a,this))}function i(a,c){b.call(this,new d(a,c,this))}function j(a){b.call(this,new f(a,this))}function k(){b.call(this,new e(this))}let l=g&&g.once?"once":"on";"message"===a?(h._listener=b,this[l](a,h)):"close"===a?(i._listener=b,this[l](a,i)):"error"===a?(j._listener=b,this[l](a,j)):"open"===a?(k._listener=b,this[l](a,k)):this[l](a,b)},removeEventListener(a,b){let c=this.listeners(a);for(let d=0;d<c.length;d++)(c[d]===b||c[d]._listener===b)&&this.removeListener(a,c[d])}}},33457:(a,b,c)=>{c(91645),c(34631);let{randomFillSync:d}=c(55511),e=c(6220),{EMPTY_BUFFER:f}=c(5183),{isValidStatusCode:g}=c(67927),{mask:h,toBuffer:i}=c(81707),j=Buffer.alloc(4);class k{constructor(a,b){this._extensions=b||{},this._socket=a,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(a,b){let c=b.mask&&b.readOnly,e=b.mask?6:2,f=a.length;a.length>=65536?(e+=8,f=127):a.length>125&&(e+=2,f=126);let g=Buffer.allocUnsafe(c?a.length+e:e);return(g[0]=b.fin?128|b.opcode:b.opcode,b.rsv1&&(g[0]|=64),g[1]=f,126===f?g.writeUInt16BE(a.length,2):127===f&&(g.writeUInt32BE(0,2),g.writeUInt32BE(a.length,6)),b.mask)?(d(j,0,4),g[1]|=128,g[e-4]=j[0],g[e-3]=j[1],g[e-2]=j[2],g[e-1]=j[3],c)?(h(a,j,g,e,a.length),[g]):(h(a,j,a,0,a.length),[g,a]):[g,a]}close(a,b,c,d){let e;if(void 0===a)e=f;else if("number"==typeof a&&g(a))if(void 0===b||""===b)(e=Buffer.allocUnsafe(2)).writeUInt16BE(a,0);else{let c=Buffer.byteLength(b);if(c>123)throw RangeError("The message must not be greater than 123 bytes");(e=Buffer.allocUnsafe(2+c)).writeUInt16BE(a,0),e.write(b,2)}else throw TypeError("First argument must be a valid error code number");this._deflating?this.enqueue([this.doClose,e,c,d]):this.doClose(e,c,d)}doClose(a,b,c){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:8,mask:b,readOnly:!1}),c)}ping(a,b,c){let d=i(a);if(d.length>125)throw RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,d,b,i.readOnly,c]):this.doPing(d,b,i.readOnly,c)}doPing(a,b,c,d){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:9,mask:b,readOnly:c}),d)}pong(a,b,c){let d=i(a);if(d.length>125)throw RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,d,b,i.readOnly,c]):this.doPong(d,b,i.readOnly,c)}doPong(a,b,c,d){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:10,mask:b,readOnly:c}),d)}send(a,b,c){let d=i(a),f=this._extensions[e.extensionName],g=b.binary?2:1,h=b.compress;if(this._firstFragment?(this._firstFragment=!1,h&&f&&(h=d.length>=f._threshold),this._compress=h):(h=!1,g=0),b.fin&&(this._firstFragment=!0),f){let a={fin:b.fin,rsv1:h,opcode:g,mask:b.mask,readOnly:i.readOnly};this._deflating?this.enqueue([this.dispatch,d,this._compress,a,c]):this.dispatch(d,this._compress,a,c)}else this.sendFrame(k.frame(d,{fin:b.fin,rsv1:!1,opcode:g,mask:b.mask,readOnly:i.readOnly}),c)}dispatch(a,b,c,d){if(!b)return void this.sendFrame(k.frame(a,c),d);let f=this._extensions[e.extensionName];this._bufferedBytes+=a.length,this._deflating=!0,f.compress(a,c.fin,(b,e)=>{if(this._socket.destroyed){let a=Error("The socket was closed while data was being compressed");"function"==typeof d&&d(a);for(let b=0;b<this._queue.length;b++){let c=this._queue[b][4];"function"==typeof c&&c(a)}return}this._bufferedBytes-=a.length,this._deflating=!1,c.readOnly=!1,this.sendFrame(k.frame(e,c),d),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let a=this._queue.shift();this._bufferedBytes-=a[1].length,Reflect.apply(a[0],this,a.slice(1))}}enqueue(a){this._bufferedBytes+=a[1].length,this._queue.push(a)}sendFrame(a,b){2===a.length?(this._socket.cork(),this._socket.write(a[0]),this._socket.write(a[1],b),this._socket.uncork()):this._socket.write(a[0],b)}}a.exports=k},41982:a=>{let b=Symbol("kDone"),c=Symbol("kRun");class d{constructor(a){this[b]=()=>{this.pending--,this[c]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(a){this.jobs.push(a),this[c]()}[c](){if(this.pending!==this.concurrency&&this.jobs.length){let a=this.jobs.shift();this.pending++,a(this[b])}}}a.exports=d},67927:(a,b,c)=>{function d(a){return a>=1e3&&a<=1014&&1004!==a&&1005!==a&&1006!==a||a>=3e3&&a<=4999}function e(a){let b=a.length,c=0;for(;c<b;)if((128&a[c])==0)c++;else if((224&a[c])==192){if(c+1===b||(192&a[c+1])!=128||(254&a[c])==192)return!1;c+=2}else if((240&a[c])==224){if(c+2>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||224===a[c]&&(224&a[c+1])==128||237===a[c]&&(224&a[c+1])==160)return!1;c+=3}else{if((248&a[c])!=240||c+3>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||(192&a[c+3])!=128||240===a[c]&&(240&a[c+1])==128||244===a[c]&&a[c+1]>143||a[c]>244)return!1;c+=4}return!0}try{let b=c(88953);"object"==typeof b&&(b=b.Validation.isValidUTF8),a.exports={isValidStatusCode:d,isValidUTF8:a=>a.length<150?e(a):b(a)}}catch(b){a.exports={isValidStatusCode:d,isValidUTF8:e}}},81082:(a,b,c)=>{let d=c(22757);d.createWebSocketStream=c(2592),d.Server=c(15445),d.Receiver=c(19473),d.Sender=c(33457),a.exports=d},81707:(a,b,c)=>{let{EMPTY_BUFFER:d}=c(5183);function e(a,b){if(0===a.length)return d;if(1===a.length)return a[0];let c=Buffer.allocUnsafe(b),e=0;for(let b=0;b<a.length;b++){let d=a[b];c.set(d,e),e+=d.length}return e<b?c.slice(0,e):c}function f(a,b,c,d,e){for(let f=0;f<e;f++)c[d+f]=a[f]^b[3&f]}function g(a,b){let c=a.length;for(let d=0;d<c;d++)a[d]^=b[3&d]}function h(a){return a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}function i(a){let b;return(i.readOnly=!0,Buffer.isBuffer(a))?a:(a instanceof ArrayBuffer?b=Buffer.from(a):ArrayBuffer.isView(a)?b=Buffer.from(a.buffer,a.byteOffset,a.byteLength):(b=Buffer.from(a),i.readOnly=!1),b)}try{let b=c(68918),d=b.BufferUtil||b;a.exports={concat:e,mask(a,b,c,e,g){g<48?f(a,b,c,e,g):d.mask(a,b,c,e,g)},toArrayBuffer:h,toBuffer:i,unmask(a,b){a.length<32?g(a,b):d.unmask(a,b)}}}catch(b){a.exports={concat:e,mask:f,toArrayBuffer:h,toBuffer:i,unmask:g}}}};