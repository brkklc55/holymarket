exports.id=2946,exports.ids=[2946],exports.modules={245:(a,b,c)=>{"use strict";c.d(b,{ER:()=>f,Im:()=>i,dZ:()=>j,eX:()=>g,e_:()=>h});var d=c(25710),e=c(97109);function f(a=3){return Date.now()*Math.pow(10,a)+Math.floor(Math.random()*Math.pow(10,a))}function g(a=6){return BigInt(f(a))}function h(a,b,c){return{id:c||f(),jsonrpc:"2.0",method:a,params:b}}function i(a,b){return{id:a,jsonrpc:"2.0",result:b}}function j(a,b,c){var f,g;return{id:a,jsonrpc:"2.0",error:(f=b,g=c,void 0===f?(0,d.vG)(e.zR):("string"==typeof f&&(f=Object.assign(Object.assign({},(0,d.vG)(e.fO)),{message:f})),void 0!==g&&(f.data=g),(0,d.mE)(f.code)&&(f=(0,d.rI)(f.code)),f))}}},883:(a,b,c)=>{"use strict";c.d(b,{H:()=>d});class d{}},4457:(a,b,c)=>{"use strict";c.r(b),c.d(b,{__assign:()=>f,__asyncDelegator:()=>u,__asyncGenerator:()=>t,__asyncValues:()=>v,__await:()=>s,__awaiter:()=>k,__classPrivateFieldGet:()=>z,__classPrivateFieldSet:()=>A,__createBinding:()=>m,__decorate:()=>h,__exportStar:()=>n,__extends:()=>e,__generator:()=>l,__importDefault:()=>y,__importStar:()=>x,__makeTemplateObject:()=>w,__metadata:()=>j,__param:()=>i,__read:()=>p,__rest:()=>g,__spread:()=>q,__spreadArrays:()=>r,__values:()=>o});var d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)};function e(a,b){function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}var f=function(){return(f=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function g(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function h(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function i(a,b){return function(c,d){b(c,d,a)}}function j(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function k(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function l(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function m(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function n(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function o(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function q(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(p(arguments[b]));return a}function r(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function s(a){return this instanceof s?(this.v=a,this):new s(a)}function t(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof s?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function u(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:s(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function v(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=o(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function w(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function x(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function y(a){return a&&a.__esModule?a:{default:a}}function z(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function A(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}},4799:(a,b,c)=>{"use strict";var d=c(68273);c.o(d,"IJsonRpcProvider")&&c.d(b,{IJsonRpcProvider:function(){return d.IJsonRpcProvider}}),c.o(d,"formatJsonRpcError")&&c.d(b,{formatJsonRpcError:function(){return d.formatJsonRpcError}}),c.o(d,"formatJsonRpcRequest")&&c.d(b,{formatJsonRpcRequest:function(){return d.formatJsonRpcRequest}}),c.o(d,"formatJsonRpcResult")&&c.d(b,{formatJsonRpcResult:function(){return d.formatJsonRpcResult}}),c.o(d,"getBigIntRpcId")&&c.d(b,{getBigIntRpcId:function(){return d.getBigIntRpcId}}),c.o(d,"isHttpUrl")&&c.d(b,{isHttpUrl:function(){return d.isHttpUrl}}),c.o(d,"isJsonRpcError")&&c.d(b,{isJsonRpcError:function(){return d.isJsonRpcError}}),c.o(d,"isJsonRpcRequest")&&c.d(b,{isJsonRpcRequest:function(){return d.isJsonRpcRequest}}),c.o(d,"isJsonRpcResponse")&&c.d(b,{isJsonRpcResponse:function(){return d.isJsonRpcResponse}}),c.o(d,"isJsonRpcResult")&&c.d(b,{isJsonRpcResult:function(){return d.isJsonRpcResult}}),c.o(d,"isLocalhostUrl")&&c.d(b,{isLocalhostUrl:function(){return d.isLocalhostUrl}}),c.o(d,"isReactNative")&&c.d(b,{isReactNative:function(){return d.isReactNative}}),c.o(d,"isWsUrl")&&c.d(b,{isWsUrl:function(){return d.isWsUrl}}),c.o(d,"payloadId")&&c.d(b,{payloadId:function(){return d.payloadId}})},10272:(a,b,c)=>{"use strict";c.d(b,{IJsonRpcProvider:()=>g.kF,formatJsonRpcError:()=>f.dZ,formatJsonRpcRequest:()=>f.e_,formatJsonRpcResult:()=>f.Im,getBigIntRpcId:()=>f.eX,isHttpUrl:()=>h.q$,isJsonRpcError:()=>i.U$,isJsonRpcRequest:()=>i.p3,isJsonRpcResponse:()=>i.tq,isJsonRpcResult:()=>i.xT,isLocalhostUrl:()=>h.z,isWsUrl:()=>h.A1,parseConnectionError:()=>d.eF,payloadId:()=>f.ER}),c(97109);var d=c(25710),e=c(4799);c.o(e,"IJsonRpcProvider")&&c.d(b,{IJsonRpcProvider:function(){return e.IJsonRpcProvider}}),c.o(e,"formatJsonRpcError")&&c.d(b,{formatJsonRpcError:function(){return e.formatJsonRpcError}}),c.o(e,"formatJsonRpcRequest")&&c.d(b,{formatJsonRpcRequest:function(){return e.formatJsonRpcRequest}}),c.o(e,"formatJsonRpcResult")&&c.d(b,{formatJsonRpcResult:function(){return e.formatJsonRpcResult}}),c.o(e,"getBigIntRpcId")&&c.d(b,{getBigIntRpcId:function(){return e.getBigIntRpcId}}),c.o(e,"isHttpUrl")&&c.d(b,{isHttpUrl:function(){return e.isHttpUrl}}),c.o(e,"isJsonRpcError")&&c.d(b,{isJsonRpcError:function(){return e.isJsonRpcError}}),c.o(e,"isJsonRpcRequest")&&c.d(b,{isJsonRpcRequest:function(){return e.isJsonRpcRequest}}),c.o(e,"isJsonRpcResponse")&&c.d(b,{isJsonRpcResponse:function(){return e.isJsonRpcResponse}}),c.o(e,"isJsonRpcResult")&&c.d(b,{isJsonRpcResult:function(){return e.isJsonRpcResult}}),c.o(e,"isLocalhostUrl")&&c.d(b,{isLocalhostUrl:function(){return e.isLocalhostUrl}}),c.o(e,"isReactNative")&&c.d(b,{isReactNative:function(){return e.isReactNative}}),c.o(e,"isWsUrl")&&c.d(b,{isWsUrl:function(){return e.isWsUrl}}),c.o(e,"payloadId")&&c.d(b,{payloadId:function(){return e.payloadId}});var f=c(245),g=c(85341),h=c(33929),i=c(80257)},10534:(a,b,c)=>{"use strict";c.d(b,{X:()=>d});class d extends Error{constructor(a){super(a),Object.setPrototypeOf(this,Object.create(d.prototype)),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:d.name})}}},13149:(a,b,c)=>{"use strict";function d(a){if("string"!=typeof a)throw Error(`Cannot safe json parse value of type ${typeof a}`);try{return JSON.parse(a.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3'),(a,b)=>"string"==typeof b&&b.match(/^\d+n$/)?BigInt(b.substring(0,b.length-1)):b)}catch(b){return a}}function e(a){return"string"==typeof a?a:JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString()+"n":b)||""}c.d(b,{h:()=>e,j:()=>d})},17450:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Watch=void 0;class c{constructor(){this.timestamps=new Map}start(a){if(this.timestamps.has(a))throw Error(`Watch already started for label: ${a}`);this.timestamps.set(a,{started:Date.now()})}stop(a){let b=this.get(a);if(void 0!==b.elapsed)throw Error(`Watch already stopped for label: ${a}`);let c=Date.now()-b.started;this.timestamps.set(a,{started:b.started,elapsed:c})}get(a){let b=this.timestamps.get(a);if(void 0===b)throw Error(`No timestamp found for label: ${a}`);return b}elapsed(a){let b=this.get(a);return b.elapsed||Date.now()-b.started}}b.Watch=c,b.default=c},18030:(a,b,c)=>{"use strict";function d(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function e(a,b){return!!Array.isArray(b)&&(0===b.length||(a?b.every(a=>"string"==typeof a):b.every(a=>Number.isSafeInteger(a))))}function f(a){if("function"!=typeof a)throw Error("function expected");return!0}function g(a,b){if("string"!=typeof b)throw Error(`${a}: string expected`);return!0}function h(a){if(!Number.isSafeInteger(a))throw Error(`invalid integer: ${a}`)}function i(a){if(!Array.isArray(a))throw Error("array expected")}function j(a,b){if(!e(!0,b))throw Error(`${a}: array of strings expected`)}function k(a,b){if(!e(!1,b))throw Error(`${a}: array of numbers expected`)}function l(...a){let b=a=>a,c=(a,b)=>c=>a(b(c));return{encode:a.map(a=>a.encode).reduceRight(c,b),decode:a.map(a=>a.decode).reduce(c,b)}}function m(a){let b="string"==typeof a?a.split(""):a,c=b.length;j("alphabet",b);let d=new Map(b.map((a,b)=>[a,b]));return{encode:d=>(i(d),d.map(d=>{if(!Number.isSafeInteger(d)||d<0||d>=c)throw Error(`alphabet.encode: digit index outside alphabet "${d}". Allowed: ${a}`);return b[d]})),decode:b=>(i(b),b.map(b=>{g("alphabet.decode",b);let c=d.get(b);if(void 0===c)throw Error(`Unknown letter: "${b}". Allowed: ${a}`);return c}))}}function n(a=""){return g("join",a),{encode:b=>(j("join.decode",b),b.join(a)),decode:b=>(g("join.decode",b),b.split(a))}}function o(a,b,c){if(b<2)throw Error(`convertRadix: invalid from=${b}, base cannot be less than 2`);if(c<2)throw Error(`convertRadix: invalid to=${c}, base cannot be less than 2`);if(i(a),!a.length)return[];let d=0,e=[],f=Array.from(a,a=>{if(h(a),a<0||a>=b)throw Error(`invalid integer: ${a}`);return a}),g=f.length;for(;;){let a=0,h=!0;for(let e=d;e<g;e++){let g=f[e],i=b*a,j=i+g;if(!Number.isSafeInteger(j)||i/b!==a||j-g!==i)throw Error("convertRadix: carry overflow");let k=j/c;a=j%c;let l=Math.floor(k);if(f[e]=l,!Number.isSafeInteger(l)||l*c+a!==j)throw Error("convertRadix: carry overflow");h&&(l?h=!1:d=e)}if(e.push(a),h)break}for(let b=0;b<a.length-1&&0===a[b];b++)e.push(0);return e.reverse()}c.d(b,{RG:()=>t});let p=(a,b)=>0===b?a:p(b,a%b),q=(a,b)=>a+(b-p(a,b)),r=(()=>{let a=[];for(let b=0;b<40;b++)a.push(2**b);return a})();function s(a,b,c,d){if(i(a),b<=0||b>32)throw Error(`convertRadix2: wrong from=${b}`);if(c<=0||c>32)throw Error(`convertRadix2: wrong to=${c}`);if(q(b,c)>32)throw Error(`convertRadix2: carry overflow from=${b} to=${c} carryBits=${q(b,c)}`);let e=0,f=0,g=r[b],j=r[c]-1,k=[];for(let d of a){if(h(d),d>=g)throw Error(`convertRadix2: invalid data word=${d} from=${b}`);if(e=e<<b|d,f+b>32)throw Error(`convertRadix2: carry overflow pos=${f} from=${b}`);for(f+=b;f>=c;f-=c)k.push((e>>f-c&j)>>>0);let a=r[f];if(void 0===a)throw Error("invalid carry");e&=a-1}if(e=e<<c-f&j,!d&&f>=b)throw Error("Excess padding");if(!d&&e>0)throw Error(`Non-zero padding: ${e}`);return d&&f>0&&k.push(e>>>0),k}let t=l(function(a,b=!1){h(5),!1;if(q(8,5)>32||q(5,8)>32)throw Error("radix2: carry overflow");return{encode:a=>{if(!d(a))throw Error("radix2.encode input should be Uint8Array");return s(Array.from(a),8,5,!b)},decode:a=>(k("radix2.decode",a),Uint8Array.from(s(a,5,8,b)))}}(5),m("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),function(a,b="="){return h(5),g("padding",b),{encode(a){for(j("padding.encode",a);5*a.length%8;)a.push(b);return a},decode(a){j("padding.decode",a);let c=a.length;if(5*c%8)throw Error("padding: invalid, string should have whole number of bytes");for(;c>0&&a[c-1]===b;c--)if((c-1)*5%8==0)throw Error("padding: invalid, string has too much padding");return a.slice(0,c)}}}(5),n("")),u="function"==typeof Uint8Array.from([]).toBase64&&"function"==typeof Uint8Array.fromBase64;h(58);"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex||f(a=>{if("string"!=typeof a||a.length%2!=0)throw TypeError(`hex.decode: expected string, got ${typeof a} with length ${a.length}`);return a.toLowerCase()})},19447:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(4457).__exportStar(c(35304),b)},22525:(a,b,c)=>{"use strict";c.r(b),c.d(b,{__assign:()=>f,__asyncDelegator:()=>u,__asyncGenerator:()=>t,__asyncValues:()=>v,__await:()=>s,__awaiter:()=>k,__classPrivateFieldGet:()=>z,__classPrivateFieldSet:()=>A,__createBinding:()=>m,__decorate:()=>h,__exportStar:()=>n,__extends:()=>e,__generator:()=>l,__importDefault:()=>y,__importStar:()=>x,__makeTemplateObject:()=>w,__metadata:()=>j,__param:()=>i,__read:()=>p,__rest:()=>g,__spread:()=>q,__spreadArrays:()=>r,__values:()=>o});var d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)};function e(a,b){function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}var f=function(){return(f=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function g(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function h(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function i(a,b){return function(c,d){b(c,d,a)}}function j(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function k(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function l(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function m(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function n(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function o(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function q(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(p(arguments[b]));return a}function r(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function s(a){return this instanceof s?(this.v=a,this):new s(a)}function t(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof s?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function u(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:s(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function v(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=o(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function w(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function x(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function y(a){return a&&a.__esModule?a:{default:a}}function z(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function A(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}},22844:(a,b,c)=>{"use strict";c.d(b,{A:()=>i});var d=c(94735),e=c(13149),f=c(10272);let g=a=>a.split("?")[0],h="u">typeof WebSocket?WebSocket:"u">typeof global&&"u">typeof global.WebSocket?global.WebSocket:"u">typeof window&&"u">typeof window.WebSocket?window.WebSocket:"u">typeof self&&"u">typeof self.WebSocket?self.WebSocket:c(81082);class i{constructor(a){if(this.url=a,this.events=new d.EventEmitter,this.registering=!1,!(0,f.isWsUrl)(a))throw Error(`Provided URL is not compatible with WebSocket connection: ${a}`);this.url=a}get connected(){return"u">typeof this.socket}get connecting(){return this.registering}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async open(a=this.url){await this.register(a)}async close(){return new Promise((a,b)=>{typeof this.socket>"u"?b(Error("Connection already closed")):(this.socket.onclose=b=>{this.onClose(b),a()},this.socket.close())})}async send(a){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send((0,e.h)(a))}catch(b){this.onError(a.id,b)}}register(a=this.url){if(!(0,f.isWsUrl)(a))throw Error(`Provided URL is not compatible with WebSocket connection: ${a}`);if(this.registering){let a=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=a||this.events.listenerCount("open")>=a)&&this.events.setMaxListeners(a+1),new Promise((a,b)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),b(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return b(Error("WebSocket connection is missing or invalid"));a(this.socket)})})}return this.url=a,this.registering=!0,new Promise((b,c)=>{let d=(0,f.isReactNative)()?void 0:{rejectUnauthorized:!(0,f.isLocalhostUrl)(a)},e=new h(a,[],d);"u">typeof WebSocket||"u">typeof global&&"u">typeof global.WebSocket||"u">typeof window&&"u">typeof window.WebSocket||"u">typeof self&&"u">typeof self.WebSocket?e.onerror=a=>{c(this.emitError(a.error))}:e.on("error",a=>{c(this.emitError(a))}),e.onopen=()=>{this.onOpen(e),b(e)}})}onOpen(a){a.onmessage=a=>this.onPayload(a),a.onclose=a=>this.onClose(a),this.socket=a,this.registering=!1,this.events.emit("open")}onClose(a){this.socket=void 0,this.registering=!1,this.events.emit("close",a)}onPayload(a){if(typeof a.data>"u")return;let b="string"==typeof a.data?(0,e.j)(a.data):a.data;this.events.emit("payload",b)}onError(a,b){let c=this.parseError(b),d=c.message||c.toString(),e=(0,f.formatJsonRpcError)(a,d);this.events.emit("payload",e)}parseError(a,b=this.url){return(0,f.parseConnectionError)(a,g(b),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(a){let b=this.parseError(Error(a?.message||`WebSocket connection failed for host: ${g(this.url)}`));return this.events.emit("register_error",b),b}}},24752:(a,b,c)=>{let d=c(60976);function e(a,b,c,d,e,g){i[a]=i[a]+i[b]+e,i[d]=f(i[d]^i[a],16),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],12),i[a]=i[a]+i[b]+g,i[d]=f(i[d]^i[a],8),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],7)}function f(a,b){return a>>>b^a<<32-b}let g=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),h=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),i=new Uint32Array(16),j=new Uint32Array(16);function k(a,b){let c=0;for(c=0;c<8;c++)i[c]=a.h[c],i[c+8]=g[c];for(i[12]^=a.t,i[13]^=a.t/0x100000000,b&&(i[14]=~i[14]),c=0;c<16;c++){var d,f;j[c]=(d=a.b)[f=4*c]^d[f+1]<<8^d[f+2]<<16^d[f+3]<<24}for(c=0;c<10;c++)e(0,4,8,12,j[h[16*c+0]],j[h[16*c+1]]),e(1,5,9,13,j[h[16*c+2]],j[h[16*c+3]]),e(2,6,10,14,j[h[16*c+4]],j[h[16*c+5]]),e(3,7,11,15,j[h[16*c+6]],j[h[16*c+7]]),e(0,5,10,15,j[h[16*c+8]],j[h[16*c+9]]),e(1,6,11,12,j[h[16*c+10]],j[h[16*c+11]]),e(2,7,8,13,j[h[16*c+12]],j[h[16*c+13]]),e(3,4,9,14,j[h[16*c+14]],j[h[16*c+15]]);for(c=0;c<8;c++)a.h[c]^=i[c]^i[c+8]}function l(a,b){if(!(a>0&&a<=32))throw Error("Incorrect output length, should be in [1, 32]");let c=b?b.length:0;if(b&&!(c>0&&c<=32))throw Error("Incorrect key length, should be in [1, 32]");let d={h:new Uint32Array(g),b:new Uint8Array(64),c:0,t:0,outlen:a};return d.h[0]^=0x1010000^c<<8^a,c>0&&(m(d,b),d.c=64),d}function m(a,b){for(let c=0;c<b.length;c++)64===a.c&&(a.t+=a.c,k(a,!1),a.c=0),a.b[a.c++]=b[c]}function n(a){for(a.t+=a.c;a.c<64;)a.b[a.c++]=0;k(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c)&255;return b}function o(a,b,c){c=c||32,a=d.normalizeInput(a);let e=l(c,b);return m(e,a),n(e)}a.exports={blake2s:o,blake2sHex:function(a,b,c){let e=o(a,b,c);return d.toHex(e)},blake2sInit:l,blake2sUpdate:m,blake2sFinal:n}},25710:(a,b,c)=>{"use strict";c.d(b,{eF:()=>h,mE:()=>e,rI:()=>g,vG:()=>f});var d=c(97109);function e(a){return d.jf.includes(a)}function f(a){return Object.keys(d.Uf).includes(a)?d.Uf[a]:d.Uf[d.XW]}function g(a){let b=Object.values(d.Uf).find(b=>b.code===a);return b||d.Uf[d.XW]}function h(a,b,c){return a.message.includes("getaddrinfo ENOTFOUND")||a.message.includes("connect ECONNREFUSED")?Error(`Unavailable ${c} RPC url at ${b}`):a}},28032:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.delay=void 0,b.delay=function(a){return new Promise(b=>{setTimeout(()=>{b(!0)},a)})}},33929:(a,b,c)=>{"use strict";function d(a,b){let c=function(a){let b=a.match(RegExp(/^\w+:/,"gi"));if(b&&b.length)return b[0]}(a);return void 0!==c&&new RegExp(b).test(c)}function e(a){return d(a,"^https?:")}function f(a){return d(a,"^wss?:")}function g(a){return RegExp("wss?://localhost(:d{2,5})?").test(a)}c.d(b,{A1:()=>f,q$:()=>e,z:()=>g})},34018:(a,b,c)=>{let d=c(99731),e=c(24752);a.exports={blake2b:d.blake2b,blake2bHex:d.blake2bHex,blake2bInit:d.blake2bInit,blake2bUpdate:d.blake2bUpdate,blake2bFinal:d.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal}},34613:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});let d=c(4457);d.__exportStar(c(96867),b),d.__exportStar(c(17450),b),d.__exportStar(c(19447),b),d.__exportStar(c(80327),b)},35304:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.IWatch=void 0;class c{}b.IWatch=c},36119:(a,b,c)=>{"use strict";c.d(b,{Hn:()=>h,X3:()=>e,_j:()=>f,eN:()=>g,f7:()=>d});let d=0xffffffff;function e(a,b,c){a.setUint32(b,c/0x100000000),a.setUint32(b+4,c)}function f(a,b,c){let d=Math.floor(c/0x100000000);a.setUint32(b,d),a.setUint32(b+4,c)}function g(a,b){return 0x100000000*a.getInt32(b)+a.getUint32(b+4)}function h(a,b){return 0x100000000*a.getUint32(b)+a.getUint32(b+4)}},36498:(a,b,c)=>{"use strict";c.d(b,{g:()=>h});class d{constructor(a,b){this.type=a,this.data=b}}var e=c(10534),f=c(36119);let g={type:-1,encode:function(a){if(!(a instanceof Date))return null;{let b,c,d,e;return function({sec:a,nsec:b}){if(a>=0&&b>=0&&a<=0x3ffffffff)if(0===b&&a<=0xffffffff){let b=new Uint8Array(4);return new DataView(b.buffer).setUint32(0,a),b}else{let c=a/0x100000000,d=new Uint8Array(8),e=new DataView(d.buffer);return e.setUint32(0,b<<2|3&c),e.setUint32(4,0|a),d}{let c=new Uint8Array(12),d=new DataView(c.buffer);return d.setUint32(0,b),(0,f._j)(d,4,a),c}}((c=Math.floor((b=a.getTime())/1e3),e=Math.floor((d=(b-1e3*c)*1e6)/1e9),{sec:c+e,nsec:d-1e9*e}))}},decode:function(a){let b=function(a){let b=new DataView(a.buffer,a.byteOffset,a.byteLength);switch(a.byteLength){case 4:return{sec:b.getUint32(0),nsec:0};case 8:{let a=b.getUint32(0);return{sec:(3&a)*0x100000000+b.getUint32(4),nsec:a>>>2}}case 12:return{sec:(0,f.eN)(b,4),nsec:b.getUint32(0)};default:throw new e.X(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${a.length}`)}}(a);return new Date(1e3*b.sec+b.nsec/1e6)}};class h{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(g)}register({type:a,encode:b,decode:c}){if(a>=0)this.encoders[a]=b,this.decoders[a]=c;else{let d=-1-a;this.builtInEncoders[d]=b,this.builtInDecoders[d]=c}}tryToEncode(a,b){for(let c=0;c<this.builtInEncoders.length;c++){let e=this.builtInEncoders[c];if(null!=e){let f=e(a,b);if(null!=f)return new d(-1-c,f)}}for(let c=0;c<this.encoders.length;c++){let e=this.encoders[c];if(null!=e){let f=e(a,b);if(null!=f)return new d(c,f)}}return a instanceof d?a:null}decode(a,b,c){let e=b<0?this.builtInDecoders[-1-b]:this.decoders[b];return e?e(a,b,c):new d(b,a)}}h.defaultCodec=new h},39391:(a,b,c)=>{"use strict";c.d(b,{o0:()=>m});var d=function(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))},e=function(a,b,c){this.name=a,this.version=b,this.os=c,this.type="browser"},f=function(a){this.version=a,this.type="node",this.name="node",this.os=process.platform},g=function(a,b,c,d){this.name=a,this.version=b,this.os=c,this.bot=d,this.type="bot-device"},h=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},i=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},j=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,k=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],l=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function m(a){return a?n(a):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new i:"undefined"!=typeof navigator?n(navigator.userAgent):"undefined"!=typeof process&&process.version?new f(process.version.slice(1)):null}function n(a){var b=""!==a&&k.reduce(function(b,c){var d=c[0],e=c[1];if(b)return b;var f=e.exec(a);return!!f&&[d,f]},!1);if(!b)return null;var c=b[0],f=b[1];if("searchbot"===c)return new h;var i=f[1]&&f[1].split(".").join("_").split("_").slice(0,3);i?i.length<3&&(i=d(d([],i,!0),function(a){for(var b=[],c=0;c<a;c++)b.push("0");return b}(3-i.length),!0)):i=[];var m=i.join("."),n=function(a){for(var b=0,c=l.length;b<c;b++){var d=l[b],e=d[0];if(d[1].exec(a))return e}return null}(a),o=j.exec(a);return o&&o[1]?new g(c,m,n,o[1]):new e(c,m,n)}},42150:(a,b,c)=>{"use strict";function d(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer?new Uint8Array(a):Uint8Array.from(a)}c.d(b,{C:()=>d})},43544:(a,b,c)=>{"use strict";c.d(b,{F:()=>f});var d=c(94735),e=c(10272);class f extends e.IJsonRpcProvider{constructor(a){super(a),this.events=new d.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(a),this.connection.connected&&this.registerEventListeners()}async connect(a=this.connection){await this.open(a)}async disconnect(){await this.close()}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async request(a,b){return this.requestStrict((0,e.formatJsonRpcRequest)(a.method,a.params||[],a.id||(0,e.getBigIntRpcId)().toString()),b)}async requestStrict(a,b){return new Promise(async(c,d)=>{if(!this.connection.connected)try{await this.open()}catch(a){d(a)}this.events.on(`${a.id}`,a=>{(0,e.isJsonRpcError)(a)?d(a.error):c(a.result)});try{await this.connection.send(a,b)}catch(a){d(a)}})}setConnection(a=this.connection){return a}onPayload(a){this.events.emit("payload",a),(0,e.isJsonRpcResponse)(a)?this.events.emit(`${a.id}`,a):this.events.emit("message",{type:a.method,data:a.params})}onClose(a){a&&3e3===a.code&&this.events.emit("error",Error(`WebSocket connection closed abnormally with code: ${a.code} ${a.reason?`(${a.reason})`:""}`)),this.events.emit("disconnect")}async open(a=this.connection){this.connection===a&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof a&&(await this.connection.open(a),a=this.connection),this.connection=this.setConnection(a),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",a=>this.onPayload(a)),this.connection.on("close",a=>this.onClose(a)),this.connection.on("error",a=>this.events.emit("error",a)),this.connection.on("register_error",a=>this.onClose()),this.hasRegisteredEventListeners=!0)}}},44161:(a,b)=>{"use strict";function c(a){let b;return"undefined"!=typeof window&&void 0!==window[a]&&(b=window[a]),b}function d(a){let b=c(a);if(!b)throw Error(`${a} is not defined in Window`);return b}Object.defineProperty(b,"__esModule",{value:!0}),b.getLocalStorage=b.getLocalStorageOrThrow=b.getCrypto=b.getCryptoOrThrow=b.getLocation=b.getLocationOrThrow=b.getNavigator=b.getNavigatorOrThrow=b.getDocument=b.getDocumentOrThrow=b.getFromWindowOrThrow=b.getFromWindow=void 0,b.getFromWindow=c,b.getFromWindowOrThrow=d,b.getDocumentOrThrow=function(){return d("document")},b.getDocument=function(){return c("document")},b.getNavigatorOrThrow=function(){return d("navigator")},b.getNavigator=function(){return c("navigator")},b.getLocationOrThrow=function(){return d("location")},b.getLocation=function(){return c("location")},b.getCryptoOrThrow=function(){return d("crypto")},b.getCrypto=function(){return c("crypto")},b.getLocalStorageOrThrow=function(){return d("localStorage")},b.getLocalStorage=function(){return c("localStorage")}},45420:(a,b)=>{"use strict";function c(){return(null==global?void 0:global.crypto)||(null==global?void 0:global.msCrypto)||{}}function d(){let a=c();return a.subtle||a.webkitSubtle}Object.defineProperty(b,"__esModule",{value:!0}),b.isBrowserCryptoAvailable=b.getSubtleCrypto=b.getBrowerCrypto=void 0,b.getBrowerCrypto=c,b.getSubtleCrypto=d,b.isBrowserCryptoAvailable=function(){return!!c()&&!!d()}},47024:(a,b,c)=>{"use strict";c.d(b,{xW:()=>t,sH:()=>aR,dI:()=>aS});var d={};c.r(d),c.d(d,{identity:()=>E});var e={};c.r(e),c.d(e,{base2:()=>F});var f={};c.r(f),c.d(f,{base8:()=>G});var g={};c.r(g),c.d(g,{base10:()=>H});var h={};c.r(h),c.d(h,{base16:()=>I,base16upper:()=>J});var i={};c.r(i),c.d(i,{base32:()=>K,base32hex:()=>O,base32hexpad:()=>Q,base32hexpadupper:()=>R,base32hexupper:()=>P,base32pad:()=>M,base32padupper:()=>N,base32upper:()=>L,base32z:()=>S});var j={};c.r(j),c.d(j,{base36:()=>T,base36upper:()=>U});var k={};c.r(k),c.d(k,{base58btc:()=>V,base58flickr:()=>W});var l={};c.r(l),c.d(l,{base64:()=>X,base64pad:()=>Y,base64url:()=>Z,base64urlpad:()=>$});var m={};c.r(m),c.d(m,{base256emoji:()=>ac});var n={};c.r(n),c.d(n,{sha256:()=>an,sha512:()=>ao});var o={};c.r(o),c.d(o,{identity:()=>ap});var p={};c.r(p),c.d(p,{code:()=>ar,decode:()=>at,encode:()=>as,name:()=>aq});var q={};function r(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function s(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?r(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function t(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=s(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return r(c)}c.r(q),c.d(q,{code:()=>ax,decode:()=>az,encode:()=>ay,name:()=>aw});let u=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};new Uint8Array(0);let v=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class w{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class x{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return z(this,a)}}class y{constructor(a){this.decoders=a}or(a){return z(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let z=(a,b)=>new y({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class A{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new w(a,b,c),this.decoder=new x(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let B=({name:a,prefix:b,encode:c,decode:d})=>new A(a,b,c,d),C=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=u(c,b);return B({prefix:a,name:b,encode:d,decode:a=>v(e(a))})},D=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>B({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)}),E=B({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)}),F=D({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),G=D({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),H=C({prefix:"9",name:"base10",alphabet:"0123456789"}),I=D({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),J=D({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),K=D({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),L=D({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),M=D({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),N=D({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),O=D({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),P=D({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Q=D({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),R=D({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),S=D({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),T=C({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),U=C({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),V=C({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),W=C({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),X=D({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Y=D({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Z=D({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$=D({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),_=Array.from("\uD83D\uDE80\uD83E\uDE90☄\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09☀\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02❤\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09☺\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E✌✨\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D❣\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33✋\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13⭐✅\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6✔\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90☹\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20☝\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B⚽\uD83E\uDD19☕\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81⚡\uD83C\uDF1E\uD83C\uDF88❌✊\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C✈\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74▶➡❓\uD83D\uDC8E\uD83D\uDCB8⬇\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A⚠\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37☎\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51❄\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),aa=_.reduce((a,b,c)=>(a[c]=b,a),[]),ab=_.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]),ac=B({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=aa[b],"")},decode:function(a){let b=[];for(let c of a){let a=ab[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}});var ad=c(55511);function ae(a,b,c){b=b||[];for(var d=c=c||0;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,ae.bytes=c-d+1,b}function af(a,b){var c,d=0,b=b||0,e=0,f=b,g=a.length;do{if(f>=g)throw af.bytes=0,RangeError("Could not decode varint");c=a[f++],d+=e<28?(127&c)<<e:(127&c)*Math.pow(2,e),e+=7}while(c>=128);return af.bytes=f-b,d}let ag=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10},ah=(a,b=0)=>[af(a,b),af.bytes],ai=(a,b,c=0)=>(ae(a,b,c),b),aj=(a,b)=>{let c=b.byteLength,d=ag(a),e=d+ag(c),f=new Uint8Array(e+c);return ai(a,f,0),ai(c,f,d),f.set(b,e),new ak(a,c,b,f)};class ak{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let al=({name:a,code:b,encode:c})=>new am(a,b,c);class am{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?aj(this.code,b):b.then(a=>aj(this.code,a))}throw Error("Unknown type, must be binary type")}}let an=al({name:"sha2-256",code:18,encode:a=>v(ad.createHash("sha256").update(a).digest())}),ao=al({name:"sha2-512",code:19,encode:a=>v(ad.createHash("sha512").update(a).digest())}),ap={code:0,name:"identity",encode:v,digest:a=>aj(0,v(a))},aq="raw",ar=85,as=a=>v(a),at=a=>v(a),au=new TextEncoder,av=new TextDecoder,aw="json",ax=512,ay=a=>au.encode(JSON.stringify(a)),az=a=>JSON.parse(av.decode(a));class aA{constructor(a,b,c,d){this.code=b,this.version=a,this.multihash=c,this.bytes=d,this.byteOffset=d.byteOffset,this.byteLength=d.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:aJ,byteLength:aJ,code:aI,version:aI,multihash:aI,bytes:aI,_baseCache:aJ,asCID:aJ})}toV0(){if(0===this.version)return this;{let{code:a,multihash:b}=this;if(a!==aE)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(b.code!==aF)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return aA.createV0(b)}}toV1(){switch(this.version){case 0:{let{code:a,digest:b}=this.multihash,c=aj(a,b);return aA.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(a){var b,c;return a&&this.code===a.code&&this.version===a.version&&((b=this.multihash)===(c=a.multihash)||b.code===c.code&&b.size===c.size&&((a,b)=>{if(a===b)return!0;if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0})(b.bytes,c.bytes))}toString(a){let{bytes:b,version:c,_baseCache:d}=this;return 0===c?aC(b,d,a||V.encoder):aD(b,d,a||K.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(a){return aK(/^0\.0/,aL),!!(a&&(a[aH]||a.asCID===a))}get toBaseEncodedString(){throw Error("Deprecated, use .toString()")}get codec(){throw Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw Error('"multibaseName" property is deprecated')}get prefix(){throw Error('"prefix" property is deprecated')}static asCID(a){if(a instanceof aA)return a;if(null!=a&&a.asCID===a){let{version:b,code:c,multihash:d,bytes:e}=a;return new aA(b,c,d,e||aG(b,c,d.bytes))}if(null==a||!0!==a[aH])return null;{let{version:b,multihash:c,code:d}=a,e=(a=>{let b=v(a),[c,d]=ah(b),[e,f]=ah(b.subarray(d)),g=b.subarray(d+f);if(g.byteLength!==e)throw Error("Incorrect length");return new ak(c,e,g,b)})(c);return aA.create(b,d,e)}}static create(a,b,c){if("number"!=typeof b)throw Error("String codecs are no longer supported");switch(a){case 0:if(b===aE)return new aA(a,b,c,c.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${aE}) block encoding`);case 1:{let d=aG(a,b,c.bytes);return new aA(a,b,c,d)}default:throw Error("Invalid version")}}static createV0(a){return aA.create(0,aE,a)}static createV1(a,b){return aA.create(1,a,b)}static decode(a){let[b,c]=aA.decodeFirst(a);if(c.length)throw Error("Incorrect length");return b}static decodeFirst(a){let b=aA.inspectBytes(a),c=b.size-b.multihashSize,d=v(a.subarray(c,c+b.multihashSize));if(d.byteLength!==b.multihashSize)throw Error("Incorrect length");let e=d.subarray(b.multihashSize-b.digestSize),f=new ak(b.multihashCode,b.digestSize,e,d);return[0===b.version?aA.createV0(f):aA.createV1(b.codec,f),a.subarray(b.size)]}static inspectBytes(a){let b=0,c=()=>{let[c,d]=ah(a.subarray(b));return b+=d,c},d=c(),e=aE;if(18===d?(d=0,b=0):1===d&&(e=c()),0!==d&&1!==d)throw RangeError(`Invalid CID version ${d}`);let f=b,g=c(),h=c(),i=b+h;return{version:d,codec:e,multihashCode:g,digestSize:h,multihashSize:i-f,size:i}}static parse(a,b){let[c,d]=aB(a,b),e=aA.decode(d);return e._baseCache.set(c,a),e}}let aB=(a,b)=>{switch(a[0]){case"Q":{let c=b||V;return[V.prefix,c.decode(`${V.prefix}${a}`)]}case V.prefix:{let c=b||V;return[V.prefix,c.decode(a)]}case K.prefix:{let c=b||K;return[K.prefix,c.decode(a)]}default:if(null==b)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[a[0],b.decode(a)]}},aC=(a,b,c)=>{let{prefix:d}=c;if(d!==V.prefix)throw Error(`Cannot string encode V0 in ${c.name} encoding`);let e=b.get(d);if(null!=e)return e;{let e=c.encode(a).slice(1);return b.set(d,e),e}},aD=(a,b,c)=>{let{prefix:d}=c,e=b.get(d);if(null!=e)return e;{let e=c.encode(a);return b.set(d,e),e}},aE=112,aF=18,aG=(a,b,c)=>{let d=ag(a),e=d+ag(b),f=new Uint8Array(e+c.byteLength);return ai(a,f,0),ai(b,f,d),f.set(c,e),f},aH=Symbol.for("@ipld/js-cid/CID"),aI={writable:!1,configurable:!1,enumerable:!0},aJ={writable:!1,enumerable:!1,configurable:!1},aK=(a,b)=>{if(a.test("0.0.0-dev"))console.warn(b);else throw Error(b)},aL=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`,aM={...d,...e,...f,...g,...h,...i,...j,...k,...l,...m};function aN(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...n,...o});let aO=aN("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),aP=aN("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=s((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),aQ={utf8:aO,"utf-8":aO,hex:aM.base16,latin1:aP,ascii:aP,binary:aP,...aM};function aR(a,b="utf8"){let c=aQ[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?r(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function aS(a,b="utf8"){let c=aQ[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}},47613:(a,b,c)=>{"use strict";c.d(b,{VH:()=>j,li:()=>i});var d=c(94735),e=c(34613),f=c(883);class g extends f.H{constructor(a){super()}}let h=e.FIVE_SECONDS,i={pulse:"heartbeat_pulse"};class j extends g{constructor(a){super(a),this.events=new d.EventEmitter,this.interval=h,this.interval=a?.interval||h}static async init(a){let b=new j(a);return await b.init(),b}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,e.toMiliseconds)(this.interval))}pulse(){this.events.emit(i.pulse)}}},48157:(a,b,c)=>{"use strict";function d(a){return`${a<0?"-":""}0x${Math.abs(a).toString(16).padStart(2,"0")}`}c.d(b,{D:()=>u});var e=c(36498),f=c(36119),g=c(68821),h=c(42150);class i{constructor(a=16,b=16){this.hit=0,this.miss=0,this.maxKeyLength=a,this.maxLengthPerKey=b,this.caches=[];for(let a=0;a<this.maxKeyLength;a++)this.caches.push([])}canBeCached(a){return a>0&&a<=this.maxKeyLength}find(a,b,c){let d=this.caches[c-1];a:for(let e of d){let d=e.bytes;for(let e=0;e<c;e++)if(d[e]!==a[b+e])continue a;return e.str}return null}store(a,b){let c=this.caches[a.length-1],d={bytes:a,str:b};c.length>=this.maxLengthPerKey?c[Math.random()*c.length|0]=d:c.push(d)}decode(a,b,c){let d=this.find(a,b,c);if(null!=d)return this.hit++,d;this.miss++;let e=(0,g.Zf)(a,b,c),f=Uint8Array.prototype.slice.call(a,b,b+c);return this.store(f,e),e}}var j=c(10534);let k="array",l="map_key",m="map_value",n=a=>{if("string"==typeof a||"number"==typeof a)return a;throw new j.X("The type of key must be string or number but "+typeof a)};class o{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(a){let b=this.getUninitializedStateFromPool();b.type=k,b.position=0,b.size=a,b.array=Array(a)}pushMapState(a){let b=this.getUninitializedStateFromPool();b.type=l,b.readCount=0,b.size=a,b.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(a){if(this.stack[this.stackHeadPosition]!==a)throw Error("Invalid stack state. Released state is not on top of the stack.");a.type===k&&(a.size=0,a.array=void 0,a.position=0,a.type=void 0),(a.type===l||a.type===m)&&(a.size=0,a.map=void 0,a.readCount=0,a.type=void 0),this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}let p=new DataView(new ArrayBuffer(0)),q=new Uint8Array(p.buffer);try{p.getInt8(0)}catch(a){if(!(a instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}let r=RangeError("Insufficient data"),s=new i;class t{constructor(a){this.totalPos=0,this.pos=0,this.view=p,this.bytes=q,this.headByte=-1,this.stack=new o,this.entered=!1,this.extensionCodec=a?.extensionCodec??e.g.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.rawStrings=a?.rawStrings??!1,this.maxStrLength=a?.maxStrLength??f.f7,this.maxBinLength=a?.maxBinLength??f.f7,this.maxArrayLength=a?.maxArrayLength??f.f7,this.maxMapLength=a?.maxMapLength??f.f7,this.maxExtLength=a?.maxExtLength??f.f7,this.keyDecoder=a?.keyDecoder!==void 0?a.keyDecoder:s,this.mapKeyConverter=a?.mapKeyConverter??n}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(a){let b=(0,h.C)(a);this.bytes=b,this.view=new DataView(b.buffer,b.byteOffset,b.byteLength),this.pos=0}appendBuffer(a){if(-1!==this.headByte||this.hasRemaining(1)){let b=this.bytes.subarray(this.pos),c=(0,h.C)(a),d=new Uint8Array(b.length+c.length);d.set(b),d.set(c,b.length),this.setBuffer(d)}else this.setBuffer(a)}hasRemaining(a){return this.view.byteLength-this.pos>=a}createExtraByteError(a){let{view:b,pos:c}=this;return RangeError(`Extra ${b.byteLength-c} of ${b.byteLength} byte(s) found at buffer[${a}]`)}decode(a){if(this.entered)return this.clone().decode(a);try{this.entered=!0,this.reinitializeState(),this.setBuffer(a);let b=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return b}finally{this.entered=!1}}*decodeMulti(a){if(this.entered){let b=this.clone();yield*b.decodeMulti(a);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(a);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(a){if(this.entered)return this.clone().decodeAsync(a);try{let b;this.entered=!0;let c=!1;for await(let d of a){if(c)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(d);try{b=this.doDecodeSync(),c=!0}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}if(c){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return b}let{headByte:e,pos:f,totalPos:g}=this;throw RangeError(`Insufficient data in parsing ${d(e)} at ${g} (${f} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(a){return this.decodeMultiAsync(a,!0)}decodeStream(a){return this.decodeMultiAsync(a,!1)}async *decodeMultiAsync(a,b){if(this.entered){let c=this.clone();yield*c.decodeMultiAsync(a,b);return}try{this.entered=!0;let c=b,d=-1;for await(let e of a){if(b&&0===d)throw this.createExtraByteError(this.totalPos);this.appendBuffer(e),c&&(d=this.readArraySize(),c=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--d;);}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){b:for(;;){let a,b=this.readHeadByte();if(b>=224)a=b-256;else if(b<192)if(b<128)a=b;else if(b<144){let c=b-128;if(0!==c){this.pushMapState(c),this.complete();continue}a={}}else if(b<160){let c=b-144;if(0!==c){this.pushArrayState(c),this.complete();continue}a=[]}else{let c=b-160;a=this.decodeString(c,0)}else if(192===b)a=null;else if(194===b)a=!1;else if(195===b)a=!0;else if(202===b)a=this.readF32();else if(203===b)a=this.readF64();else if(204===b)a=this.readU8();else if(205===b)a=this.readU16();else if(206===b)a=this.readU32();else if(207===b)a=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===b)a=this.readI8();else if(209===b)a=this.readI16();else if(210===b)a=this.readI32();else if(211===b)a=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===b){let b=this.lookU8();a=this.decodeString(b,1)}else if(218===b){let b=this.lookU16();a=this.decodeString(b,2)}else if(219===b){let b=this.lookU32();a=this.decodeString(b,4)}else if(220===b){let b=this.readU16();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(221===b){let b=this.readU32();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(222===b){let b=this.readU16();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(223===b){let b=this.readU32();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(196===b){let b=this.lookU8();a=this.decodeBinary(b,1)}else if(197===b){let b=this.lookU16();a=this.decodeBinary(b,2)}else if(198===b){let b=this.lookU32();a=this.decodeBinary(b,4)}else if(212===b)a=this.decodeExtension(1,0);else if(213===b)a=this.decodeExtension(2,0);else if(214===b)a=this.decodeExtension(4,0);else if(215===b)a=this.decodeExtension(8,0);else if(216===b)a=this.decodeExtension(16,0);else if(199===b){let b=this.lookU8();a=this.decodeExtension(b,1)}else if(200===b){let b=this.lookU16();a=this.decodeExtension(b,2)}else if(201===b){let b=this.lookU32();a=this.decodeExtension(b,4)}else throw new j.X(`Unrecognized type byte: ${d(b)}`);this.complete();let c=this.stack;for(;c.length>0;){let b=c.top();if(b.type===k)if(b.array[b.position]=a,b.position++,b.position===b.size)a=b.array,c.release(b);else continue b;else if(b.type===l){if("__proto__"===a)throw new j.X("The key __proto__ is not allowed");b.key=this.mapKeyConverter(a),b.type=m;continue b}else if(b.map[b.key]=a,b.readCount++,b.readCount===b.size)a=b.map,c.release(b);else{b.key=null,b.type=l;continue b}}return a}}readHeadByte(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let a=this.readHeadByte();switch(a){case 220:return this.readU16();case 221:return this.readU32();default:if(a<160)return a-144;throw new j.X(`Unrecognized array type byte: ${d(a)}`)}}pushMapState(a){if(a>this.maxMapLength)throw new j.X(`Max length exceeded: map length (${a}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(a)}pushArrayState(a){if(a>this.maxArrayLength)throw new j.X(`Max length exceeded: array length (${a}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(a)}decodeString(a,b){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(a,b):this.decodeBinary(a,b)}decodeUtf8String(a,b){let c;if(a>this.maxStrLength)throw new j.X(`Max length exceeded: UTF-8 byte length (${a}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+b+a)throw r;let d=this.pos+b;return c=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(a)?this.keyDecoder.decode(this.bytes,d,a):(0,g._u)(this.bytes,d,a),this.pos+=b+a,c}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===l}decodeBinary(a,b){if(a>this.maxBinLength)throw new j.X(`Max length exceeded: bin length (${a}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(a+b))throw r;let c=this.pos+b,d=this.bytes.subarray(c,c+a);return this.pos+=b+a,d}decodeExtension(a,b){if(a>this.maxExtLength)throw new j.X(`Max length exceeded: ext length (${a}) > maxExtLength (${this.maxExtLength})`);let c=this.view.getInt8(this.pos+b),d=this.decodeBinary(a,b+1);return this.extensionCodec.decode(d,c,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let a=this.view.getUint8(this.pos);return this.pos++,a}readI8(){let a=this.view.getInt8(this.pos);return this.pos++,a}readU16(){let a=this.view.getUint16(this.pos);return this.pos+=2,a}readI16(){let a=this.view.getInt16(this.pos);return this.pos+=2,a}readU32(){let a=this.view.getUint32(this.pos);return this.pos+=4,a}readI32(){let a=this.view.getInt32(this.pos);return this.pos+=4,a}readU64(){let a=(0,f.Hn)(this.view,this.pos);return this.pos+=8,a}readI64(){let a=(0,f.eN)(this.view,this.pos);return this.pos+=8,a}readU64AsBigInt(){let a=this.view.getBigUint64(this.pos);return this.pos+=8,a}readI64AsBigInt(){let a=this.view.getBigInt64(this.pos);return this.pos+=8,a}readF32(){let a=this.view.getFloat32(this.pos);return this.pos+=4,a}readF64(){let a=this.view.getFloat64(this.pos);return this.pos+=8,a}}function u(a,b){return new t(b).decode(a)}},49525:(a,b,c)=>{"use strict";c.d(b,{CG:()=>d});let d={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}}},59997:(a,b,c)=>{"use strict";c.d(b,{l:()=>i});var d=c(68821),e=c(36498),f=c(36119),g=c(42150);class h{constructor(a){this.entered=!1,this.extensionCodec=a?.extensionCodec??e.g.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.maxDepth=a?.maxDepth??100,this.initialBufferSize=a?.initialBufferSize??2048,this.sortKeys=a?.sortKeys??!1,this.forceFloat32=a?.forceFloat32??!1,this.ignoreUndefined=a?.ignoreUndefined??!1,this.forceIntegerToFloat=a?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new h({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(a){if(this.entered)return this.clone().encodeSharedRef(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(a){if(this.entered)return this.clone().encode(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(a,b){if(b>this.maxDepth)throw Error(`Too deep objects in depth ${b}`);null==a?this.encodeNil():"boolean"==typeof a?this.encodeBoolean(a):"number"==typeof a?this.forceIntegerToFloat?this.encodeNumberAsFloat(a):this.encodeNumber(a):"string"==typeof a?this.encodeString(a):this.useBigInt64&&"bigint"==typeof a?this.encodeBigInt64(a):this.encodeObject(a,b)}ensureBufferSizeToWrite(a){let b=this.pos+a;this.view.byteLength<b&&this.resizeBuffer(2*b)}resizeBuffer(a){let b=new ArrayBuffer(a),c=new Uint8Array(b),d=new DataView(b);c.set(this.bytes),this.view=d,this.bytes=c}encodeNil(){this.writeU8(192)}encodeBoolean(a){!1===a?this.writeU8(194):this.writeU8(195)}encodeNumber(a){!this.forceIntegerToFloat&&Number.isSafeInteger(a)?a>=0?a<128?this.writeU8(a):a<256?(this.writeU8(204),this.writeU8(a)):a<65536?(this.writeU8(205),this.writeU16(a)):a<0x100000000?(this.writeU8(206),this.writeU32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(207),this.writeU64(a)):a>=-32?this.writeU8(224|a+32):a>=-128?(this.writeU8(208),this.writeI8(a)):a>=-32768?(this.writeU8(209),this.writeI16(a)):a>=-0x80000000?(this.writeU8(210),this.writeI32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(211),this.writeI64(a)):this.encodeNumberAsFloat(a)}encodeNumberAsFloat(a){this.forceFloat32?(this.writeU8(202),this.writeF32(a)):(this.writeU8(203),this.writeF64(a))}encodeBigInt64(a){a>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(a)):(this.writeU8(211),this.writeBigInt64(a))}writeStringHeader(a){if(a<32)this.writeU8(160+a);else if(a<256)this.writeU8(217),this.writeU8(a);else if(a<65536)this.writeU8(218),this.writeU16(a);else if(a<0x100000000)this.writeU8(219),this.writeU32(a);else throw Error(`Too long string: ${a} bytes in UTF-8`)}encodeString(a){let b=(0,d.dS)(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),(0,d.yi)(a,this.bytes,this.pos),this.pos+=b}encodeObject(a,b){let c=this.extensionCodec.tryToEncode(a,this.context);if(null!=c)this.encodeExtension(c);else if(Array.isArray(a))this.encodeArray(a,b);else if(ArrayBuffer.isView(a))this.encodeBinary(a);else if("object"==typeof a)this.encodeMap(a,b);else throw Error(`Unrecognized object: ${Object.prototype.toString.apply(a)}`)}encodeBinary(a){let b=a.byteLength;if(b<256)this.writeU8(196),this.writeU8(b);else if(b<65536)this.writeU8(197),this.writeU16(b);else if(b<0x100000000)this.writeU8(198),this.writeU32(b);else throw Error(`Too large binary: ${b}`);let c=(0,g.C)(a);this.writeU8a(c)}encodeArray(a,b){let c=a.length;if(c<16)this.writeU8(144+c);else if(c<65536)this.writeU8(220),this.writeU16(c);else if(c<0x100000000)this.writeU8(221),this.writeU32(c);else throw Error(`Too large array: ${c}`);for(let c of a)this.doEncode(c,b+1)}countWithoutUndefined(a,b){let c=0;for(let d of b)void 0!==a[d]&&c++;return c}encodeMap(a,b){let c=Object.keys(a);this.sortKeys&&c.sort();let d=this.ignoreUndefined?this.countWithoutUndefined(a,c):c.length;if(d<16)this.writeU8(128+d);else if(d<65536)this.writeU8(222),this.writeU16(d);else if(d<0x100000000)this.writeU8(223),this.writeU32(d);else throw Error(`Too large map object: ${d}`);for(let d of c){let c=a[d];this.ignoreUndefined&&void 0===c||(this.encodeString(d),this.doEncode(c,b+1))}}encodeExtension(a){if("function"==typeof a.data){let b=a.data(this.pos+6),c=b.length;if(c>=0x100000000)throw Error(`Too large extension object: ${c}`);this.writeU8(201),this.writeU32(c),this.writeI8(a.type),this.writeU8a(b);return}let b=a.data.length;if(1===b)this.writeU8(212);else if(2===b)this.writeU8(213);else if(4===b)this.writeU8(214);else if(8===b)this.writeU8(215);else if(16===b)this.writeU8(216);else if(b<256)this.writeU8(199),this.writeU8(b);else if(b<65536)this.writeU8(200),this.writeU16(b);else if(b<0x100000000)this.writeU8(201),this.writeU32(b);else throw Error(`Too large extension object: ${b}`);this.writeI8(a.type),this.writeU8a(a.data)}writeU8(a){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,a),this.pos++}writeU8a(a){let b=a.length;this.ensureBufferSizeToWrite(b),this.bytes.set(a,this.pos),this.pos+=b}writeI8(a){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,a),this.pos++}writeU16(a){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,a),this.pos+=2}writeI16(a){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,a),this.pos+=2}writeU32(a){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,a),this.pos+=4}writeI32(a){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,a),this.pos+=4}writeF32(a){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,a),this.pos+=4}writeF64(a){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,a),this.pos+=8}writeU64(a){this.ensureBufferSizeToWrite(8),(0,f.X3)(this.view,this.pos,a),this.pos+=8}writeI64(a){this.ensureBufferSizeToWrite(8),(0,f._j)(this.view,this.pos,a),this.pos+=8}writeBigUint64(a){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,a),this.pos+=8}writeBigInt64(a){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,a),this.pos+=8}}function i(a,b){return new h(b).encodeSharedRef(a)}},60460:(a,b,c)=>{let d=c(59214),e=d.default||d,f=function(a,b){return/^\/\//.test(a)&&(a="https:"+a),e.call(this,a,b)};f.ponyfill=!0,a.exports=b=f,b.fetch=f,b.Headers=d.Headers,b.Request=d.Request,b.Response=d.Response,b.default=f},60976:a=>{function b(a){return(0x100000000+a).toString(16).substring(1)}a.exports={normalizeInput:function(a){let b;if(a instanceof Uint8Array)b=a;else if("string"==typeof a)b=new TextEncoder().encode(a);else throw Error("Input must be an string, Buffer or Uint8Array");return b},toHex:function(a){return Array.prototype.map.call(a,function(a){return(a<16?"0":"")+a.toString(16)}).join("")},debugPrint:function(a,c,d){let e="\n"+a+" = ";for(let f=0;f<c.length;f+=2){if(32===d)e+=b(c[f]).toUpperCase(),e+=" ",e+=b(c[f+1]).toUpperCase();else if(64===d)e+=b(c[f+1]).toUpperCase(),e+=b(c[f]).toUpperCase();else throw Error("Invalid size "+d);f%6==4?e+="\n"+Array(a.length+4).join(" "):f<c.length-2&&(e+=" ")}console.log(e)},testSpeed:function(a,b,c){let d=new Date().getTime(),e=new Uint8Array(b);for(let a=0;a<b;a++)e[a]=a%256;let f=new Date().getTime();console.log("Generated random input in "+(f-d)+"ms"),d=f;for(let f=0;f<c;f++){let c=a(e),f=new Date().getTime(),g=f-d;d=f,console.log("Hashed in "+g+"ms: "+c.substring(0,20)+"..."),console.log(Math.round(b/1048576/(g/1e3)*100)/100+" MB PER SECOND")}}}},61478:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ONE_YEAR=b.FOUR_WEEKS=b.THREE_WEEKS=b.TWO_WEEKS=b.ONE_WEEK=b.THIRTY_DAYS=b.SEVEN_DAYS=b.FIVE_DAYS=b.THREE_DAYS=b.ONE_DAY=b.TWENTY_FOUR_HOURS=b.TWELVE_HOURS=b.SIX_HOURS=b.THREE_HOURS=b.ONE_HOUR=b.SIXTY_MINUTES=b.THIRTY_MINUTES=b.TEN_MINUTES=b.FIVE_MINUTES=b.ONE_MINUTE=b.SIXTY_SECONDS=b.THIRTY_SECONDS=b.TEN_SECONDS=b.FIVE_SECONDS=b.ONE_SECOND=void 0,b.ONE_SECOND=1,b.FIVE_SECONDS=5,b.TEN_SECONDS=10,b.THIRTY_SECONDS=30,b.SIXTY_SECONDS=60,b.ONE_MINUTE=b.SIXTY_SECONDS,b.FIVE_MINUTES=5*b.ONE_MINUTE,b.TEN_MINUTES=10*b.ONE_MINUTE,b.THIRTY_MINUTES=30*b.ONE_MINUTE,b.SIXTY_MINUTES=60*b.ONE_MINUTE,b.ONE_HOUR=b.SIXTY_MINUTES,b.THREE_HOURS=3*b.ONE_HOUR,b.SIX_HOURS=6*b.ONE_HOUR,b.TWELVE_HOURS=12*b.ONE_HOUR,b.TWENTY_FOUR_HOURS=24*b.ONE_HOUR,b.ONE_DAY=b.TWENTY_FOUR_HOURS,b.THREE_DAYS=3*b.ONE_DAY,b.FIVE_DAYS=5*b.ONE_DAY,b.SEVEN_DAYS=7*b.ONE_DAY,b.THIRTY_DAYS=30*b.ONE_DAY,b.ONE_WEEK=b.SEVEN_DAYS,b.TWO_WEEKS=2*b.ONE_WEEK,b.THREE_WEEKS=3*b.ONE_WEEK,b.FOUR_WEEKS=4*b.ONE_WEEK,b.ONE_YEAR=365*b.ONE_DAY},68273:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});let d=c(22525);d.__exportStar(c(45420),b),d.__exportStar(c(94466),b)},68821:(a,b,c)=>{"use strict";function d(a){let b=a.length,c=0,d=0;for(;d<b;){let e=a.charCodeAt(d++);if((0xffffff80&e)==0){c++;continue}if((0xfffff800&e)==0)c+=2;else{if(e>=55296&&e<=56319&&d<b){let b=a.charCodeAt(d);(64512&b)==56320&&(++d,e=((1023&e)<<10)+(1023&b)+65536)}(0xffff0000&e)==0?c+=3:c+=4}}return c}c.d(b,{Zf:()=>g,_u:()=>i,dS:()=>d,yi:()=>f});let e=new TextEncoder;function f(a,b,c){if(a.length>50)e.encodeInto(a,b.subarray(c));else!function(a,b,c){let d=a.length,e=c,f=0;for(;f<d;){let c=a.charCodeAt(f++);if((0xffffff80&c)==0){b[e++]=c;continue}if((0xfffff800&c)==0)b[e++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&f<d){let b=a.charCodeAt(f);(64512&b)==56320&&(++f,c=((1023&c)<<10)+(1023&b)+65536)}(0xffff0000&c)==0?b[e++]=c>>12&15|224:(b[e++]=c>>18&7|240,b[e++]=c>>12&63|128),b[e++]=c>>6&63|128}b[e++]=63&c|128}}(a,b,c)}function g(a,b,c){let d=b,e=d+c,f=[],g="";for(;d<e;){let b=a[d++];if((128&b)==0)f.push(b);else if((224&b)==192){let c=63&a[d++];f.push((31&b)<<6|c)}else if((240&b)==224){let c=63&a[d++],e=63&a[d++];f.push((31&b)<<12|c<<6|e)}else if((248&b)==240){let c=(7&b)<<18|(63&a[d++])<<12|(63&a[d++])<<6|63&a[d++];c>65535&&(c-=65536,f.push(c>>>10&1023|55296),c=56320|1023&c),f.push(c)}else f.push(b);f.length>=4096&&(g+=String.fromCharCode(...f),f.length=0)}return f.length>0&&(g+=String.fromCharCode(...f)),g}let h=new TextDecoder;function i(a,b,c){let d;if(!(c>200))return g(a,b,c);return d=a.subarray(b,b+c),h.decode(d)}},72946:(a,b,c)=>{"use strict";let d,e,f,g,h,i,j;c.d(b,{EthereumProvider:()=>mQ});var k,l,m,n,o=c(94735),p=c.n(o),q=c(39391),r=c(34613),s=c(44161),t=c(84116);class u extends Error{constructor(a,b={}){const c=(()=>{if(b.cause instanceof u){if(b.cause.details)return b.cause.details;if(b.cause.shortMessage)return b.cause.shortMessage}return b.cause&&"details"in b.cause&&"string"==typeof b.cause.details?b.cause.details:b.cause?.message?b.cause.message:b.details})(),d=b.cause instanceof u&&b.cause.docsPath||b.docsPath,e=`https://oxlib.sh${d??""}`;super([a||"An error occurred.",...b.metaMessages?["",...b.metaMessages]:[],...c||d?["",c?`Details: ${c}`:void 0,d?`See: ${e}`:void 0]:[]].filter(a=>"string"==typeof a).join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=b.cause,this.details=c,this.docs=e,this.docsPath=d,this.shortMessage=a}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&b.cause?a(b.cause,c):c?null:b}(this,a)}}function v(a,b){if(E(a)>b)throw new I({givenSize:E(a),maxSize:b})}function w(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;let e=a.replace("0x","");if(e.length>2*d)throw new K({size:Math.ceil(e.length/2),targetSize:d,type:"Hex"});return`0x${e["right"===c?"padEnd":"padStart"](2*d,"0")}`}function x(a,b,c){return JSON.stringify(a,(a,c)=>"function"==typeof b?b(a,c):"bigint"==typeof c?c.toString()+"#__bigint":c,c)}let y=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function z(a){return a instanceof Uint8Array?A(a):Array.isArray(a)?A(new Uint8Array(a)):a}function A(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=y[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(v(d,b.size),C(d,b.size)):d}function B(a,b={}){var c;let d,{signed:e,size:f}=b,g=BigInt(a);f?d=e?(1n<<8n*BigInt(f)-1n)-1n:2n**(8n*BigInt(f))-1n:"number"==typeof a&&(d=BigInt(Number.MAX_SAFE_INTEGER));let h="bigint"==typeof d&&e?-d-1n:0;if(d&&g>d||g<h){let b="bigint"==typeof a?"n":"";throw new F({max:d?`${d}${b}`:void 0,min:`${h}${b}`,signed:e,size:f,value:`${a}${b}`})}let i=(e&&g<0?(1n<<BigInt(8*f))+BigInt(g):g).toString(16),j=`0x${i}`;return f?(c=j,w(c,{dir:"left",size:f})):j}function C(a,b){return w(a,{dir:"right",size:b})}function D(a,b,c,d={}){let{strict:e}=d;if("number"==typeof b&&b>0&&b>E(a)-1)throw new J({offset:b,position:"start",size:E(a)});let f=`0x${a.replace("0x","").slice((b??0)*2,(c??a.length)*2)}`;return e&&function(a,b,c){if("number"==typeof b&&"number"==typeof c&&E(a)!==c-b)throw new J({offset:c,position:"end",size:E(a)})}(f,b,c),f}function E(a){return Math.ceil((a.length-2)/2)}class F extends u{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number \`${e}\` is not in safe${d?` ${8*d}-bit`:""}${c?" signed":" unsigned"} integer range ${a?`(\`${b}\` to \`${a}\`)`:`(above \`${b}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class G extends u{constructor(a){super(`Value \`${"object"==typeof a?x(a):a}\` of type \`${typeof a}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class H extends u{constructor(a){super(`Value \`${a}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class I extends u{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class J extends u{constructor({offset:a,position:b,size:c}){super(`Slice ${"start"===b?"starting":"ending"} at offset \`${a}\` is out-of-bounds (size: \`${c}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class K extends u{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}class L extends u{constructor({signature:a}){super(`Value \`${a}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${E(z(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class M extends u{constructor({value:a}){super(`Value \`${a}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class N extends u{constructor({value:a}){super(`Value \`${a}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}var O=c(12067),P=c(55656),Q=c(47441);let R=BigInt(0),S=BigInt(1);function T(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function U(a){if(!T(a))throw Error("Uint8Array expected")}function V(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}function W(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function X(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?R:BigInt("0x"+a)}let Y="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,Z=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function $(a){if(U(a),Y)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=Z[a[c]];return b}function _(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function aa(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(Y)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=_(a.charCodeAt(e)),f=_(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function ab(a){return X($(a))}function ac(a){return U(a),X($(Uint8Array.from(a).reverse()))}function ad(a,b){return aa(a.toString(16).padStart(2*b,"0"))}function ae(a,b){return ad(a,b).reverse()}function af(a,b,c){let d;if("string"==typeof b)try{d=aa(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(T(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function ag(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];U(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let ah=a=>"bigint"==typeof a&&R<=a;function ai(a,b,c){return ah(a)&&ah(b)&&ah(c)&&b<=a&&a<c}function aj(a,b,c,d){if(!ai(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let ak=a=>(S<<BigInt(a))-S,al=a=>new Uint8Array(a),am={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||T(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function an(a,b,c={}){let d=(b,c,d)=>{let e=am[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if((!d||void 0!==f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function ao(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let ap=BigInt(0),aq=BigInt(1),ar=BigInt(2),as=BigInt(3),at=BigInt(4),au=BigInt(5),av=BigInt(8);function aw(a,b){let c=a%b;return c>=ap?c:b+c}function ax(a,b,c){let d=a;for(;b-- >ap;)d*=d,d%=c;return d}function ay(a,b){if(a===ap)throw Error("invert: expected non-zero number");if(b<=ap)throw Error("invert: expected positive modulus, got "+b);let c=aw(a,b),d=b,e=ap,f=aq,g=aq,h=ap;for(;c!==ap;){let a=d/c,b=d%c,i=e-g*a,j=f-h*a;d=c,c=b,e=g,f=h,g=i,h=j}if(d!==aq)throw Error("invert: does not exist");return aw(e,b)}function az(a,b){let c=(a.ORDER+aq)/at,d=a.pow(b,c);if(!a.eql(a.sqr(d),b))throw Error("Cannot find square root");return d}function aA(a,b){let c=(a.ORDER-au)/av,d=a.mul(b,ar),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,ar),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),b))throw Error("Cannot find square root");return h}let aB=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function aC(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function aD(a,b){let c=(a.ORDER-aq)/ar,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function aE(a,b){void 0!==b&&(0,Q.Fe)(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function aF(a,b,c=!1,d={}){let e;if(a<=ap)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=aE(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:ak(f),ZERO:ap,ONE:aq,create:b=>aw(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return ap<=b&&b<a},is0:a=>a===ap,isOdd:a=>(a&aq)===aq,neg:b=>aw(-b,a),eql:(a,b)=>a===b,sqr:b=>aw(b*b,a),add:(b,c)=>aw(b+c,a),sub:(b,c)=>aw(b-c,a),mul:(b,c)=>aw(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<ap)throw Error("invalid exponent, negatives unsupported");if(c===ap)return a.ONE;if(c===aq)return b;let d=a.ONE,e=b;for(;c>ap;)c&aq&&(d=a.mul(d,e)),e=a.sqr(e),c>>=aq;return d})(h,a,b),div:(b,c)=>aw(b*ay(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>ay(b,a),sqrt:d.sqrt||(b=>(e||(e=a%at===as?az:a%av===au?aA:function(a){if(a<BigInt(3))throw Error("sqrt is not defined for small field");let b=a-aq,c=0;for(;b%ar===ap;)b/=ar,c++;let d=ar,e=aF(a);for(;1===aD(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return az;let f=e.pow(d,b),g=(b+aq)/ar;return function(a,d){if(a.is0(d))return d;if(1!==aD(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=aq<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}(a)),e(h,b))),toBytes:a=>c?ae(a,g):ad(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?ac(a):ab(a)},invertBatch:a=>aC(h,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(h)}function aG(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function aH(a){let b=aG(a);return b+Math.ceil(b/2)}let aI=BigInt(0),aJ=BigInt(1);function aK(a,b){let c=b.negate();return a?c:b}function aL(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function aM(a,b){aL(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:ak(a),maxNumber:e,shiftBy:BigInt(a)}}function aN(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=aJ);let j=b*d,k=j+Math.abs(h)-1,l=0===h;return{nextN:i,offset:k,isZero:l,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let aO=new WeakMap,aP=new WeakMap;function aQ(a){return aP.get(a)||1}function aR(a){return an(a.Fp,aB.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),an(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...aE(a.n,a.nBitLength),...a,...{p:a.Fp.ORDER}})}function aS(a){void 0!==a.lowS&&V("lowS",a.lowS),void 0!==a.prehash&&V("prehash",a.prehash)}class aT extends Error{constructor(a=""){super(a)}}let aU={Err:aT,_tlv:{encode:(a,b)=>{let{Err:c}=aU;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=W(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?W(e.length/2|128):"";return W(a)+f+e+b},decode(a,b){let{Err:c}=aU,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=aU;if(a<aV)throw new b("integer: negative integers are not allowed");let c=W(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=aU;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return ab(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=aU,e=af("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=aU,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},aV=BigInt(0),aW=BigInt(1),aX=(BigInt(2),BigInt(3)),aY=BigInt(4),aZ=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),a$=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),a_=BigInt(0),a0=BigInt(1),a1=BigInt(2),a2=(a,b)=>(a+b/a1)/b,a3=aF(aZ,void 0,void 0,{sqrt:function(a){let b=BigInt(3),c=BigInt(6),d=BigInt(11),e=BigInt(22),f=BigInt(23),g=BigInt(44),h=BigInt(88),i=a*a*a%aZ,j=i*i*a%aZ,k=ax(j,b,aZ)*j%aZ,l=ax(k,b,aZ)*j%aZ,m=ax(l,a1,aZ)*i%aZ,n=ax(m,d,aZ)*m%aZ,o=ax(n,e,aZ)*n%aZ,p=ax(o,g,aZ)*o%aZ,q=ax(p,h,aZ)*p%aZ,r=ax(q,g,aZ)*o%aZ,s=ax(r,b,aZ)*j%aZ,t=ax(s,f,aZ)*n%aZ,u=ax(t,c,aZ)*i%aZ,v=ax(u,a1,aZ);if(!a3.eql(a3.sqr(v),a))throw Error("Cannot find square root");return v}}),a4=(k={a:a_,b:BigInt(7),Fp:a3,n:a$,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:a=>{let b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-a0*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),d=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),e=BigInt("0x100000000000000000000000000000000"),f=a2(b*a,a$),g=a2(-c*a,a$),h=aw(a-f*b-g*d,a$),i=aw(-f*c-g*b,a$),j=h>e,k=i>e;if(j&&(h=a$-h),k&&(i=a$-i),h>e||i>e)throw Error("splitScalar: Endomorphism failed, k="+a);return{k1neg:j,k1:h,k2neg:k,k2:i}}}},l=O.sc,{...(e=a=>(function(a){let b,c=(an(b=aR(a),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})),{Fp:d,n:e,nByteLength:f,nBitLength:g}=c,h=d.BYTES+1,i=2*d.BYTES+1;function j(a){return aw(a,e)}let{ProjectivePoint:k,normPrivateKeyToScalar:l,weierstrassEquation:m,isWithinCurveOrder:n}=function(a){var b;let c=function(a){let b=aR(a);an(b,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...b})}(a),{Fp:d}=c,e=aF(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return ag(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}function i(a,b){let c=d.sqr(b),e=h(a);return d.eql(c,e)}if(!i(c.Gx,c.Gy))throw Error("bad curve params: generator point");let j=d.mul(d.pow(c.a,aX),aY),k=d.mul(d.sqr(c.b),BigInt(27));if(d.is0(d.add(j,k)))throw Error("bad curve params: a or b");function l(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(T(a)&&(a=$(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:ab(af("private key",a,e))}catch(b){throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=aw(b,g)),aj("private key",b,aW,g),b}function m(a){if(!(a instanceof p))throw Error("ProjectivePoint expected")}let n=ao((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),o=ao(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");if(!i(b,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class p{constructor(a,b,c){if(null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b)||d.is0(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");this.px=a,this.py=b,this.pz=c,Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof p)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?p.ZERO:new p(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=aC(d,a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(p.fromAffine)}static fromHex(a){let b=p.fromAffine(g(af("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return p.BASE.multiply(l(a))}static msm(a,b){return function(a,b,c,d){if(!Array.isArray(c))throw Error("array expected");c.forEach((b,c)=>{if(!(b instanceof a))throw Error("invalid point at index "+c)});if(!Array.isArray(d))throw Error("array of scalars expected");d.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)});let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=function(a){let b;for(b=0;a>R;a>>=S,b+=1);return b}(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=ak(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(p,e,a,b)}_setWindowSize(a){s.setWindowSize(this,a)}assertValidity(){o(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){m(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new p(this.px,d.neg(this.py),this.pz)}double(){let{a,b}=c,e=d.mul(b,aX),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(f,g);return o=d.add(o,o),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(e,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new p(i,j,k=d.add(k,k))}add(a){m(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,n=c.a,o=d.mul(c.b,aX),q=d.mul(b,g),r=d.mul(e,h),s=d.mul(f,i),t=d.add(b,e),u=d.add(g,h);t=d.mul(t,u),u=d.add(q,r),t=d.sub(t,u),u=d.add(b,f);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(q,s),u=d.sub(u,v),v=d.add(e,f),j=d.add(h,i),v=d.mul(v,j),j=d.add(r,s),v=d.sub(v,j),l=d.mul(n,u),j=d.mul(o,s),l=d.add(j,l),j=d.sub(r,l),l=d.add(r,l),k=d.mul(j,l),r=d.add(q,q),r=d.add(r,q),s=d.mul(n,s),u=d.mul(o,u),r=d.add(r,s),s=d.sub(q,s),s=d.mul(n,s),u=d.add(u,s),q=d.mul(r,u),k=d.add(k,q),q=d.mul(v,u),j=d.mul(t,j),j=d.sub(j,q),q=d.mul(t,r),l=d.mul(v,l),new p(j,k,l=d.add(l,q))}subtract(a){return this.add(a.negate())}is0(){return this.equals(p.ZERO)}wNAF(a){return s.wNAFCached(this,a,p.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;aj("scalar",a,aV,e);let f=p.ZERO;if(a===aV)return f;if(this.is0()||a===aW)return this;if(!b||s.hasPrecomputes(this))return s.wNAFCachedUnsafe(this,a,p.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,m=this;for(;h>aV||j>aV;)h&aW&&(k=k.add(m)),j&aW&&(l=l.add(m)),m=m.double(),h>>=aW,j>>=aW;return g&&(k=k.negate()),i&&(l=l.negate()),l=new p(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(aj("scalar",a,aW,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:m}=this.wNAF(i);j=s.constTimeNegate(c,j),l=s.constTimeNegate(h,l),l=new p(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(m)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return p.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=p.BASE,e=(a,b)=>b!==aV&&b!==aW&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return n(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===aW)return!0;if(b)return b(p,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===aW?this:b?b(p,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return V("isCompressed",a),this.assertValidity(),f(p,this,a)}toHex(a=!0){return V("isCompressed",a),$(this.toRawBytes(a))}}p.BASE=new p(c.Gx,c.Gy,d.ONE),p.ZERO=new p(d.ZERO,d.ONE,d.ZERO);let{endo:q,nBitLength:r}=c,s=(b=q?Math.ceil(r/2):r,{constTimeNegate:aK,hasPrecomputes:a=>1!==aQ(a),unsafeLadder(a,b,c=p.ZERO){let d=a;for(;b>aI;)b&aJ&&(c=c.add(d)),d=d.double(),b>>=aJ;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=aM(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let e=p.ZERO,f=p.BASE,g=aM(a,b);for(let a=0;a<g.windows;a++){let{nextN:b,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=aN(d,a,g);d=b,i?f=f.add(aK(k,c[l])):e=e.add(aK(j,c[h]))}return{p:e,f}},wNAFUnsafe(a,c,d,e=p.ZERO){let f=aM(a,b);for(let a=0;a<f.windows&&d!==aI;a++){let{nextN:b,offset:g,isZero:h,isNeg:i}=aN(d,a,f);if(d=b,!h){let a=c[g];e=e.add(i?a.negate():a)}}return e},getPrecomputes(a,b,c){let d=aO.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&aO.set(b,c(d))),d},wNAFCached(a,b,c){let d=aQ(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=aQ(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){aL(c,b),aP.set(a,c),aO.delete(a)}});return{CURVE:c,ProjectivePoint:p,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:function(a){return ai(a,aW,c.n)}}}({...c,toBytes(a,b,c){let e=b.toAffine(),f=d.toBytes(e.x);return(V("isCompressed",c),c)?ag(Uint8Array.from([b.hasEvenY()?2:3]),f):ag(Uint8Array.from([4]),f,d.toBytes(e.y))},fromBytes(a){let b=a.length,c=a[0],e=a.subarray(1);if(b===h&&(2===c||3===c)){let a,b=ab(e);if(!ai(b,aW,d.ORDER))throw Error("Point is not on curve");let f=m(b);try{a=d.sqrt(f)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&c)==1!=((a&aW)===aW)&&(a=d.neg(a)),{x:b,y:a}}if(b===i&&4===c)return{x:d.fromBytes(e.subarray(0,d.BYTES)),y:d.fromBytes(e.subarray(d.BYTES,2*d.BYTES))};throw Error("invalid Point, expected length of "+h+", or uncompressed "+i+", got "+b)}}),o=(a,b,c)=>ab(a.slice(b,c));class p{constructor(a,b,c){aj("r",a,aW,e),aj("s",b,aW,e),this.r=a,this.s=b,null!=c&&(this.recovery=c),Object.freeze(this)}static fromCompact(a){return new p(o(a=af("compactSignature",a,2*f),0,f),o(a,f,2*f))}static fromDER(a){let{r:b,s:c}=aU.toSig(af("DER",a));return new p(b,c)}assertValidity(){}addRecoveryBit(a){return new p(this.r,this.s,a)}recoverPublicKey(a){let{r:b,s:f,recovery:g}=this,h=s(af("msgHash",a));if(null==g||![0,1,2,3].includes(g))throw Error("recovery id invalid");let i=2===g||3===g?b+c.n:b;if(i>=d.ORDER)throw Error("recovery id 2 or 3 invalid");let l=(1&g)==0?"02":"03",m=k.fromHex(l+$(ad(i,d.BYTES))),n=ay(i,e),o=j(-h*n),p=j(f*n),q=k.BASE.multiplyAndAddUnsafe(m,o,p);if(!q)throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>e>>aW}normalizeS(){return this.hasHighS()?new p(this.r,j(-this.s),this.recovery):this}toDERRawBytes(){return aa(this.toDERHex())}toDERHex(){return aU.hexFromSig(this)}toCompactRawBytes(){return aa(this.toCompactHex())}toCompactHex(){return $(ad(this.r,f))+$(ad(this.s,f))}}function q(a){if("bigint"==typeof a)return!1;if(a instanceof k)return!0;let b=af("key",a).length,e=d.BYTES,g=e+1;if(!c.allowedPrivateKeyLengths&&f!==g)return b===g||b===2*e+1}let r=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=ab(a),c=8*a.length-g;return c>0?b>>BigInt(c):b},s=c.bits2int_modN||function(a){return j(r(a))},t=ak(g);function u(a){return aj("num < 2^"+g,a,aV,t),ad(a,f)}let v={lowS:c.lowS,prehash:!1},w={lowS:c.lowS,prehash:!1};return k.BASE._setWindowSize(8),{CURVE:c,getPublicKey:function(a,b=!0){return k.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(!0===q(a))throw Error("first arg must be private key");if(!1===q(b))throw Error("second arg must be public key");return k.fromHex(b).multiply(l(a)).toRawBytes(c)},sign:function(a,b,f=v){let{seed:g,k2sig:h}=function(a,b,f=v){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:g,randomBytes:h}=c,{lowS:i,prehash:m,extraEntropy:o}=f;null==i&&(i=!0),a=af("msgHash",a),aS(f),m&&(a=af("prehashed msgHash",g(a)));let q=s(a),t=l(b),w=[u(t),u(q)];if(null!=o&&!1!==o){let a=!0===o?h(d.BYTES):o;w.push(af("extraEntropy",a))}return{seed:ag(...w),k2sig:function(a){var b;let c=r(a);if(!n(c))return;let d=ay(c,e),f=k.BASE.multiply(c).toAffine(),g=j(f.x);if(g===aV)return;let h=j(d*j(q+g*t));if(h===aV)return;let l=2*(f.x!==g)|Number(f.y&aW),m=h;return i&&h>e>>aW&&(m=(b=h)>e>>aW?j(-b):b,l^=1),new p(g,m,l)}}}(a,b,f);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=al(a),e=al(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=al(0))=>{let b;if(e=h((b=[0],Uint8Array.from(b)),a),d=h(),0!==a.length){let b;e=h((b=[1],Uint8Array.from(b)),a),d=h()}},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return ag(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}})(c.hash.outputLen,c.nByteLength,c.hmac)(g,h)},verify:function(a,b,d,f=w){let g,h;b=af("msgHash",b),d=af("publicKey",d);let{lowS:i,prehash:l,format:m}=f;if(aS(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let n="string"==typeof a||T(a),o=!n&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!n&&!o)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(o&&(h=new p(a.r,a.s)),n){try{"compact"!==m&&(h=p.fromDER(a))}catch(a){if(!(a instanceof aU.Err))throw a}h||"der"===m||(h=p.fromCompact(a))}g=k.fromHex(d)}catch(a){return!1}if(!h||i&&h.hasHighS())return!1;l&&(b=c.hash(b));let{r:q,s:r}=h,t=s(b),u=ay(r,e),v=j(t*u),x=j(q*u),y=k.BASE.multiplyAndAddUnsafe(g,v,x)?.toAffine();return!!y&&j(y.x)===q},ProjectivePoint:k,Signature:p,utils:{isValidPrivateKey(a){try{return l(a),!0}catch(a){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let a=aH(c.n);return function(a,b,c=!1){let d=a.length,e=aG(b),f=aH(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=aw(c?ac(a):ab(a),b-aq)+aq;return c?ae(g,e):ad(g,e)}(c.randomBytes(a),c.n)},precompute:(a=8,b=k.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...k,...{hash:a,hmac:(b,...c)=>(0,P.w)(a,b,(0,Q.Id)(...c)),randomBytes:Q.po}}))(l),create:e});function a5(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}let a6=new TextEncoder;class a7 extends u{constructor(a){super(`Value \`${"object"==typeof a?x(a):a}\` of type \`${typeof a}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class a8 extends u{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class a9 extends u{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}class ba extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let bb={checksum:new ba(8192)}.checksum;var bc=c(21332);function bd(a,b={}){var c;let{as:d="string"==typeof a?"Hex":"Bytes"}=b,e=(0,bc.lY)(a instanceof Uint8Array?a:"string"==typeof a?function(a,b={}){let{size:c}=b,d=a;c&&(v(a,c),d=C(a,c));let e=d.slice(2);e.length%2&&(e=`0${e}`);let f=e.length/2,g=new Uint8Array(f);for(let a=0,b=0;a<f;a++){let c=a5(e.charCodeAt(b++)),d=a5(e.charCodeAt(b++));if(void 0===c||void 0===d)throw new u(`Invalid byte sequence ("${e[b-2]}${e[b-1]}" in "${e}").`);g[a]=16*c+d}return g}(a):(c=a)instanceof Uint8Array?c:new Uint8Array(c));return"Bytes"===d?e:A(e)}function be(a,b={}){let{compressed:c}=b,{prefix:d,x:e,y:f}=a;if(!1===c||"bigint"==typeof e&&"bigint"==typeof f){if(4!==d)throw new bh({prefix:d,cause:new bj});return}if(!0===c||"bigint"==typeof e&&void 0===f){if(3!==d&&2!==d)throw new bh({prefix:d,cause:new bi});return}throw new bg({publicKey:a})}function bf(a){if(132!==a.length&&130!==a.length&&68!==a.length)throw new bk({publicKey:a});if(130===a.length)return{prefix:4,x:BigInt(D(a,0,32)),y:BigInt(D(a,32,64))};if(132===a.length){let b=Number(D(a,0,1));return{prefix:b,x:BigInt(D(a,1,33)),y:BigInt(D(a,33,65))}}return{prefix:Number(D(a,0,1)),x:BigInt(D(a,1,33))}}class bg extends u{constructor({publicKey:a}){super(`Value \`${x(a)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class bh extends u{constructor({prefix:a,cause:b}){super(`Prefix "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class bi extends u{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class bj extends u{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class bk extends u{constructor({publicKey:a}){super(`Value \`${a}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${E(z(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let bl=/^0x[a-fA-F0-9]{40}$/;function bm(a,b={}){let{strict:c=!0}=b;if(!bl.test(a))throw new bo({address:a,cause:new bp});if(c){if(a.toLowerCase()===a)return;if(bn(a)!==a)throw new bo({address:a,cause:new bq})}}function bn(a){if(bb.has(a))return bb.get(a);bm(a,{strict:!1});let b=a.substring(2).toLowerCase(),c=bd(function(a,b={}){let{size:c}=b,d=a6.encode(a);if("number"==typeof c){var e;if(d.length>c)throw new a8({givenSize:d.length,maxSize:c});return e=d,function(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;if(a.length>d)throw new a9({size:a.length,targetSize:d,type:"Bytes"});let e=new Uint8Array(d);for(let b=0;b<d;b++){let f="right"===c;e[f?b:d-b-1]=a[f?b:a.length-b-1]}return e}(e,{dir:"right",size:c})}return d}(b),{as:"Bytes"}),d=b.split("");for(let a=0;a<40;a+=2)c[a>>1]>>4>=8&&d[a]&&(d[a]=d[a].toUpperCase()),(15&c[a>>1])>=8&&d[a+1]&&(d[a+1]=d[a+1].toUpperCase());let e=`0x${d.join("")}`;return bb.set(a,e),e}class bo extends u{constructor({address:a,cause:b}){super(`Address "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class bp extends u{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class bq extends u{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}let br=function(a){if(a.length>=255)throw TypeError("Alphabet too long");let b=new Uint8Array(256);for(let a=0;a<b.length;a++)b[a]=255;for(let c=0;c<a.length;c++){let d=a.charAt(c),e=d.charCodeAt(0);if(255!==b[e])throw TypeError(d+" is ambiguous");b[e]=c}let c=a.length,d=a.charAt(0),e=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;let f=0,g=0,h=0;for(;a[f]===d;)g++,f++;let i=(a.length-f)*e+1>>>0,j=new Uint8Array(i);for(;f<a.length;){let d=a.charCodeAt(f);if(d>255)return;let e=b[d];if(255===e)return;let g=0;for(let a=i-1;(0!==e||g<h)&&-1!==a;a--,g++)e+=c*j[a]>>>0,j[a]=e%256>>>0,e=e/256>>>0;if(0!==e)throw Error("Non-zero carry");h=g,f++}let k=i-h;for(;k!==i&&0===j[k];)k++;let l=new Uint8Array(g+(i-k)),m=g;for(;k!==i;)l[m++]=j[k++];return l}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";let e=0,g=0,h=0,i=b.length;for(;h!==i&&0===b[h];)h++,e++;let j=(i-h)*f+1>>>0,k=new Uint8Array(j);for(;h!==i;){let a=b[h],d=0;for(let b=j-1;(0!==a||d<g)&&-1!==b;b--,d++)a+=256*k[b]>>>0,k[b]=a%c>>>0,a=a/c>>>0;if(0!==a)throw Error("Non-zero carry");g=d,h++}let l=j-g;for(;l!==j&&0===k[l];)l++;let m=d.repeat(e);for(;l<j;++l)m+=a.charAt(k[l]);return m},decodeUnsafe:g,decode:function(a){let b=g(a);if(b)return b;throw Error("Non-base"+c+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var bs=c(48157),bt=c(59997),bu=c(18030),bv=c(82015),bw=c(47024),bx=c(49525),by=c(34018),bz={exports:{}};function bA(a){try{return JSON.stringify(a)}catch{return'"[Circular]"'}}let bB=function(a,b,c){var d=c&&c.stringify||bA;if("object"==typeof a&&null!==a){var e=b.length+1;if(1===e)return a;var f=Array(e);f[0]=d(a);for(var g=1;g<e;g++)f[g]=d(b[g]);return f.join(" ")}if("string"!=typeof a)return a;var h=b.length;if(0===h)return a;for(var i="",j=0,k=-1,l=a&&a.length||0,m=0;m<l;){if(37===a.charCodeAt(m)&&m+1<l){switch(k=k>-1?k:0,a.charCodeAt(m+1)){case 100:case 102:if(j>=h||null==b[j])break;k<m&&(i+=a.slice(k,m)),i+=Number(b[j]),k=m+2,m++;break;case 105:if(j>=h||null==b[j])break;k<m&&(i+=a.slice(k,m)),i+=Math.floor(Number(b[j])),k=m+2,m++;break;case 79:case 111:case 106:if(j>=h||void 0===b[j])break;k<m&&(i+=a.slice(k,m));var n=typeof b[j];if("string"===n){i+="'"+b[j]+"'",k=m+2,m++;break}if("function"===n){i+=b[j].name||"<anonymous>",k=m+2,m++;break}i+=d(b[j]),k=m+2,m++;break;case 115:if(j>=h)break;k<m&&(i+=a.slice(k,m)),i+=String(b[j]),k=m+2,m++;break;case 37:k<m&&(i+=a.slice(k,m)),i+="%",k=m+2,m++,j--}++j}++m}return -1===k?a:(k<l&&(i+=a.slice(k)),i)};bz.exports=bI;let bC=function(){function a(a){return"u">typeof a&&a}try{return"u">typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return a(self)||a(window)||a(this)||{}}}().console||{};function bD(a,b){return"silent"===a?1/0:b.levels.values[a]}let bE=Symbol("pino.logFuncs"),bF=Symbol("pino.hierarchy"),bG={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function bH(a,b){let c={logger:b,parent:a[bF]};b[bF]=c}function bI(a){var b,c,d;let e,f,g;(a=a||{}).browser=a.browser||{};let h=a.browser.transmit;if(h&&"function"!=typeof h.send)throw Error("pino: transmit option must have a send function");let i=a.browser.write||bC;a.browser.write&&(a.browser.asObject=!0);let j=a.serializers||{},k=(b=a.browser.serialize,Array.isArray(b)?b.filter(function(a){return"!stdSerializers.err"!==a}):!0===b&&Object.keys(j)),l=a.browser.serialize;Array.isArray(a.browser.serialize)&&a.browser.serialize.indexOf("!stdSerializers.err")>-1&&(l=!1);let m=Object.keys(a.customLevels||{}),n=["error","fatal","warn","info","debug","trace"].concat(m);"function"==typeof i&&n.forEach(function(a){i[a]=i}),(!1===a.enabled||a.browser.disabled)&&(a.level="silent");let o=a.level||"info",p=Object.create(i);p.log||(p.log=bP),e={},n.forEach(a=>{e[a]=i[a]?i[a]:bC[a]||bC[bG[a]||"log"]||bP}),p[bE]=e,bH({},p),Object.defineProperty(p,"levelVal",{get:function(){return bD(this.level,this)}}),Object.defineProperty(p,"level",{get:function(){return this._level},set:function(a){if("silent"!==a&&!this.levels.values[a])throw Error("unknown level "+a);this._level=a,bJ(this,q,p,"error"),bJ(this,q,p,"fatal"),bJ(this,q,p,"warn"),bJ(this,q,p,"info"),bJ(this,q,p,"debug"),bJ(this,q,p,"trace"),m.forEach(a=>{bJ(this,q,p,a)})}});let q={transmit:h,serialize:k,asObject:a.browser.asObject,asObjectBindingsOnly:a.browser.asObjectBindingsOnly,formatters:a.browser.formatters,levels:n,timestamp:"function"==typeof(c=a).timestamp?c.timestamp:!1===c.timestamp?bQ:bR,messageKey:a.messageKey||"msg",onChild:a.onChild||bP};function r(b,c,d){if(!c)throw Error("missing bindings for child Pino");d=d||{},k&&c.serializers&&(d.serializers=c.serializers);let e=d.serializers;if(k&&e){var f=Object.assign({},j,e),g=!0===a.browser.serialize?Object.keys(f):k;delete c.serializers,bK([c],g,f,this._stdErrSerialize)}function i(a){this._childLevel=(0|a._childLevel)+1,this.bindings=c,f&&(this.serializers=f,this._serialize=g),h&&(this._logEvent=bL([].concat(a._logEvent.bindings,c)))}i.prototype=this;let l=new i(this);return bH(this,l),l.child=function(...a){return r.call(this,b,...a)},l.level=d.level||this.level,b.onChild(l),l}return f=a.customLevels||{},p.levels={values:Object.assign({},bI.levels.values,f),labels:Object.assign({},bI.levels.labels,(g={},Object.keys(d=f).forEach(function(a){g[d[a]]=a}),g))},p.level=o,p.isLevelEnabled=function(a){return!!this.levels.values[a]&&this.levels.values[a]>=this.levels.values[this.level]},p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=bP,p.serializers=j,p._serialize=k,p._stdErrSerialize=l,p.child=function(...a){return r.call(this,q,...a)},h&&(p._logEvent=bL()),p}function bJ(a,b,c,d){var e,f,g,h,i,j,k;if(Object.defineProperty(a,d,{value:bD(a.level,c)>bD(d,c)?bP:c[bE][d],writable:!0,enumerable:!0,configurable:!0}),a[d]===bP){if(!b.transmit)return;let e=bD(b.transmit.level||a.level,c);if(bD(d,c)<e)return}a[d]=(e=a,f=b,g=c,h=d,i=e[bE][h],function(){let a=f.timestamp(),b=Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===bC?bC:this;for(var d=0;d<b.length;d++)b[d]=arguments[d];var j=!1;if(f.serialize&&(bK(b,this._serialize,this.serializers,this._stdErrSerialize),j=!0),f.asObject||f.formatters?i.call(c,...function(a,b,c,d,e){let{level:f,log:g=a=>a}=e.formatters||{},h=c.slice(),i=h[0],j={},k=(0|a._childLevel)+1;if((k<1&&(k=1),d&&(j.time=d),f)?Object.assign(j,f(b,a.levels.values[b])):j.level=a.levels.values[b],e.asObjectBindingsOnly){if(null!==i&&"object"==typeof i)for(;k--&&"object"==typeof h[0];)Object.assign(j,h.shift());return[g(j),...h]}if(null!==i&&"object"==typeof i){for(;k--&&"object"==typeof h[0];)Object.assign(j,h.shift());i=h.length?bB(h.shift(),h):void 0}else"string"==typeof i&&(i=bB(h.shift(),h));return void 0!==i&&(j[e.messageKey]=i),[g(j)]}(this,h,b,a,f)):i.apply(c,b),f.transmit){let c=f.transmit.level||e._level,d=bD(c,g),i=bD(h,g);if(i<d)return;!function(a,b,c,d=!1){let e=b.send,f=b.ts,g=b.methodLevel,h=b.methodValue,i=b.val,j=a._logEvent.bindings;d||bK(c,a._serialize||Object.keys(a.serializers),a.serializers,void 0===a._stdErrSerialize||a._stdErrSerialize),a._logEvent.ts=f,a._logEvent.messages=c.filter(function(a){return -1===j.indexOf(a)}),a._logEvent.level.label=g,a._logEvent.level.value=h,e(g,a._logEvent,i),a._logEvent=bL(j)}(this,{ts:a,methodLevel:h,methodValue:i,transmitLevel:c,transmitValue:g.levels.values[f.transmit.level||e._level],send:f.transmit.send,val:bD(e._level,g)},b,j)}});let l=function(a){let b=[];a.bindings&&b.push(a.bindings);let c=a[bF];for(;c.parent;)(c=c.parent).logger.bindings&&b.push(c.logger.bindings);return b.reverse()}(a);0!==l.length&&(a[d]=(j=l,k=a[d],function(){return k.apply(this,[...j,...arguments])}))}function bK(a,b,c,d){for(let e in a)if(d&&a[e]instanceof Error)a[e]=bI.stdSerializers.err(a[e]);else if("object"==typeof a[e]&&!Array.isArray(a[e])&&b)for(let d in a[e])b.indexOf(d)>-1&&d in c&&(a[e][d]=c[d](a[e][d]))}function bL(a){return{ts:0,messages:[],bindings:a||[],level:{label:"",value:0}}}function bM(a){let b={type:a.constructor.name,msg:a.message,stack:a.stack};for(let c in a)void 0===b[c]&&(b[c]=a[c]);return b}function bN(){return{}}function bO(a){return a}function bP(){}function bQ(){return!1}function bR(){return Date.now()}bI.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},bI.stdSerializers={mapHttpRequest:bN,mapHttpResponse:bN,wrapRequestSerializer:bO,wrapResponseSerializer:bO,wrapErrorSerializer:bO,req:bN,res:bN,err:bM,errWithCause:bM},bI.stdTimeFunctions=Object.assign({},{nullTime:bQ,epochTime:bR,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}}),bz.exports.default=bI,bz.exports.pino=bI;let bS="custom_context";var bT=Object.defineProperty,bU=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?bT(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class bV{constructor(a){bU(this,"nodeValue"),bU(this,"sizeInBytes"),bU(this,"next"),this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class bW{constructor(a){bU(this,"lengthInNodes"),bU(this,"sizeInBytes"),bU(this,"head"),bU(this,"tail"),bU(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new bV(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}function bX(a){return"string"==typeof a?a:JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString()+"n":b)||""}var bY=Object.defineProperty,bZ=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?bY(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class b${constructor(a,b=1024e3){bZ(this,"logs"),bZ(this,"level"),bZ(this,"levelValue"),bZ(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=a??"error",this.levelValue=bz.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=b,this.logs=new bW(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,b){b===bz.exports.levels.values.error?console.error(a):b===bz.exports.levels.values.warn?console.warn(a):b===bz.exports.levels.values.debug?console.debug(a):b===bz.exports.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append(bX({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new bW(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push(bX({extraMetadata:a})),new Blob(b,{type:"application/json"})}}var b_=Object.defineProperty;class b0{constructor(a,b=1024e3){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?b_(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"baseChunkLogger"),this.baseChunkLogger=new b$(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}downloadLogsBlobInBrowser(a){let b=URL.createObjectURL(this.logsToBlob(a)),c=document.createElement("a");c.href=b,c.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(b)}}var b1=Object.defineProperty;class b2{constructor(a,b=1024e3){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?b1(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"baseChunkLogger"),this.baseChunkLogger=new b$(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var b3=Object.defineProperty,b4=Object.defineProperties,b5=Object.getOwnPropertyDescriptors,b6=Object.getOwnPropertySymbols,b7=Object.prototype.hasOwnProperty,b8=Object.prototype.propertyIsEnumerable,b9=(a,b,c)=>b in a?b3(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,ca=(a,b)=>{for(var c in b||(b={}))b7.call(b,c)&&b9(a,c,b[c]);if(b6)for(var c of b6(b))b8.call(b,c)&&b9(a,c,b[c]);return a};function cb(a,b=bS){return a[b]||""}function cc(a,b,c=bS){let d=function(a,b,c=bS){let d=cb(a,c);return d.trim()?`${d}/${b}`:b}(a,b,c);return function(a,b,c=bS){return a[c]=b,a}(a.child({context:d}),d,c)}function cd(a){var b,c,d,e;let f,g,h,i;return"u">typeof a.loggerOverride&&"string"!=typeof a.loggerOverride?{logger:a.loggerOverride,chunkLoggerController:null}:"u">typeof window?(i=new b0(null==(d=(c=a).opts)?void 0:d.level,c.maxSizeInBytes),{logger:bz.exports((g=ca({},c.opts),h={level:"trace",browser:b4(ca({},null==(e=c.opts)?void 0:e.browser),b5({write:a=>i.write(a)}))},b4(g,b5(h)))),chunkLoggerController:i}):(f=new b2(null==(b=a.opts)?void 0:b.level,a.maxSizeInBytes),{logger:bz.exports(b4(ca({},a.opts),b5({level:"trace"})),f),chunkLoggerController:f})}function ce(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function cf(a,b=[]){let c=[];return Object.keys(a).forEach(d=>{if(b.length&&!b.includes(d))return;let e=a[d];c.push(...e.accounts)}),c}function cg(a,b){return a.includes(":")?[a]:b.chains||[]}var ch=Object.defineProperty,ci=Object.defineProperties,cj=Object.getOwnPropertyDescriptors,ck=Object.getOwnPropertySymbols,cl=Object.prototype.hasOwnProperty,cm=Object.prototype.propertyIsEnumerable,cn=(a,b,c)=>b in a?ch(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,co=(a,b)=>{for(var c in b||(b={}))cl.call(b,c)&&cn(a,c,b[c]);if(ck)for(var c of ck(b))cm.call(b,c)&&cn(a,c,b[c]);return a},cp=(a,b,c)=>cn(a,"symbol"!=typeof b?b+"":b,c);let cq="react-native",cr="node",cs="browser";function ct(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function cu(){return!(0,s.getDocument)()&&!!(0,s.getNavigator)()&&"ReactNative"===navigator.product}function cv(){return!ct()&&!!(0,s.getNavigator)()&&!!(0,s.getDocument)()}function cw(){return cu()?cq:ct()?cr:cv()?cs:"unknown"}function cx(){var a;try{return cu()&&"u">typeof global&&"u">typeof(null==global?void 0:global.Application)?null==(a=global.Application)?void 0:a.applicationId:void 0}catch{return}}function cy(){return(0,t.g)()||{name:"",description:"",url:"",icons:[""]}}function cz(a,b,c){var d;let e,f=function(){if(cw()===cq&&"u">typeof global&&"u">typeof(null==global?void 0:global.Platform)){let{OS:a,Version:b}=global.Platform;return[a,b].join("-")}let a=(0,q.o0)();if(null===a)return"unknown";let b=a.os?a.os.replace(" ","").toLowerCase():"unknown";return"browser"===a.type?[b,a.name,a.version].join("-"):[b,a.version].join("-")}(),g=(e=cw())===cs?[e,(null==(d=(0,s.getLocation)())?void 0:d.host)||"unknown"].join(":"):e;return[[a,b].join("-"),["js",c].join("-"),f,g].join("/")}function cA(a,b){return a.filter(a=>b.includes(a)).length===a.length}function cB(a){return Object.fromEntries(a.entries())}function cC(a){return new Map(Object.entries(a))}function cD(a=r.FIVE_MINUTES,b){let c,d,e,f,g=(0,r.toMiliseconds)(a||r.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function cE(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function cF(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function cG(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}function cH(a,b){return(0,r.fromMiliseconds)((b||Date.now())+(0,r.toMiliseconds)(a))}function cI(a){return Date.now()>=(0,r.toMiliseconds)(a)}function cJ(a,b){return`${a}${b?`:${b}`:""}`}function cK(a=[],b=[]){return[...new Set([...a,...b])]}async function cL({id:a,topic:b,wcDeepLink:c}){var d,e;try{if(!c)return;let f="string"==typeof c?JSON.parse(c):c,g=f?.href;if("string"!=typeof g)return;let h=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(g,a,b),i=cw();if(i===cs){let a;if(!(null!=(d=(0,s.getDocument)())&&d.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");e=h,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?("u">typeof window&&(window.TelegramWebviewProxy||window.Telegram||window.TelegramWebviewProxyProto)||e.startsWith("https://")||e.startsWith("http://"))&&(a="_blank"):a="_top",window.open(e,a,"noreferrer noopener")}else i===cq&&"u">typeof(null==global?void 0:global.Linking)&&await global.Linking.openURL(h)}catch(a){console.error(a)}}async function cM(a,b){let c="";try{if(cv()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function cN(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}function cO(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function cP(){return"u">typeof process&&"true"===process.env.IS_VITEST}function cQ(a){return Buffer.from(a,"base64").toString("utf-8")}class cR{constructor({limit:a}){cp(this,"limit"),cp(this,"set"),this.limit=a,this.set=new Set}add(a){if(!this.set.has(a)){if(this.set.size>=this.limit){let a=this.set.values().next().value;a&&this.set.delete(a)}this.set.add(a)}}has(a){return this.set.has(a)}}let cS=BigInt(0x100000000-1),cT=BigInt(32);function cU(a,b=!1){return b?{h:Number(a&cS),l:Number(a>>cT&cS)}:{h:0|Number(a>>cT&cS),l:0|Number(a&cS)}}function cV(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=cU(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let cW=(a,b,c)=>a>>>c,cX=(a,b,c)=>a<<32-c|b>>>c,cY=(a,b,c)=>a>>>c|b<<32-c,cZ=(a,b,c)=>a<<32-c|b>>>c,c$=(a,b,c)=>a<<64-c|b>>>c-32,c_=(a,b,c)=>a>>>c-32|b<<64-c;function c0(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let c1=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),c2=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,c3=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),c4=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,c5=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),c6=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,c7="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function c8(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function c9(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function da(a,...b){if(!c8(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function db(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");c9(a.outputLen),c9(a.blockLen)}function dc(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function dd(a,b){da(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function de(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function df(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function dg(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function dh(a,b){return a<<32-b|a>>>b}let di=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function dj(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let dk=di?a=>a:a=>dj(a),dl=di?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=dj(a[b]);return a},dm="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,dn=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function dp(a){if(da(a),dm)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=dn[a[c]];return b}function dq(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function dr(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(dm)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=dq(a.charCodeAt(e)),f=dq(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function ds(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function dt(a){return"string"==typeof a&&(a=ds(a)),da(a),a}function du(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];da(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class dv{}function dw(a){let b=b=>a().update(dt(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function dx(a=32){if(c7&&"function"==typeof c7.getRandomValues)return c7.getRandomValues(new Uint8Array(a));if(c7&&"function"==typeof c7.randomBytes)return Uint8Array.from(c7.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let dy=BigInt(0),dz=BigInt(1),dA=BigInt(2),dB=BigInt(7),dC=BigInt(256),dD=BigInt(113),dE=[],dF=[],dG=[];for(let a=0,b=dz,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],dE.push(2*(5*d+c)),dF.push((a+1)*(a+2)/2%64);let e=dy;for(let a=0;a<7;a++)(b=(b<<dz^(b>>dB)*dD)%dC)&dA&&(e^=dz<<(dz<<BigInt(a))-dz);dG.push(e)}let dH=cV(dG,!0),dI=dH[0],dJ=dH[1],dK=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,dL=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class dM extends dv{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,c9(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=de(this.state)}clone(){return this._cloneInto()}keccak(){dl(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=dK(f,g,1)^c[d],i=dL(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=dF[c],f=dK(b,e,d),g=dL(b,e,d),h=dE[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=dI[d],a[1]^=dJ[d]}df(c)}(this.state32,this.rounds),dl(this.state32),this.posOut=0,this.pos=0}update(a){dc(this),da(a=dt(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){dc(this,!1),da(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return c9(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(dd(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,df(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new dM(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let dN=dw(()=>new dM(136,1,32));class dO extends dv{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=dg(this.buffer)}update(a){dc(this),da(a=dt(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=dg(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){dc(this),dd(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,df(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=dg(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let dP=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),dQ=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),dR=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),dS=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),dT=new Uint32Array(64);class dU extends dO{constructor(a=32){super(64,a,8,!1),this.A=0|dP[0],this.B=0|dP[1],this.C=0|dP[2],this.D=0|dP[3],this.E=0|dP[4],this.F=0|dP[5],this.G=0|dP[6],this.H=0|dP[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)dT[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=dT[a-15],c=dT[a-2],d=dh(b,7)^dh(b,18)^b>>>3,e=dh(c,17)^dh(c,19)^c>>>10;dT[a]=e+dT[a-7]+d+dT[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(dh(g,6)^dh(g,11)^dh(g,25))+((k=g)&h^~k&i)+dS[a]+dT[a]|0,o=(dh(c,2)^dh(c,13)^dh(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){df(dT)}destroy(){this.set(0,0,0,0,0,0,0,0),df(this.buffer)}}let dV=cV(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),dW=dV[0],dX=dV[1],dY=new Uint32Array(80),dZ=new Uint32Array(80);class d$ extends dO{constructor(a=64){super(128,a,16,!1),this.Ah=0|dR[0],this.Al=0|dR[1],this.Bh=0|dR[2],this.Bl=0|dR[3],this.Ch=0|dR[4],this.Cl=0|dR[5],this.Dh=0|dR[6],this.Dl=0|dR[7],this.Eh=0|dR[8],this.El=0|dR[9],this.Fh=0|dR[10],this.Fl=0|dR[11],this.Gh=0|dR[12],this.Gl=0|dR[13],this.Hh=0|dR[14],this.Hl=0|dR[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)dY[c]=a.getUint32(b),dZ[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|dY[a-15],c=0|dZ[a-15],d=cY(b,c,1)^cY(b,c,8)^cW(b,c,7),e=cZ(b,c,1)^cZ(b,c,8)^cX(b,c,7),f=0|dY[a-2],g=0|dZ[a-2],h=cY(f,g,19)^c$(f,g,61)^cW(f,g,6),i=c3(e,cZ(f,g,19)^c_(f,g,61)^cX(f,g,6),dZ[a-7],dZ[a-16]),j=c4(i,d,h,dY[a-7],dY[a-16]);dY[a]=0|j,dZ[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=cY(k,l,14)^cY(k,l,18)^c$(k,l,41),s=cZ(k,l,14)^cZ(k,l,18)^c_(k,l,41),t=k&m^~k&o,u=c5(r,s,l&n^~l&p,dX[a],dZ[a]),v=c6(u,q,b,t,dW[a],dY[a]),w=0|u,x=cY(c,d,28)^c$(c,d,34)^c$(c,d,39),y=cZ(c,d,28)^c_(c,d,34)^c_(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=c0(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=c1(w,y,A);c=c2(B,v,x,z),d=0|B}({h:c,l:d}=c0(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=c0(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=c0(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=c0(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=c0(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=c0(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=c0(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=c0(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){df(dY,dZ)}destroy(){df(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class d_ extends d${constructor(){super(48),this.Ah=0|dQ[0],this.Al=0|dQ[1],this.Bh=0|dQ[2],this.Bl=0|dQ[3],this.Ch=0|dQ[4],this.Cl=0|dQ[5],this.Dh=0|dQ[6],this.Dl=0|dQ[7],this.Eh=0|dQ[8],this.El=0|dQ[9],this.Fh=0|dQ[10],this.Fl=0|dQ[11],this.Gh=0|dQ[12],this.Gl=0|dQ[13],this.Hh=0|dQ[14],this.Hl=0|dQ[15]}}let d0=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class d1 extends d${constructor(){super(32),this.Ah=0|d0[0],this.Al=0|d0[1],this.Bh=0|d0[2],this.Bl=0|d0[3],this.Ch=0|d0[4],this.Cl=0|d0[5],this.Dh=0|d0[6],this.Dl=0|d0[7],this.Eh=0|d0[8],this.El=0|d0[9],this.Fh=0|d0[10],this.Fl=0|d0[11],this.Gh=0|d0[12],this.Gl=0|d0[13],this.Hh=0|d0[14],this.Hl=0|d0[15]}}let d2=dw(()=>new dU),d3=dw(()=>new d$),d4=dw(()=>new d_),d5=dw(()=>new d1),d6=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),d7=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),d8=new Uint32Array(32);function d9(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=d8[2*a],j=d8[2*a+1],k=d8[2*b],l=d8[2*b+1],m=d8[2*c],n=d8[2*c+1],o=d8[2*d],p=d8[2*d+1],q=c1(i,k,g);j=c2(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:o,Dl:p}),({h:n,l:m}=c0(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:cY(l,k,24),Bl:cZ(l,k,24)}),d8[2*a]=i,d8[2*a+1]=j,d8[2*b]=k,d8[2*b+1]=l,d8[2*c]=m,d8[2*c+1]=n,d8[2*d]=o,d8[2*d+1]=p}function ea(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=d8[2*a],j=d8[2*a+1],k=d8[2*b],l=d8[2*b+1],m=d8[2*c],n=d8[2*c+1],o=d8[2*d],p=d8[2*d+1],q=c1(i,k,g);j=c2(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:cY(p,o,16),Dl:cZ(p,o,16)}),({h:n,l:m}=c0(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:c$(l,k,63),Bl:c_(l,k,63)}),d8[2*a]=i,d8[2*a+1]=j,d8[2*b]=k,d8[2*b+1]=l,d8[2*c]=m,d8[2*c+1]=n,d8[2*d]=o,d8[2*d+1]=p}class eb extends dv{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,c9(a),c9(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=de(this.buffer)}update(a){dc(this),da(a=dt(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(dl(d),this.compress(d,0,!1),dl(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));dl(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);dl(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){dc(this),dd(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,df(this.buffer.subarray(b)),dl(c),this.compress(c,0,!0),dl(c);let d=de(a);this.get().forEach((a,b)=>d[b]=dk(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class ec extends eb{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|d7[0],this.v0h=0|d7[1],this.v1l=0|d7[2],this.v1h=0|d7[3],this.v2l=0|d7[4],this.v2h=0|d7[5],this.v3l=0|d7[6],this.v3h=0|d7[7],this.v4l=0|d7[8],this.v4h=0|d7[9],this.v5l=0|d7[10],this.v5h=0|d7[11],this.v6l=0|d7[12],this.v6h=0|d7[13],this.v7l=0|d7[14],this.v7h=0|d7[15],function(a,b={},c,d,e){if(c9(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=dt(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=de(e=dt(e));this.v4l^=dk(a[0]),this.v4h^=dk(a[1]),this.v5l^=dk(a[2]),this.v5h^=dk(a[3])}if(void 0!==d){const a=de(d=dt(d));this.v6l^=dk(a[0]),this.v6h^=dk(a[1]),this.v7l^=dk(a[2]),this.v7h^=dk(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:n,v7l:o,v7h:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|n,this.v7l=0|o,this.v7h=0|p}compress(a,b,c){this.get().forEach((a,b)=>d8[b]=a),d8.set(d7,16);let{h:d,l:e}=cU(BigInt(this.length));d8[24]=d7[8]^e,d8[25]=d7[9]^d,c&&(d8[28]=~d8[28],d8[29]=~d8[29]);let f=0;for(let c=0;c<12;c++)d9(0,4,8,12,a,b+2*d6[f++]),ea(0,4,8,12,a,b+2*d6[f++]),d9(1,5,9,13,a,b+2*d6[f++]),ea(1,5,9,13,a,b+2*d6[f++]),d9(2,6,10,14,a,b+2*d6[f++]),ea(2,6,10,14,a,b+2*d6[f++]),d9(3,7,11,15,a,b+2*d6[f++]),ea(3,7,11,15,a,b+2*d6[f++]),d9(0,5,10,15,a,b+2*d6[f++]),ea(0,5,10,15,a,b+2*d6[f++]),d9(1,6,11,12,a,b+2*d6[f++]),ea(1,6,11,12,a,b+2*d6[f++]),d9(2,7,8,13,a,b+2*d6[f++]),ea(2,7,8,13,a,b+2*d6[f++]),d9(3,4,9,14,a,b+2*d6[f++]),ea(3,4,9,14,a,b+2*d6[f++]);this.v0l^=d8[0]^d8[16],this.v0h^=d8[1]^d8[17],this.v1l^=d8[2]^d8[18],this.v1h^=d8[3]^d8[19],this.v2l^=d8[4]^d8[20],this.v2h^=d8[5]^d8[21],this.v3l^=d8[6]^d8[22],this.v3h^=d8[7]^d8[23],this.v4l^=d8[8]^d8[24],this.v4h^=d8[9]^d8[25],this.v5l^=d8[10]^d8[26],this.v5h^=d8[11]^d8[27],this.v6l^=d8[12]^d8[28],this.v6h^=d8[13]^d8[29],this.v7l^=d8[14]^d8[30],this.v7h^=d8[15]^d8[31],df(d8)}destroy(){this.destroyed=!0,df(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let ed=(m=a=>new ec(a),(f=(a,b)=>m(b).update(dt(a)).digest()).outputLen=(g=m({})).outputLen,f.blockLen=g.blockLen,f.create=a=>m(a),f);function ee(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(dN(c)).toString("hex")}async function ef(a,b,c,d,e,f){switch(c.t){case"eip191":var g,h;let i;return await (g=a,h=b,i=function(a){if(130!==a.length&&132!==a.length)throw new L({signature:a});let b=BigInt(D(a,0,32)),c=BigInt(D(a,32,64)),d=(()=>{let b=Number(`0x${a.slice(130)}`);if(!Number.isNaN(b))try{var c=b;if(0===c||27===c)return 0;if(1===c||28===c)return 1;if(c>=35)return+(c%2==0);throw new N({value:c})}catch{throw new M({value:b})}})();return void 0===d?{r:b,s:c}:{r:b,s:c,yParity:d}}(c.s),(function(a,b={}){let c=bd(`0x${(function(a,b={}){be(a);let{prefix:c,x:d,y:e}=a,{includePrefix:f=!0}=b;return function(...a){return`0x${a.reduce((a,b)=>a+b.replace("0x",""),"")}`}(f?B(c,{size:1}):"0x",B(d,{size:32}),"bigint"==typeof e?B(e,{size:32}):"0x")})(a).slice(4)}`).substring(26);return function(a,b={}){let{checksum:c=!1}=b;return(bm(a),c)?bn(a):a}(`0x${c}`,b)})(function(a){var b;let c,{payload:d,signature:e}=a,{r:f,s:g,yParity:h}=e;return b=new a4.Signature(BigInt(f),BigInt(g)).addRecoveryBit(h).recoverPublicKey(z(d).substring(2)),be(c=(()=>{if(function(a,b={}){let{strict:c=!1}=b;try{return!function(a,b={}){let{strict:c=!1}=b;if(!a||"string"!=typeof a)throw new G(a);if(c&&!/^0x[0-9a-fA-F]*$/.test(a)||!a.startsWith("0x"))throw new H(a)}(a,{strict:c}),!0}catch{return!1}}(b))return bf(b);if(function(a){try{if(!(a instanceof Uint8Array)&&(!a||"object"!=typeof a||!("BYTES_PER_ELEMENT"in a)||1!==a.BYTES_PER_ELEMENT||"Uint8Array"!==a.constructor.name))throw new a7(a);return!0}catch{return!1}}(b))return bf(A(b));let{prefix:a,x:c,y:d}=b;return"bigint"==typeof c&&"bigint"==typeof d?{prefix:a??4,x:c,y:d}:{prefix:a,x:c}})()),c}({payload:ee(h),signature:i})).toLowerCase()===g.toLowerCase());case"eip1271":return await eg(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function eg(a,b,c,d,e,f){let g=ce(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=(h.length/2).toString(16).padStart(64,"0"),j=(b.startsWith("0x")?b:ee(b)).substring(2),k=g+j+"0000000000000000000000000000000000000000000000000000000000000040"+i+h,l=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:k},"latest"]})}),{result:m}=await l.json();return!!m&&m.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function eh(a){let b=new Uint8Array(d2(function(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("object"==typeof a&&null!=a&&a.data)return new Uint8Array(Object.values(a.data));if("object"==typeof a&&a)return new Uint8Array(Object.values(a));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(a)));return br.encode(b)}function ei(a){let b=Buffer.from(a,"base64"),c=(0,bs.D)(b).txn;if(!c)throw Error("Invalid signed transaction: missing 'txn' field");let d=(0,bt.l)(c),e=Buffer.from("TX"),f=d5(Buffer.concat([e,Buffer.from(d)]));return bu.RG.encode(f).replace(/=+$/,"")}function ej(a){let b=[],c=BigInt(a);for(;c>=BigInt(128);)b.push(Number(c&BigInt(127)|BigInt(128))),c>>=BigInt(7);return b.push(Number(c)),Buffer.from(b)}var ek=Object.defineProperty,el=Object.defineProperties,em=Object.getOwnPropertyDescriptors,en=Object.getOwnPropertySymbols,eo=Object.prototype.hasOwnProperty,ep=Object.prototype.propertyIsEnumerable,eq=(a,b,c)=>b in a?ek(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let er="did:pkh:",es={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},et=a=>a?.split(":"),eu=a=>{let b=a&&et(a);if(b)return b[2]+":"+b[3]},ev=a=>{let b=a&&et(a);if(b)return b.pop()};async function ew(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=ex(e,e.iss),g=ev(e.iss);return await ef(g,f,d,eu(e.iss),c)}let ex=(a,b)=>{let c=(a=>{let b=a&&et(a);if(b)return a.includes(er)?b[2]:b[0]})(b);if(!c)throw Error("Invalid issuer: "+b);let d=`${a.domain} wants you to sign in with your ${c?es[c]||c:""} account:`,e=ev(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let f=a.statement||void 0,g=`URI: ${a.aud||a.uri}`,h=`Version: ${a.version}`,i=`Chain ID: ${(a=>{let b=a&&et(a);if(b)return a.includes(er)?b[3]:b[1]})(b)}`,j=`Nonce: ${a.nonce}`,k=`Issued At: ${a.iat}`,l=a.exp?`Expiration Time: ${a.exp}`:void 0,m=a.nbf?`Not Before: ${a.nbf}`:void 0,n=a.requestId?`Request ID: ${a.requestId}`:void 0,o=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,p=eD(a.resources);return p&&(f=function(a="",b){ey(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(f,eA(p))),[d,e,"",f,"",g,h,i,j,k,l,m,n,o].filter(a=>null!=a).join(`
`)};function ey(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function ez(a){return ey(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function eA(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return ey(c),c}function eB(a){var b;let c=eA(a);ey(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function eC(a){let b=eA(a);ey(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function eD(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function eE(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function eF(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function eG(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function eH(a,...b){if(!eE(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function eI(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function eJ(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function eK(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let eL=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function eM(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(eE(a))a=eP(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function eN(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function eO(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function eP(a){return Uint8Array.from(a)}let eQ=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),eR=eQ("expand 16-byte k"),eS=eQ("expand 32-byte k"),eT=eJ(eR),eU=eJ(eS);function eV(a,b){return a<<b|a>>>32-b}function eW(a){return a.byteOffset%4==0}let eX=0x100000000-1,eY=new Uint32Array,eZ=(a,b)=>255&a[b++]|(255&a[b++])<<8;class e${constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,eH(a=eM(a),32);const b=eZ(a,0),c=eZ(a,2),d=eZ(a,4),e=eZ(a,6),f=eZ(a,8),g=eZ(a,10),h=eZ(a,12),i=eZ(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=eZ(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=eZ(a,b+0),q=eZ(a,b+2),r=eZ(a,b+4),s=eZ(a,b+6),t=eZ(a,b+8),u=eZ(a,b+10),v=eZ(a,b+12),w=eZ(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;eK(c)}update(a){eI(this),eH(a=eM(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){eK(this.h,this.r,this.buffer,this.pad)}digestInto(a){eI(this),function(a,b){eH(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let e_=(n=a=>new e$(a),(h=(a,b)=>n(b).update(eM(a)).digest()).outputLen=(i=n(new Uint8Array(32))).outputLen,h.blockLen=i.blockLen,h.create=a=>n(a),h),e0=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return eG(e),eG(g),eF(f),eF(c),(b,h,i,j,k=0)=>{eH(b),eH(h),eH(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),eH(j),eG(k),k<0||k>=eX)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=eP(b)),p=eU;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=eT,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);eW(h)||m.push(h=eP(h));let q=eJ(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,eJ(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=eJ(j),l=eW(e)&&eW(f),m=l?eJ(e):eY,n=l?eJ(f):eY;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=eX)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,eJ(h),i,j,k,g),eK(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=eV(H^(v=v+z|0),16))|0,v=v+(z=eV(z^D,12))|0,D=D+(H=eV(H^v,8))|0,z=eV(z^D,7),E=E+(I=eV(I^(w=w+A|0),16))|0,w=w+(A=eV(A^E,12))|0,E=E+(I=eV(I^w,8))|0,A=eV(A^E,7),F=F+(J=eV(J^(x=x+B|0),16))|0,x=x+(B=eV(B^F,12))|0,F=F+(J=eV(J^x,8))|0,B=eV(B^F,7),G=G+(K=eV(K^(y=y+C|0),16))|0,y=y+(C=eV(C^G,12))|0,G=G+(K=eV(K^y,8))|0,C=eV(C^G,7),F=F+(K=eV(K^(v=v+A|0),16))|0,v=v+(A=eV(A^F,12))|0,F=F+(K=eV(K^v,8))|0,A=eV(A^F,7),G=G+(H=eV(H^(w=w+B|0),16))|0,w=w+(B=eV(B^G,12))|0,G=G+(H=eV(H^w,8))|0,B=eV(B^G,7),D=D+(I=eV(I^(x=x+C|0),16))|0,x=x+(C=eV(C^D,12))|0,D=D+(I=eV(I^x,8))|0,C=eV(C^D,7),E=E+(J=eV(J^(y=y+z|0),16))|0,y=y+(z=eV(z^E,12))|0,E=E+(J=eV(J^y,8))|0,z=eV(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),e1=new Uint8Array(16),e2=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(e1.subarray(c))},e3=new Uint8Array(32);function e4(a,b,c,d,e){var f,g;let h,i,j=a(b,c,e3),k=e_.create(j);e&&e2(k,e),e2(k,d);let l=(f=d.length,g=e?e.length:0,eF(!0),eO(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),eO(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return eK(j,l),m}let e5=((a,b)=>{function c(d,...e){if(eH(d),!eL)throw Error("Non little-endian hardware is not yet supported");if(void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?eH(b):eH(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&eH(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");eH(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,eH(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(eH(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a,b,c)=>({encrypt(d,e){let f=d.length;(e=eN(f+16,e,!1)).set(d);let g=e.subarray(0,-16);e0(a,b,g,g,1);let h=e4(e0,a,b,g,c);return e.set(h,f),eK(h),e},decrypt(d,e){e=eN(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=e4(e0,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),e0(a,b,e,e,1),eK(h),e}}));class e6 extends dv{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,db(a);const c=dt(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),df(e)}update(a){return dc(this),this.iHash.update(a),this}digestInto(a){dc(this),da(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let e7=(a,b,c)=>new e6(a,b).update(c).digest();e7.create=(a,b)=>new e6(a,b);let e8=Uint8Array.from([0]),e9=Uint8Array.of(),fa=BigInt(0),fb=BigInt(1);function fc(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function fd(a,b,c=""){let d=c8(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function fe(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function ff(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?fa:BigInt("0x"+a)}function fg(a){return da(a),ff(dp(Uint8Array.from(a).reverse()))}function fh(a,b){return dr(a.toString(16).padStart(2*b,"0"))}function fi(a,b){return fh(a,b).reverse()}function fj(a,b,c){let d;if("string"==typeof b)try{d=dr(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(c8(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let fk=a=>"bigint"==typeof a&&fa<=a;function fl(a,b,c,d){if(!(fk(b)&&fk(c)&&fk(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function fm(a){let b;for(b=0;a>fa;a>>=fb,b+=1);return b}let fn=a=>(fb<<BigInt(a))-fb;function fo(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function fp(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let fq=BigInt(0),fr=BigInt(1),fs=BigInt(2),ft=BigInt(3),fu=BigInt(4),fv=BigInt(5),fw=BigInt(7),fx=BigInt(8),fy=BigInt(9),fz=BigInt(16);function fA(a,b){let c=a%b;return c>=fq?c:b+c}function fB(a,b,c){let d=a;for(;b-- >fq;)d*=d,d%=c;return d}function fC(a,b){if(a===fq)throw Error("invert: expected non-zero number");if(b<=fq)throw Error("invert: expected positive modulus, got "+b);let c=fA(a,b),d=b,e=fq,f=fr;for(;c!==fq;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==fr)throw Error("invert: does not exist");return fA(e,b)}function fD(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function fE(a,b){let c=(a.ORDER+fr)/fu,d=a.pow(b,c);return fD(a,d,b),d}function fF(a,b){let c=(a.ORDER-fv)/fx,d=a.mul(b,fs),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,fs),e),h=a.mul(f,a.sub(g,a.ONE));return fD(a,h,b),h}function fG(a){if(a<ft)throw Error("sqrt is not defined for small field");let b=a-fr,c=0;for(;b%fs===fq;)b/=fs,c++;let d=fs,e=fL(a);for(;1===fJ(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return fE;let f=e.pow(d,b),g=(b+fr)/fs;return function(a,d){if(a.is0(d))return d;if(1!==fJ(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=fr<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let fH=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function fI(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function fJ(a,b){let c=(a.ORDER-fr)/fs,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function fK(a,b){void 0!==b&&c9(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function fL(a,b,c=!1,d={}){let e;if(a<=fq)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=fK(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:fn(j),ZERO:fq,ONE:fr,allowedLengths:i,create:b=>fA(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return fq<=b&&b<a},is0:a=>a===fq,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&fr)===fr,neg:b=>fA(-b,a),eql:(a,b)=>a===b,sqr:b=>fA(b*b,a),add:(b,c)=>fA(b+c,a),sub:(b,c)=>fA(b-c,a),mul:(b,c)=>fA(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<fq)throw Error("invalid exponent, negatives unsupported");if(c===fq)return a.ONE;if(c===fr)return b;let d=a.ONE,e=b;for(;c>fq;)c&fr&&(d=a.mul(d,e)),e=a.sqr(e),c>>=fr;return d})(l,a,b),div:(b,c)=>fA(b*fC(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>fC(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%fu===ft?fE:a%fx===fv?fF:a%fz===fy?(c=fL(a),f=(d=fG(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+fw)/fz,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),n=a.cmov(c,d,m);return fD(a,n,b),n}):fG(a)),e(l,b)}),toBytes:a=>c?fi(a,k):fh(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?fg(b):ff(dp(b));if(h&&(e=fA(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>fI(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function fM(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function fN(a){let b=fM(a);return b+Math.ceil(b/2)}let fO=BigInt(0),fP=BigInt(1);function fQ(a,b){let c=b.negate();return a?c:b}function fR(a,b){let c=fI(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function fS(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function fT(a,b){fS(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:fn(a),maxNumber:e,shiftBy:BigInt(a)}}function fU(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=fP);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let fV=new WeakMap,fW=new WeakMap;function fX(a){return fW.get(a)||1}function fY(a){if(a!==fO)throw Error("invalid wNAF")}class fZ{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>fO;)b&fP&&(c=c.add(d)),d=d.double(),b>>=fP;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=fT(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=fT(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=fU(c,a,f);c=g,i?e=e.add(fQ(k,b[l])):d=d.add(fQ(j,b[h]))}return fY(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=fT(a,this.bits);for(let a=0;a<e.windows&&c!==fO;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=fU(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return fY(c),d}getPrecomputes(a,b,c){let d=fV.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),fV.set(b,d))),d}cached(a,b,c){let d=fX(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=fX(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){fS(b,this.bits),fW.set(a,b),fV.delete(a)}hasCache(a){return 1!==fX(a)}}function f$(a,b,c){if(!b)return fL(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return fo(b,fH.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),ds("HashToScalar-");let f_=BigInt(0),f0=BigInt(1),f1=BigInt(2),f2=BigInt(1),f3=BigInt(2),f4=BigInt(3),f5=BigInt(5),f6=BigInt(8),f7=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),f8={p:f7,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:f6,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},f9=function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(fo(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=f||dx,i=g?255:448,j=g?32:56,k=BigInt(g?9:5),l=BigInt(g?121665:39081),m=g?f1**BigInt(254):f1**BigInt(447),n=m+(g?BigInt(8)*f1**BigInt(251)-f0:BigInt(4)*f1**BigInt(445)-f0)+f0,o=a=>fA(a,b),p=fi(o(k),j);function q(a,c){let f,h=function(a,c){fl("u",a,f_,b),fl("scalar",c,m,n);let d=f0,f=f_,g=a,h=f0,j=f_;for(let b=BigInt(i-1);b>=f_;b--){let e=c>>b&f0;j^=e,({x_2:d,x_3:g}=s(j,d,g)),({x_2:f,x_3:h}=s(j,f,h)),j=e;let i=d+f,k=o(i*i),m=d-f,n=o(m*m),p=k-n,q=g+h,r=o((g-h)*i),t=o(q*m),u=r+t,v=r-t;g=o(u*u),h=o(a*o(v*v)),d=o(k*n),f=o(p*(k+o(l*p)))}return{x_2:d,x_3:g}=s(j,d,g),{x_2:f,x_3:h}=s(j,f,h),o(d*e(f))}((f=fj("u coordinate",c,j),g&&(f[31]&=127),o(fg(f))),fg(d(fj("scalar",a,j))));if(h===f_)throw Error("invalid private or public key received");return fi(o(h),j)}function r(a){return q(a,p)}function s(a,b,c){let d=o(a*(b-c));return{x_2:b=o(b-d),x_3:c=o(c+d)}}let t={secretKey:j,publicKey:j,seed:j},u=(a=h(j))=>(da(a,t.seed),a);return{keygen:function(a){let b=u(a);return{secretKey:b,publicKey:r(b)}},getSharedSecret:(a,b)=>q(a,b),getPublicKey:a=>r(a),scalarMult:q,scalarMultBase:r,utils:{randomSecretKey:u,randomPrivateKey:u},GuBytes:p.slice(),lengths:t}}({P:j=fL(f8.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,f,g,h,i,k,l,m,n,o,p,{pow_p_5_8:q,b2:r}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),g=fB(f=a*a%f7*a%f7,f3,f7)*f%f7,h=fB(g,f2,f7)*a%f7,i=fB(h,f5,f7)*h%f7,k=fB(i,b,f7)*i%f7,l=fB(k,c,f7)*k%f7,m=fB(l,d,f7)*l%f7,n=fB(m,e,f7)*m%f7,o=fB(n,e,f7)*m%f7,p=fB(o,b,f7)*i%f7,{pow_p_5_8:fB(p,f3,f7)*a%f7,b2:f});return fA(fB(q,f4,j)*r,j)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),ga=(a,b)=>(a+(a>=0?b:-b)/gh)/b;function gb(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function gc(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return fc(c.lowS,"lowS"),fc(c.prehash,"prehash"),void 0!==c.format&&gb(c.format),c}class gd extends Error{constructor(a=""){super(a)}}let ge={Err:gd,_tlv:{encode:(a,b)=>{let{Err:c}=ge;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=fe(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?fe(e.length/2|128):"";return fe(a)+f+e+b},decode(a,b){let{Err:c}=ge,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=ge;if(a<gf)throw new b("integer: negative integers are not allowed");let c=fe(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=ge;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return ff(dp(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=ge,e=fj("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=ge,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},gf=BigInt(0),gg=BigInt(1),gh=BigInt(2),gi=BigInt(3),gj=BigInt(4);function gk(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=fj("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function gl(a){return Uint8Array.of(a?2:3)}function gm(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function gn(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:fL(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){db(b),fo(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||dx,e=c.hmac||((a,...c)=>e7(b,a,du(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||dx,e=Object.assign(gm(a.Fp,c),{seed:fN(c.ORDER)});function f(a){try{return!!gk(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=fM(b),f=fN(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=fA(c?fg(a):ff(dp(a)),b-fr)+fr;return c?fi(g,e):fh(g,e)}(fd(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(gk(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=fj("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=gk(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>gk(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),o={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},p="compact";function q(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class r{constructor(a,b,c){this.r=q("r",a),this.s=q("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=p){var c,d;let e,f;if(c=a,gb(d=b),f=n.signature,fd(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=ge.toSig(fd(a));return new r(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new r(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(dr(a),b)}addRecoveryBit(a){return new r(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*gh<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(du(gl((1&i)==0),k)),m=g.inv(j),n=t(fj("msgHash",b)),o=g.create(-n*m),p=g.create(e*m),q=a.BASE.multiplyUnsafe(o).add(l.multiplyUnsafe(p));if(q.is0())throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>h>>gg}toBytes(a=p){if(gb(a),"der"===a)return dr(ge.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return du(Uint8Array.of(this.recovery),b,c)}return du(b,c)}toHex(a){return dp(this.toBytes(a))}assertValidity(){}static fromCompact(a){return r.fromBytes(fj("sig",a),"compact")}static fromDER(a){return r.fromBytes(fj("sig",a),"der")}normalizeS(){return this.hasHighS()?new r(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return dp(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return dp(this.toBytes("compact"))}}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=ff(dp(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return g.create(s(a))},u=fn(i);function v(a){return fl("num < 2^"+i,a,gf,u),g.toBytes(a)}function w(a,c){return fd(a,void 0,"message"),c?fd(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=gc(e,o),k=t(b=w(b,i)),l=gk(g,c),m=[v(l),v(k)];if(null!=j&&!1!==j){let a=!0===j?d(n.secretKey):j;m.push(fj("extraEntropy",a))}return{seed:du(...m),k2sig:function(b){let c=s(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===gf)return;let j=g.create(d*g.create(k+i*l));if(j===gf)return;let m=2*(e.x!==i)|Number(e.y&gg),n=j;return f&&j>h>>gg&&(n=g.neg(j),m^=1),new r(i,n,m)}}}(c=fj("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return du(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=gc(e,o);if(d=fj("publicKey",d),c=w(fj("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||c8(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new r(a.r,a.s);else if(c){try{b=r.fromBytes(fj("sig",a),"der")}catch(a){if(!(a instanceof ge.Err))throw a}if(!b)try{b=r.fromBytes(fj("sig",a),"compact")}catch{return!1}}return b||!1}(b):r.fromBytes(fj("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=t(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),n=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!n.is0()&&g.create(n.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=gc(c,o);return b=w(b,d),r.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:r,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>fO))throw Error(`CURVE.${a} must be positive bigint`)}let e=f$(b.p,c.Fp,d),f=f$(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;fo(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=gm(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(fc(c,"isCompressed"),c)?(k(),du(gl(!d.isOdd(f)),g)):du(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){fd(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=n(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!o(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function n(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function o(a,b){let c=d.sqr(b),e=n(a);return d.eql(c,e)}if(!o(f.Gx,f.Gy))throw Error("bad curve params: generator point");let p=d.mul(d.pow(f.a,gi),gj),q=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(p,q)))throw Error("bad curve params: a or b");function r(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function s(a){if(!(a instanceof x))throw Error("ProjectivePoint expected")}function t(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=ga(g*a,c),i=ga(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<gf,m=k<gf;l&&(j=-j),m&&(k=-k);let n=fn(Math.ceil(fm(c)/2))+gg;if(j<gf||j>=n||k<gf||k>=n)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let u=fp((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),v=fp(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!o(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function w(a,b,c,e,f){return c=new x(d.mul(c.X,a),c.Y,c.Z),b=fQ(e,b),c=fQ(f,c),b.add(c)}class x{constructor(a,b,c){this.X=r("x",a),this.Y=r("y",b,!0),this.Z=r("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof x)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?x.ZERO:new x(b,c,d.ONE)}static fromBytes(a){let b=x.fromAffine(m(fd(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return x.fromBytes(fj("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return z.createCache(this,a),b||this.multiply(gi),this}assertValidity(){v(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){s(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new x(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,gi),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(e,g);return o=d.add(o,o),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(c,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new x(i,j,k=d.add(k,k))}add(a){s(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,n=d.mul(f.b,gi),o=d.mul(b,g),p=d.mul(c,h),q=d.mul(e,i),r=d.add(b,c),t=d.add(g,h);r=d.mul(r,t),t=d.add(o,p),r=d.sub(r,t),t=d.add(b,e);let u=d.add(g,i);return t=d.mul(t,u),u=d.add(o,q),t=d.sub(t,u),u=d.add(c,e),j=d.add(h,i),u=d.mul(u,j),j=d.add(p,q),u=d.sub(u,j),l=d.mul(m,t),j=d.mul(n,q),l=d.add(j,l),j=d.sub(p,l),l=d.add(p,l),k=d.mul(j,l),p=d.add(o,o),p=d.add(p,o),q=d.mul(m,q),t=d.mul(n,t),p=d.add(p,q),q=d.sub(o,q),q=d.mul(m,q),t=d.add(t,q),o=d.mul(p,t),k=d.add(k,o),o=d.mul(u,t),j=d.mul(r,j),j=d.sub(j,o),o=d.mul(r,p),l=d.mul(u,l),new x(j,k,l=d.add(l,o))}subtract(a){return this.add(a.negate())}is0(){return this.equals(x.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>z.cached(this,a,a=>fR(x,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=t(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=w(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return fR(x,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===gf||this.is0())return x.ZERO;if(a===gg)return this;if(z.hasCache(this))return this.multiply(a);if(!c)return z.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=t(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>fO||d>fO;)c&fP&&(f=f.add(e)),d&fP&&(g=g.add(e)),e=e.double(),c>>=fP,d>>=fP;return{p1:f,p2:g}}(x,this,d,f);return w(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return u(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===gg||(a?a(x,this):z.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===gg?this:a?a(x,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return fc(a,"isCompressed"),this.assertValidity(),l(x,this,a)}toHex(a=!0){return dp(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return fR(x,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=fm(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=fn(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(x,e,a,b)}static fromPrivateKey(a){return x.BASE.multiply(gk(e,a))}}x.BASE=new x(f.Gx,f.Gy,d.ONE),x.ZERO=new x(d.ZERO,d.ONE,d.ZERO),x.Fp=d,x.Fn=e;let y=e.BITS,z=new fZ(x,b.endo?Math.ceil(y/2):y);return x.BASE.precompute(8),x}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,fK(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let go={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},gp={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},gq={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},gr=fL(go.p),gs=fL(gp.p),gt=fL(gq.p),gu=gn({...go,Fp:gr,lowS:!1},d2);gn({...gp,Fp:gs,lowS:!1},d4),gn({...gq,Fp:gt,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},d3);let gv="base10",gw="base16",gx="base64pad",gy="base64url",gz="utf8";function gA(){let a=dx(32);return(0,bw.dI)(a,gw)}function gB(a){let b=d2((0,bw.sH)(a,gw));return(0,bw.dI)(b,gw)}function gC(a){let b=d2((0,bw.sH)(a,gz));return(0,bw.dI)(b,gw)}function gD(a){return(0,bw.sH)(`${a}`,gv)}function gE(a){return Number((0,bw.dI)(a,gv))}function gF(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function gG(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function gH(a){if(2===gE(a.type))return(0,bw.dI)((0,bw.xW)([a.type,a.sealed]),gx);if(1===gE(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,bw.dI)((0,bw.xW)([a.type,a.senderPublicKey,a.iv,a.sealed]),gx)}return(0,bw.dI)((0,bw.xW)([a.type,a.iv,a.sealed]),gx)}function gI(a){let b=(a.encoding||gx)===gy?gG(a.encoded):a.encoded,c=(0,bw.sH)(b,gx),d=c.slice(0,1);if(1===gE(d)){let a=c.slice(1,33),b=c.slice(33,45);return{type:d,sealed:c.slice(45),iv:b,senderPublicKey:a}}if(2===gE(d))return{type:d,sealed:c.slice(1),iv:dx(12)};let e=c.slice(1,13);return{type:d,sealed:c.slice(13),iv:e}}function gJ(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function gK(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function gL(a){return a?.relay||{protocol:"irn"}}function gM(a){let b=bx.CG[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}var gN=Object.defineProperty,gO=Object.defineProperties,gP=Object.getOwnPropertyDescriptors,gQ=Object.getOwnPropertySymbols,gR=Object.prototype.hasOwnProperty,gS=Object.prototype.propertyIsEnumerable,gT=(a,b,c)=>b in a?gN(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,gU=(a,b)=>{for(var c in b||(b={}))gR.call(b,c)&&gT(a,c,b[c]);if(gQ)for(var c of gQ(b))gS.call(b,c)&&gT(a,c,b[c]);return a};function gV(a){var b;if(!a.includes("wc:")){let b=cQ(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=Object.fromEntries(new URLSearchParams("u">typeof d?a.substring(d):"").entries()),h="string"==typeof g.methods?g.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:g.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(g),methods:h,expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function gW(a){let b=new URLSearchParams;return Object.entries(gU(gU(gO(gU({},function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay)),gP({symKey:a.symKey})),a.expiryTimestamp&&{expiryTimestamp:a.expiryTimestamp.toString()}),a.methods&&{methods:a.methods.join(",")})).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,c])=>{void 0!==c&&b.append(a,String(c))}),`${a.protocol}:${a.topic}@${a.version}?${b}`}function gX(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}var gY=Object.defineProperty,gZ=Object.defineProperties,g$=Object.getOwnPropertyDescriptors,g_=Object.getOwnPropertySymbols,g0=Object.prototype.hasOwnProperty,g1=Object.prototype.propertyIsEnumerable,g2=(a,b,c)=>b in a?gY(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,g3=(a,b)=>{for(var c in b||(b={}))g0.call(b,c)&&g2(a,c,b[c]);if(g_)for(var c of g_(b))g1.call(b,c)&&g2(a,c,b[c]);return a},g4=(a,b)=>gZ(a,g$(b));function g5(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function g6(a){let b=[];return Object.values(a).forEach(a=>{b.push(...g5(a.accounts))}),[...new Set(b)]}function g7(a){return a.includes(":")}function g8(a){return g7(a)?a.split(":")[0]:a}function g9(a){var b,c,d;let e={};if(!hg(a))return e;for(let[f,g]of Object.entries(a)){let a=g7(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=g8(f);e[j]=g4(g3({},e[j]),{chains:cK(a,null==(b=e[j])?void 0:b.chains),methods:cK(h,null==(c=e[j])?void 0:c.methods),events:cK(i,null==(d=e[j])?void 0:d.events)})}return e}function ha(a,b){var c;let d,e=(c=b=b.map(a=>a.replace("did:pkh:","")),d={},c?.forEach(a=>{var b;let[c,e]=a.split(":");d[c]||(d[c]={accounts:[],chains:[],events:[],methods:[]}),d[c].accounts.push(a),null==(b=d[c].chains)||b.push(`${c}:${e}`)}),d);for(let[b,c]of Object.entries(e))c.methods?c.methods=cK(c.methods,a):c.methods=a,c.events=["chainChanged","accountsChanged"];return e}let hb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},hc={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function hd(a,b){let{message:c,code:d}=hc[a];return{message:b?`${c} ${b}`:c,code:d}}function he(a,b){let{message:c,code:d}=hb[a];return{message:b?`${c} ${b}`:c,code:d}}function hf(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function hg(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function hh(a){return typeof a>"u"}function hi(a,b){return!!(b&&hh(a))||"string"==typeof a&&!!a.trim().length}function hj(a,b){return!!(b&&hh(a))||"number"==typeof a&&!isNaN(a)}function hk(a){return!!(hi(a,!1)&&a.includes(":"))&&2===a.split(":").length}function hl(a){let b=!0;return hf(a)?a.length&&(b=a.every(a=>hi(a,!1))):b=!1,b}function hm(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,hl(a?.methods)?hl(a?.events)||(e=he("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=he("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function hn(a,b){let c=null;if(a&&hg(a)){let d,e=hm(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,hf(c)?c.forEach(a=>{f||function(a){if(hi(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&hk(a)}}return!1}(a)||(f=he("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=he("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=hd("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function ho(a){return hi(a.protocol,!0)}function hp(a){return"u">typeof a}function hq(a,b){return!(!hk(b)||!g6(a).includes(b))}function hr(a,b,c){var d,e;let f,g,h=null,i=(f={},Object.keys(d=a).forEach(a=>{var b;a.includes(":")?f[a]=d[a]:null==(b=d[a].chains)||b.forEach(b=>{f[b]={methods:d[a].methods,events:d[a].events}})}),f),j=(g={},Object.keys(e=b).forEach(a=>{if(a.includes(":"))g[a]=e[a];else{let b=g5(e[a].accounts);b?.forEach(b=>{g[b]={accounts:e[a].accounts.filter(a=>a.includes(`${b}:`)),methods:e[a].methods,events:e[a].events}})}}),g),k=Object.keys(i),l=Object.keys(j),m=hs(Object.keys(a)),n=hs(Object.keys(b)),o=m.filter(a=>!n.includes(a));return o.length&&(h=hd("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${o.toString()}
      Received: ${Object.keys(b).toString()}`)),cA(k,l)||(h=hd("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${k.toString()}
      Approved: ${l.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||h)return;let d=g5(b[a].accounts);d.includes(a)||(h=hd("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${d.toString()}`))}),k.forEach(a=>{h||(cA(i[a].methods,j[a].methods)?cA(i[a].events,j[a].events)||(h=hd("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):h=hd("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),h}function hs(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}function ht(){let a=cw();return new Promise(b=>{switch(a){case cs:b(cv()&&navigator?.onLine);break;case cq:b(hu());break;default:b(!0)}})}async function hu(){if(cu()&&"u">typeof global&&null!=global&&global.NetInfo){let a=await (null==global?void 0:global.NetInfo.fetch());return a?.isConnected}return!0}let hv={};class hw{static get(a){return hv[a]}static set(a,b){hv[a]=b}static delete(a){delete hv[a]}}function hx(a){return new Uint8Array(a.replace(/^0x/,"").match(/.{1,2}/g).map(a=>parseInt(a,16)))}function hy({logger:a,name:b}){let c="string"==typeof a?cd({opts:{level:a,name:b}}).logger:a;return c.level="string"==typeof a?a:a.level,c}var hz=c(47613),hA=c(80999),hB=c(883),hC=Object.defineProperty,hD=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?hC(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class hE extends hB.H{constructor(a){super(),this.opts=a,hD(this,"protocol","wc"),hD(this,"version",2)}}var hF=Object.defineProperty;class hG extends hB.H{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?hF(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"records",new Map)}}class hH{constructor(a,b){this.logger=a,this.core=b}}class hI extends hB.H{constructor(a,b){super(),this.relayer=a,this.logger=b}}class hJ extends hB.H{constructor(a){super()}}class hK{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class hL extends hB.H{constructor(a,b){super(),this.relayer=a,this.logger=b}}class hM extends hB.H{constructor(a,b){super(),this.core=a,this.logger=b}}class hN{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class hO{constructor(a,b){this.projectId=a,this.logger=b}}class hP{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}var hQ=Object.defineProperty,hR=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?hQ(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};p();class hS{constructor(a){this.opts=a,hR(this,"protocol","wc"),hR(this,"version",2)}}o.EventEmitter;class hT{constructor(a){this.client=a}}var hU=c(13149),hV=c(43544),hW=c(10272),hX=c(22844);let hY="core",hZ=`wc@2:${hY}:`,h$={database:":memory:"},h_="client_ed25519_seed",h0=r.ONE_DAY,h1=r.SIX_HOURS,h2="wss://relay.walletconnect.org",h3="relayer_message",h4="relayer_message_ack",h5="relayer_connection_stalled",h6="relayer_publish",h7="payload",h8="connect",h9="disconnect",ia="error",ib="2.23.1",ic="link_mode",id="relay",ie="inbound",ig="WALLETCONNECT_LINK_MODE_APPS",ih="subscription_created",ii="subscription_deleted",ij=(r.FIVE_SECONDS,{wc_pairingDelete:{req:{ttl:r.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:r.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:r.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:r.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:r.ONE_DAY,prompt:!1,tag:0},res:{ttl:r.ONE_DAY,prompt:!1,tag:0}}}),ik="pairing_create",il="pairing_delete",im="history_created",io="history_updated",ip="history_deleted",iq="expirer_created",ir="expirer_deleted",is="expirer_expired",it="https://verify.walletconnect.org",iu=`${it}/v3`,iv=["https://verify.walletconnect.com",it],iw="malformed_pairing_uri",ix="session_approve_started";var iy=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let iz=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class iA{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class iB{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return iD(this,a)}}class iC{constructor(a){this.decoders=a}or(a){return iD(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let iD=(a,b)=>new iC({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class iE{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new iA(a,b,c),this.decoder=new iB(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let iF=({name:a,prefix:b,encode:c,decode:d})=>new iE(a,b,c,d),iG=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=iy(c,b);return iF({prefix:a,name:b,encode:d,decode:a=>iz(e(a))})},iH=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>iF({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var iI=Object.freeze({__proto__:null,identity:iF({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),iJ=Object.freeze({__proto__:null,base2:iH({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),iK=Object.freeze({__proto__:null,base8:iH({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),iL=Object.freeze({__proto__:null,base10:iG({prefix:"9",name:"base10",alphabet:"0123456789"})}),iM=Object.freeze({__proto__:null,base16:iH({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:iH({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),iN=Object.freeze({__proto__:null,base32:iH({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:iH({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:iH({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:iH({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:iH({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:iH({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:iH({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:iH({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:iH({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),iO=Object.freeze({__proto__:null,base36:iG({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:iG({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),iP=Object.freeze({__proto__:null,base58btc:iG({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:iG({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),iQ=Object.freeze({__proto__:null,base64:iH({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:iH({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:iH({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:iH({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let iR=Array.from("\uD83D\uDE80\uD83E\uDE90☄\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09☀\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02❤\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09☺\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E✌✨\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D❣\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33✋\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13⭐✅\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6✔\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90☹\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20☝\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B⚽\uD83E\uDD19☕\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81⚡\uD83C\uDF1E\uD83C\uDF88❌✊\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C✈\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74▶➡❓\uD83D\uDC8E\uD83D\uDCB8⬇\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A⚠\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37☎\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51❄\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),iS=iR.reduce((a,b,c)=>(a[c]=b,a),[]),iT=iR.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var iU=Object.freeze({__proto__:null,base256emoji:iF({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=iS[b],"")},decode:function(a){let b=[];for(let c of a){let a=iT[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function iV(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,iV.bytes=c-d+1,b}var iW=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let iX=(a,b,c=0)=>(iV(a,b,c),b),iY=(a,b)=>{let c=b.byteLength,d=iW(a),e=d+iW(c),f=new Uint8Array(e+c);return iX(a,f,0),iX(c,f,d),f.set(b,e),new iZ(a,c,b,f)};class iZ{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let i$=({name:a,code:b,encode:c})=>new i_(a,b,c);class i_{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?iY(this.code,b):b.then(a=>iY(this.code,a))}throw Error("Unknown type, must be binary type")}}let i0=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var i1=Object.freeze({__proto__:null,sha256:i$({name:"sha2-256",code:18,encode:i0("SHA-256")}),sha512:i$({name:"sha2-512",code:19,encode:i0("SHA-512")})}),i2=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:iz,digest:a=>iY(0,iz(a))}});new TextEncoder,new TextDecoder;let i3={...iI,...iJ,...iK,...iL,...iM,...iN,...iO,...iP,...iQ,...iU};function i4(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function i5(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...i1,...i2});let i6=i5("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),i7=i5("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?i4(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),i8={utf8:i6,"utf-8":i6,hex:i3.base16,latin1:i7,ascii:i7,binary:i7,...i3};var i9=Object.defineProperty,ja=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?i9(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class jb{constructor(a,b){this.core=a,this.logger=b,ja(this,"keychain",new Map),ja(this,"name","keychain"),ja(this,"version","0.3"),ja(this,"initialized",!1),ja(this,"storagePrefix",hZ),ja(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),ja(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),ja(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),ja(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=hd("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),ja(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=cc(b,this.name)}get context(){return cb(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,cB(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?cC(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}}var jc=Object.defineProperty,jd=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?jc(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class je{constructor(a,b,c){this.core=a,this.logger=b,jd(this,"name","crypto"),jd(this,"keychain"),jd(this,"randomSessionIdentifier",gA()),jd(this,"initialized",!1),jd(this,"clientId"),jd(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),jd(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),jd(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let a=await this.getClientSeed(),b=bv.TZ(a),c=bv.UF(b.publicKey);return this.clientId=c,c}),jd(this,"generateKeyPair",()=>{let a,b;this.isInitialized();let c=(a=f9.utils.randomPrivateKey(),b=f9.getPublicKey(a),{privateKey:(0,bw.dI)(a,gw),publicKey:(0,bw.dI)(b,gw)});return this.setPrivateKey(c.publicKey,c.privateKey)}),jd(this,"signJWT",async a=>{this.isInitialized();let b=await this.getClientSeed(),c=bv.TZ(b),d=this.randomSessionIdentifier;return await bv.FA(d,a,h0,c)}),jd(this,"generateSharedKey",(a,b,c)=>{var d,e,f;let g,h;this.isInitialized();let i=(d=this.getPrivateKey(a),g=f9.getSharedSecret((0,bw.sH)(d,gw),(0,bw.sH)(b,gw)),e=void 0,h=function(a,b,c,d=32){db(a),c9(d);let e=a.outputLen;if(d>255*e)throw Error("Length should be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c&&(c=e9);let g=new Uint8Array(f*e),h=e7.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)e8[0]=a+1,i.update(0===a?e9:j).update(c).update(e8).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),df(j,e8),g.slice(0,d)}(d2,(f=void 0,db(d2),void 0===f&&(f=new Uint8Array(d2.outputLen)),e7(d2,dt(f),dt(g))),e,32),(0,bw.dI)(h,gw));return this.setSymKey(i,c)}),jd(this,"setSymKey",async(a,b)=>{this.isInitialized();let c=b||gB(a);return await this.keychain.set(c,a),c}),jd(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),jd(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),jd(this,"encode",async(a,b,c)=>{this.isInitialized();let d=gJ(c),e=(0,hU.h)(b);if(2===d.type){var f;let a,b,d;return f=c?.encoding,a=gD(2),b=dx(12),d=gH({type:a,sealed:(0,bw.sH)(e,gz),iv:b}),f===gy?gF(d):d}if(gK(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let g=this.getSymKey(a),{type:h,senderPublicKey:i}=d;return function(a){let b=gD("u">typeof a.type?a.type:0);if(1===gE(b)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let c="u">typeof a.senderPublicKey?(0,bw.sH)(a.senderPublicKey,gw):void 0,d="u">typeof a.iv?(0,bw.sH)(a.iv,gw):dx(12),e=gH({type:b,sealed:e5((0,bw.sH)(a.symKey,gw),d).encrypt((0,bw.sH)(a.message,gz)),iv:d,senderPublicKey:c});return a.encoding===gy?gF(e):e}({type:h,symKey:g,message:e,senderPublicKey:i,encoding:c?.encoding})}),jd(this,"decode",async(a,b,c)=>{let d;this.isInitialized();let e=gJ({type:gE((d=gI({encoded:b,encoding:c?.encoding})).type),senderPublicKey:"u">typeof d.senderPublicKey?(0,bw.dI)(d.senderPublicKey,gw):void 0,receiverPublicKey:c?.receiverPublicKey});if(2===e.type){let a=function(a,b){let{sealed:c}=gI({encoded:a,encoding:b});return(0,bw.dI)(c,gz)}(b,c?.encoding);return(0,hU.j)(a)}if(gK(e)){let b=e.receiverPublicKey,c=e.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=function(a){let b=(0,bw.sH)(a.symKey,gw),{sealed:c,iv:d}=gI({encoded:a.encoded,encoding:a.encoding}),e=e5(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return(0,bw.dI)(e,gz)}({symKey:d,encoded:b,encoding:c?.encoding});return(0,hU.j)(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),jd(this,"getPayloadType",(a,b=gx)=>gE(gI({encoded:a,encoding:b}).type)),jd(this,"getPayloadSenderPublicKey",(a,b=gx)=>{let c=gI({encoded:a,encoding:b});return c.senderPublicKey?(0,bw.dI)(c.senderPublicKey,gw):void 0}),this.core=a,this.logger=cc(b,this.name),this.keychain=c||new jb(this.core,this.logger)}get context(){return cb(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(h_)}catch{a=gA(),await this.keychain.set(h_,a)}return function(a,b="utf8"){let c=i8[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?i4(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}}var jf=Object.defineProperty,jg=Object.defineProperties,jh=Object.getOwnPropertyDescriptors,ji=Object.getOwnPropertySymbols,jj=Object.prototype.hasOwnProperty,jk=Object.prototype.propertyIsEnumerable,jl=(a,b,c)=>b in a?jf(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,jm=(a,b,c)=>jl(a,"symbol"!=typeof b?b+"":b,c);class jn extends hH{constructor(a,b){super(a,b),this.logger=a,this.core=b,jm(this,"messages",new Map),jm(this,"messagesWithoutClientAck",new Map),jm(this,"name","messages"),jm(this,"version","0.3"),jm(this,"initialized",!1),jm(this,"storagePrefix",hZ),jm(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),jm(this,"set",async(a,b,c)=>{this.isInitialized();let d=gC(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===ie){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,jg(((a,b)=>{for(var c in b||(b={}))jj.call(b,c)&&jl(a,c,b[c]);if(ji)for(var c of ji(b))jk.call(b,c)&&jl(a,c,b[c]);return a})({},c),jh({[d]:b})))}return await this.persist(),d}),jm(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),jm(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),jm(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[gC(b)])),jm(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=gC(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),jm(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=cc(a,this.name),this.core=b}get context(){return cb(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,cB(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,cB(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?cC(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?cC(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}}var jo=Object.defineProperty,jp=Object.defineProperties,jq=Object.getOwnPropertyDescriptors,jr=Object.getOwnPropertySymbols,js=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable,ju=(a,b,c)=>b in a?jo(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,jv=(a,b)=>{for(var c in b||(b={}))js.call(b,c)&&ju(a,c,b[c]);if(jr)for(var c of jr(b))jt.call(b,c)&&ju(a,c,b[c]);return a},jw=(a,b,c)=>ju(a,"symbol"!=typeof b?b+"":b,c);class jx extends hI{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,jw(this,"events",new o.EventEmitter),jw(this,"name","publisher"),jw(this,"queue",new Map),jw(this,"publishTimeout",(0,r.toMiliseconds)(r.ONE_MINUTE)),jw(this,"initialPublishTimeout",(0,r.toMiliseconds)(15*r.ONE_SECOND)),jw(this,"needsTransportRestart",!1),jw(this,"publish",async(a,b,c)=>{var d,e,f,g,h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let i=c?.ttl||h1,j=c?.prompt||!1,k=c?.tag||0,l=c?.id||(0,hW.getBigIntRpcId)().toString(),m=gM(gL().protocol),n={id:l,method:c?.publishMethod||m.publish,params:jv({topic:a,message:b,ttl:i,prompt:j,tag:k,attestation:c?.attestation},c?.tvf)},o=`Failed to publish payload, please try again. id:${l} tag:${k}`;try{hh(null==(d=n.params)?void 0:d.prompt)&&(null==(e=n.params)||delete e.prompt),hh(null==(f=n.params)?void 0:f.tag)&&(null==(g=n.params)||delete g.tag);let h=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=n.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(h6,b),a())};this.relayer.events.on(h6,b);let d=cE(new Promise((a,b)=>{this.rpcPublish(n,c).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${k}`);try{await d,this.events.removeListener(h6,b)}catch(a){this.queue.set(l,{request:n,opts:c,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:a,message:b,opts:c}}),await cE(h,this.publishTimeout,o)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(h=c?.internal)&&h.throwOnFailedPublish)throw a}finally{this.queue.delete(l)}}),jw(this,"publishCustom",async a=>{var b,c,d,e,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:a});let{payload:g,opts:h={}}=a,{attestation:i,tvf:j,publishMethod:k,prompt:l,tag:m,ttl:n=r.FIVE_MINUTES}=h,o=h.id||(0,hW.getBigIntRpcId)().toString(),p=gM(gL().protocol),q=k||p.publish,s={id:o,method:q,params:jv(jp(jv({},g),jq({ttl:n,prompt:l,tag:m,attestation:i})),j)},t=`Failed to publish custom payload, please try again. id:${o} tag:${m}`;try{hh(null==(b=s.params)?void 0:b.prompt)&&(null==(c=s.params)||delete c.prompt),hh(null==(d=s.params)?void 0:d.tag)&&(null==(e=s.params)||delete e.tag);let a=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=s.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(h6,b),a())};this.relayer.events.on(h6,b);let c=cE(new Promise((a,b)=>{this.rpcPublish(s,h).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${q} id:${o} tag:${m}`);try{await c,this.events.removeListener(h6,b)}catch(a){this.queue.set(o,{request:s,opts:h,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:o,payload:g,opts:h}}),await cE(a,this.publishTimeout,t)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(f=h?.internal)&&f.throwOnFailedPublish)throw a}finally{this.queue.delete(o)}}),jw(this,"on",(a,b)=>{this.events.on(a,b)}),jw(this,"once",(a,b)=>{this.events.once(a,b)}),jw(this,"off",(a,b)=>{this.events.off(a,b)}),jw(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=cc(b,this.name),this.registerEventListeners()}get context(){return cb(this.logger)}async rpcPublish(a,b){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:a});let c=await this.relayer.request(a);return this.relayer.events.emit(h6,jv(jv({},a),b)),this.logger.debug("Successfully Published Payload"),c}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{var c;let d=a.attempt+1;this.queue.set(b,jp(jv({},a),jq({attempt:d}))),this.logger.warn({},`Publisher: queue->publishing: ${a.request.id}, tag: ${null==(c=a.request.params)?void 0:c.tag}, attempt: ${d}`),await this.rpcPublish(a.request,a.opts),this.logger.warn({},`Publisher: queue->published: ${a.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(hz.li.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(h5);return}this.checkQueue()}),this.relayer.on(h4,a=>{this.removeRequestFromQueue(a.id.toString())})}}var jy=Object.defineProperty,jz=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?jy(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class jA{constructor(){jz(this,"map",new Map),jz(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),jz(this,"get",a=>this.map.get(a)||[]),jz(this,"exists",(a,b)=>this.get(a).includes(b)),jz(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);d.length?this.map.set(a,d):this.map.delete(a)}),jz(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var jB=Object.defineProperty,jC=Object.defineProperties,jD=Object.getOwnPropertyDescriptors,jE=Object.getOwnPropertySymbols,jF=Object.prototype.hasOwnProperty,jG=Object.prototype.propertyIsEnumerable,jH=(a,b,c)=>b in a?jB(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,jI=(a,b)=>{for(var c in b||(b={}))jF.call(b,c)&&jH(a,c,b[c]);if(jE)for(var c of jE(b))jG.call(b,c)&&jH(a,c,b[c]);return a},jJ=(a,b,c)=>jH(a,"symbol"!=typeof b?b+"":b,c);class jK extends hL{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,jJ(this,"subscriptions",new Map),jJ(this,"topicMap",new jA),jJ(this,"events",new o.EventEmitter),jJ(this,"name","subscription"),jJ(this,"version","0.3"),jJ(this,"pending",new Map),jJ(this,"cached",[]),jJ(this,"initialized",!1),jJ(this,"storagePrefix",hZ),jJ(this,"subscribeTimeout",(0,r.toMiliseconds)(r.ONE_MINUTE)),jJ(this,"initialSubscribeTimeout",(0,r.toMiliseconds)(15*r.ONE_SECOND)),jJ(this,"clientId"),jJ(this,"batchSubscribeTopicsLimit",500),jJ(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),jJ(this,"subscribe",async(a,b)=>{var c;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let d=gL(b),e={topic:a,relay:d,transportType:b?.transportType};null!=(c=b?.internal)&&c.skipSubscribe||this.pending.set(a,e);let f=await this.rpcSubscribe(a,d,b);return"string"==typeof f&&(this.onSubscribe(f,e),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),f}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),jJ(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),jJ(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),jJ(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),jJ(this,"on",(a,b)=>{this.events.on(a,b)}),jJ(this,"once",(a,b)=>{this.events.once(a,b)}),jJ(this,"off",(a,b)=>{this.events.off(a,b)}),jJ(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),jJ(this,"start",async()=>{await this.onConnect()}),jJ(this,"stop",async()=>{await this.onDisconnect()}),jJ(this,"restart",async()=>{await this.restore(),await this.onRestart()}),jJ(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),jJ(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(hz.li.pulse,async()=>{await this.checkPending()}),this.events.on(ih,async a=>{this.logger.info(`Emitting ${ih}`),this.logger.debug({type:"event",event:ih,data:a}),await this.persist()}),this.events.on(ii,async a=>{this.logger.info(`Emitting ${ii}`),this.logger.debug({type:"event",event:ii,data:a}),await this.persist()})}),this.relayer=a,this.logger=cc(b,this.name),this.clientId=""}get context(){return cb(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=gL(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=he("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d,e;let f=await this.getSubscriptionId(a);if(null!=(d=c?.internal)&&d.skipSubscribe)return f;c&&c?.transportType!==id||await this.restartToComplete({topic:a,id:a,relay:b});let g={method:gM(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:g});let h=null==(e=c?.internal)?void 0:e.throwOnFailedPublish;try{if(c?.transportType===ic)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(g).catch(a=>this.logger.warn(a))},(0,r.toMiliseconds)(r.ONE_SECOND)),f;let b=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(ih,c),b(d.id))};this.events.on(ih,c);try{let d=await cE(new Promise((a,b)=>{this.relayer.request(g).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(ih,c),b(d)}catch{}}),d=await cE(b,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!d&&h)throw Error(`Subscribing to ${a} failed, please try again`);return d?f:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(h5),h)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b={method:gM(a[0].relay.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:b});try{await await cE(new Promise(a=>{this.relayer.request(b).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(h5)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c={method:gM(a[0].relay.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{b=await await cE(new Promise((a,b)=>{this.relayer.request(c).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(h5)}return b}rpcUnsubscribe(a,b,c){let d={method:gM(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,jC(jI({},b),jD({id:a}))),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,jI({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,jI({},b)),this.topicMap.set(b.topic,a),this.events.emit(ih,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=hd("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(ii,jC(jI({},c),jD({reason:b})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit("subscription_resubscribed")}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size&&!a.every(a=>{var b;return a.topic===(null==(b=this.subscriptions.get(a.id))?void 0:b.topic)})){let{message:a}=hd("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>jC(jI({},a),jD({id:await this.getSubscriptionId(a.topic)}))))))}async batchFetchMessages(a){var b;if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let c=await this.rpcBatchFetchMessages(a);c&&c.messages&&(await (b=(0,r.toMiliseconds)(r.ONE_SECOND),new Promise(a=>setTimeout(a,b))),await this.relayer.handleBatchMessageEvents(c.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return gC(a+await this.getClientId())}}var jL=Object.defineProperty,jM=Object.getOwnPropertySymbols,jN=Object.prototype.hasOwnProperty,jO=Object.prototype.propertyIsEnumerable,jP=(a,b,c)=>b in a?jL(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,jQ=(a,b)=>{for(var c in b||(b={}))jN.call(b,c)&&jP(a,c,b[c]);if(jM)for(var c of jM(b))jO.call(b,c)&&jP(a,c,b[c]);return a},jR=(a,b,c)=>jP(a,"symbol"!=typeof b?b+"":b,c);class jS extends hJ{constructor(a){var b;super(a),jR(this,"protocol","wc"),jR(this,"version",2),jR(this,"core"),jR(this,"logger"),jR(this,"events",new o.EventEmitter),jR(this,"provider"),jR(this,"messages"),jR(this,"subscriber"),jR(this,"publisher"),jR(this,"name","relayer"),jR(this,"transportExplicitlyClosed",!1),jR(this,"initialized",!1),jR(this,"connectionAttemptInProgress",!1),jR(this,"relayUrl"),jR(this,"projectId"),jR(this,"packageName"),jR(this,"bundleId"),jR(this,"hasExperiencedNetworkDisruption",!1),jR(this,"pingTimeout"),jR(this,"heartBeatTimeout",(0,r.toMiliseconds)(r.THIRTY_SECONDS+r.FIVE_SECONDS)),jR(this,"reconnectTimeout"),jR(this,"connectPromise"),jR(this,"reconnectInProgress",!1),jR(this,"requestsInFlight",[]),jR(this,"connectTimeout",(0,r.toMiliseconds)(15*r.ONE_SECOND)),jR(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||(0,hW.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),jR(this,"resetPingTimeout",()=>{ct()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),jR(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),jR(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \uD83D\uDEDC"),this.startPingTimeout(),this.events.emit("relayer_connect")}),jR(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \uD83D\uDED1"),this.requestsInFlight=[],this.onProviderDisconnect()}),jR(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit("relayer_error",a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),jR(this,"registerProviderListeners",()=>{this.provider.on(h7,this.onPayloadHandler),this.provider.on(h8,this.onConnectHandler),this.provider.on(h9,this.onDisconnectHandler),this.provider.on(ia,this.onProviderErrorHandler)}),this.core=a.core,this.logger=hy({logger:null!=(b=a.logger)?b:"error",name:this.name}),this.messages=new jn(this.logger,a.core),this.subscriber=new jK(this,this.logger),this.publisher=new jx(this,this.logger),this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||h2,cu()&&"u">typeof global&&"u">typeof(null==global?void 0:global.Platform)&&(null==global?void 0:global.Platform.OS)==="android"?this.packageName=cx():cu()&&"u">typeof global&&"u">typeof(null==global?void 0:global.Platform)&&(null==global?void 0:global.Platform.OS)==="ios"&&(this.bundleId=cx()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(a=>this.logger.warn(a,a?.message))}get context(){return cb(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:id},"outbound")}async publishCustom(a){this.isInitialized(),await this.publisher.publishCustom(a)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(ih,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(ih,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,jQ({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await cE(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ht())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=cH(r.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(h3,a),await this.recordMessageEvent(a,ie)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to connect"))};this.provider.once(h9,c),await cE(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(h9,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,c)=>{let d=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(h9,d),await this.subscriber.start().then(a).catch(c).finally(()=>{this.provider.off(h9,d)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,r.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if(ct())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new hV.F(new hX.A(function({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){var j,k;let l,m=c.split("?"),n=cz(a,b,d),o=(j=m[1]||"",k={auth:e,ua:n,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0},l=new URLSearchParams(j),Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,b])=>{null!=b&&l.set(a,String(b))}),l.toString());return m[0]+"?"+o}({sdkVersion:ib,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),(0,hW.isJsonRpcRequest)(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:id,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(jQ({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else(0,hW.isJsonRpcResponse)(a)&&this.events.emit(h4,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,ie),this.events.emit(h3,a))}async acknowledgePayload(a){let b=(0,hW.formatJsonRpcResult)(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(h7,this.onPayloadHandler),this.provider.off(h8,this.onConnectHandler),this.provider.off(h9,this.onDisconnectHandler),this.provider.off(ia,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let a=await ht();(function(a){var b,c;switch(cw()){case cs:b=a,!cu()&&cv()&&(window.addEventListener("online",()=>b(!0)),window.addEventListener("offline",()=>b(!1)));break;case cq:c=a,cu()&&"u">typeof global&&null!=global&&global.NetInfo&&global?.NetInfo.addEventListener(a=>c(a?.isConnected))}})(async b=>{a!==b&&(a=b,b?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(hz.li.pulse,async()=>{var a;if(!this.transportExplicitlyClosed&&!this.connected&&(!(cv()&&(0,s.getDocument)())||(null==(a=(0,s.getDocument)())?void 0:a.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,r.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function jT(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function jU(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let jV="[object Arguments]",jW="[object Object]";function jX(){}function jY(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}var jZ=Object.defineProperty,j$=Object.getOwnPropertySymbols,j_=Object.prototype.hasOwnProperty,j0=Object.prototype.propertyIsEnumerable,j1=(a,b,c)=>b in a?jZ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,j2=(a,b)=>{for(var c in b||(b={}))j_.call(b,c)&&j1(a,c,b[c]);if(j$)for(var c of j$(b))j0.call(b,c)&&j1(a,c,b[c]);return a},j3=(a,b,c)=>j1(a,"symbol"!=typeof b?b+"":b,c);class j4 extends hK{constructor(a,b,c,d=hZ,e){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,j3(this,"map",new Map),j3(this,"version","0.3"),j3(this,"cached",[]),j3(this,"initialized",!1),j3(this,"getKey"),j3(this,"storagePrefix",hZ),j3(this,"recentlyDeleted",[]),j3(this,"recentlyDeletedLimit",200),j3(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{var b;this.getKey&&null!==a&&!hh(a)?this.map.set(this.getKey(a),a):(null==(b=a?.proposer)?void 0:b.publicKey)?this.map.set(a.id,a):a?.topic&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),j3(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),j3(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),j3(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=jU(c),h=jU(d);if(g===jV&&(g=jW),h===jV&&(h=jW),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case jW:{if(!(b(c.constructor,d.constructor,e,f)||jY(c)&&jY(d)))return!1;let g=[...Object.keys(c),...jT(c)],h=[...Object.keys(d),...jT(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,jX)})):this.values)),j3(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=j2(j2({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),j3(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=cc(b,this.name),this.storagePrefix=d,this.getKey=e}get context(){return cb(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=hd("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=hd("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=hd("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}}var j5=Object.defineProperty,j6=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?j5(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class j7{constructor(a,b){this.core=a,this.logger=b,j6(this,"name","pairing"),j6(this,"version","0.3"),j6(this,"events",new o),j6(this,"pairings"),j6(this,"initialized",!1),j6(this,"storagePrefix",hZ),j6(this,"ignoredPayloadTypes",[1]),j6(this,"registeredMethods",[]),j6(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),j6(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),j6(this,"create",async a=>{this.isInitialized();let b=gA(),c=await this.core.crypto.setSymKey(b),d=cH(r.FIVE_MINUTES),e={protocol:"irn"},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=gW({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(ik,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType,internal:a?.internal}),{topic:c,uri:g}}),j6(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:["pairing_started"]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:h}=gV(a.uri);if(c.props.properties.topic=d,c.addTrace("pairing_uri_validation_success"),c.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace("existing_pairing"),b.active)throw c.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace("pairing_not_expired")}let i=g||cH(r.FIVE_MINUTES),j={topic:d,relay:f,expiry:i,active:!1,methods:h};this.core.expirer.set(d,i),await this.pairings.set(d,j),c.addTrace("store_new_pairing"),a.activatePairing&&await this.activate({topic:d}),this.events.emit(ik,j),c.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError("no_internet_connection")}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError("subscribe_pairing_topic_failure"),a}return c.addTrace("subscribe_pairing_topic_success"),j}),j6(this,"activate",async({topic:a})=>{this.isInitialized();let b=cH(r.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),j6(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=cD();this.events.once(cJ("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),j6(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),j6(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),j6(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),j6(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",he("USER_DISCONNECTED")),await this.deletePairing(b))}),j6(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return gW({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),j6(this,"sendRequest",async(a,b,c)=>{let d=(0,hW.formatJsonRpcRequest)(b,c),e=await this.core.crypto.encode(a,d),f=ij[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),j6(this,"sendResult",async(a,b,c)=>{let d=(0,hW.formatJsonRpcResult)(a,c),e=await this.core.crypto.encode(b,d),f=ij[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),j6(this,"sendError",async(a,b,c)=>{let d=(0,hW.formatJsonRpcError)(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=ij[f]?ij[f].res:ij.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),j6(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,he("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),j6(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>cI(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),j6(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),j6(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),j6(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit("pairing_ping",{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),j6(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{(0,hW.isJsonRpcResult)(b)?this.events.emit(cJ("pairing_ping",c),{}):(0,hW.isJsonRpcError)(b)&&this.events.emit(cJ("pairing_ping",c),{error:b.error})},500)}),j6(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(il,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),j6(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=he("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),j6(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error(he("WC_METHOD_UNSUPPORTED",a))}),j6(this,"isValidPair",(a,b)=>{var c;if(!hp(a)){let{message:c}=hd("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(iw),Error(c)}if(!function(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(hi(a,!1)){if(b(a))return!0;let c=cQ(a);return b(c)}}catch{}return!1}(a.uri)){let{message:c}=hd("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(iw),Error(c)}let d=gV(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=hd("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(iw),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=hd("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(iw),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,r.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError("pairing_expired");let{message:a}=hd("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),j6(this,"isValidPing",async a=>{if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),j6(this,"isValidDisconnect",async a=>{if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),j6(this,"isValidPairingTopic",async a=>{if(!hi(a,!1)){let{message:b}=hd("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=hd("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(cI(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=hd("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=cc(b,this.name),this.pairings=new j4(this.core,this.logger,this.name,this.storagePrefix)}get context(){return cb(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(h3,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==ic&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);(0,hW.isJsonRpcRequest)(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):(0,hW.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(is,async a=>{let{topic:b}=cG(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit("pairing_expire",{topic:b}))})}}var j8=Object.defineProperty,j9=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?j8(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class ka extends hG{constructor(a,b){super(a,b),this.core=a,this.logger=b,j9(this,"records",new Map),j9(this,"events",new o.EventEmitter),j9(this,"name","history"),j9(this,"version","0.3"),j9(this,"cached",[]),j9(this,"initialized",!1),j9(this,"storagePrefix",hZ),j9(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),j9(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:cH(r.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(im,d)}),j9(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=(0,hW.isJsonRpcError)(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(io,b))}),j9(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),j9(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(ip,c)))}),this.persist()}),j9(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),j9(this,"on",(a,b)=>{this.events.on(a,b)}),j9(this,"once",(a,b)=>{this.events.once(a,b)}),j9(this,"off",(a,b)=>{this.events.off(a,b)}),j9(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=cc(b,this.name)}get context(){return cb(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:(0,hW.formatJsonRpcRequest)(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=hd("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=hd("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(im,a=>{this.logger.info(`Emitting ${im}`),this.logger.debug({type:"event",event:im,record:a})}),this.events.on(io,a=>{this.logger.info(`Emitting ${io}`),this.logger.debug({type:"event",event:io,record:a})}),this.events.on(ip,a=>{this.logger.info(`Emitting ${ip}`),this.logger.debug({type:"event",event:ip,record:a})}),this.core.heartbeat.on(hz.li.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,r.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(ip,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}}var kb=Object.defineProperty,kc=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?kb(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class kd extends hM{constructor(a,b){super(a,b),this.core=a,this.logger=b,kc(this,"expirations",new Map),kc(this,"events",new o.EventEmitter),kc(this,"name","expirer"),kc(this,"version","0.3"),kc(this,"cached",[]),kc(this,"initialized",!1),kc(this,"storagePrefix",hZ),kc(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),kc(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),kc(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(iq,{target:c,expiration:d})}),kc(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),kc(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(ir,{target:b,expiration:c})}}),kc(this,"on",(a,b)=>{this.events.on(a,b)}),kc(this,"once",(a,b)=>{this.events.once(a,b)}),kc(this,"off",(a,b)=>{this.events.off(a,b)}),kc(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=cc(b,this.name)}get context(){return cb(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return cF("topic",a);if("number"==typeof a)return cF("id",a);let{message:b}=hd("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=hd("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=hd("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,r.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(is,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(hz.li.pulse,()=>this.checkExpirations()),this.events.on(iq,a=>{this.logger.info(`Emitting ${iq}`),this.logger.debug({type:"event",event:iq,data:a}),this.persist()}),this.events.on(is,a=>{this.logger.info(`Emitting ${is}`),this.logger.debug({type:"event",event:is,data:a}),this.persist()}),this.events.on(ir,a=>{this.logger.info(`Emitting ${ir}`),this.logger.debug({type:"event",event:ir,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}}var ke=Object.defineProperty,kf=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?ke(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class kg extends hN{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,kf(this,"name","verify-api"),kf(this,"abortController"),kf(this,"isDevEnv"),kf(this,"verifyUrlV3",iu),kf(this,"storagePrefix",hZ),kf(this,"version",2),kf(this,"publicKey"),kf(this,"fetchPromise"),kf(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,r.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),kf(this,"register",async a=>{if(!cv()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,s.getDocument)(),b=this.startAbortTimer(5*r.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if((0,bv.Cq)(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(a){this.logger.warn(a)}return""}),kf(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if((0,bv.Cq)(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),kf(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*r.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),kf(this,"getVerifyUrl",a=>{let b=a||it;return iv.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${it}`),b=it),b}),kf(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(r.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),kf(this,"persistPublicKey",async a=>{this.logger.debug(a,"persisting public key to local storage"),await this.store.setItem(this.storeKey,a),this.publicKey=a}),kf(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),kf(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),kf(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),kf(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),kf(this,"validateAttestation",(a,b)=>{let c=function(a,b){let c,d,[e,f,g]=a.split("."),h=Buffer.from(gG(g),"base64");if(64!==h.length)throw Error("Invalid signature length");let i=h.slice(0,32),j=h.slice(32,64),k=d2(`${e}.${f}`),l=(c=Buffer.from(b.x,"base64"),d=Buffer.from(b.y,"base64"),(0,bw.xW)([new Uint8Array([4]),c,d]));if(!gu.verify((0,bw.xW)([i,j]),k,l))throw Error("Invalid signature");return(0,bv.Cq)(a).payload}(a,b.publicKey),d={hasExpired:(0,r.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=cc(b,this.name),this.abortController=new AbortController,this.isDevEnv=cP(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return cb(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,r.toMiliseconds)(a))}}var kh=Object.defineProperty,ki=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?kh(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class kj extends hO{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,ki(this,"context","echo"),ki(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=cc(b,this.context)}}var kk=Object.defineProperty,kl=Object.getOwnPropertySymbols,km=Object.prototype.hasOwnProperty,kn=Object.prototype.propertyIsEnumerable,ko=(a,b,c)=>b in a?kk(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,kp=(a,b)=>{for(var c in b||(b={}))km.call(b,c)&&ko(a,c,b[c]);if(kl)for(var c of kl(b))kn.call(b,c)&&ko(a,c,b[c]);return a},kq=(a,b,c)=>ko(a,"symbol"!=typeof b?b+"":b,c);class kr extends hP{constructor(a,b,c=!0){super(a,b,c),this.core=a,this.logger=b,kq(this,"context","event-client"),kq(this,"storagePrefix",hZ),kq(this,"storageVersion",.1),kq(this,"events",new Map),kq(this,"shouldPersist",!1),kq(this,"init",async()=>{if(!cP())try{let a={eventId:cO(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:cz(this.core.relayer.protocol,this.core.relayer.version,ib)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),kq(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=cO(),g=this.core.projectId||"",h=kp({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),kq(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return kp(kp({},d),this.setMethods(d.eventId))}),kq(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),kq(this,"setEventListeners",()=>{this.core.heartbeat.on(hz.li.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,r.fromMiliseconds)(Date.now())-(0,r.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),kq(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),kq(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),kq(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),kq(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),kq(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,kp(kp({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),kq(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),kq(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${ib}${b}`,{method:"POST",body:JSON.stringify(a)})}),kq(this,"getAppDomain",()=>cy().url),this.logger=cc(b,this.context),this.telemetryEnabled=c,c?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var ks=Object.defineProperty,kt=Object.getOwnPropertySymbols,ku=Object.prototype.hasOwnProperty,kv=Object.prototype.propertyIsEnumerable,kw=(a,b,c)=>b in a?ks(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,kx=(a,b)=>{for(var c in b||(b={}))ku.call(b,c)&&kw(a,c,b[c]);if(kt)for(var c of kt(b))kv.call(b,c)&&kw(a,c,b[c]);return a},ky=(a,b,c)=>kw(a,"symbol"!=typeof b?b+"":b,c);class kz extends hE{constructor(a){var b;super(a),ky(this,"protocol","wc"),ky(this,"version",2),ky(this,"name",hY),ky(this,"relayUrl"),ky(this,"projectId"),ky(this,"customStoragePrefix"),ky(this,"events",new o.EventEmitter),ky(this,"logger"),ky(this,"heartbeat"),ky(this,"relayer"),ky(this,"crypto"),ky(this,"storage"),ky(this,"history"),ky(this,"expirer"),ky(this,"pairing"),ky(this,"verify"),ky(this,"echoClient"),ky(this,"linkModeSupportedApps"),ky(this,"eventClient"),ky(this,"initialized",!1),ky(this,"logChunkController"),ky(this,"on",(a,b)=>this.events.on(a,b)),ky(this,"once",(a,b)=>this.events.once(a,b)),ky(this,"off",(a,b)=>this.events.off(a,b)),ky(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),ky(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:ic};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});const c=this.getGlobalCore(a?.customStoragePrefix);if(c)try{return this.customStoragePrefix=c.customStoragePrefix,this.logger=c.logger,this.heartbeat=c.heartbeat,this.crypto=c.crypto,this.history=c.history,this.expirer=c.expirer,this.storage=c.storage,this.relayer=c.relayer,this.pairing=c.pairing,this.verify=c.verify,this.echoClient=c.echoClient,this.linkModeSupportedApps=c.linkModeSupportedApps,this.eventClient=c.eventClient,this.initialized=c.initialized,this.logChunkController=c.logChunkController,c}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||h2,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";const{logger:d,chunkLoggerController:e}=cd({opts:function(a){return b4(ca({},a),b5({level:a?.level||"info"}))}({level:"string"==typeof a?.logger&&a.logger?a.logger:"error",name:hY}),maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=e,null!=(b=this.logChunkController)&&b.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=cc(d,this.name),this.heartbeat=new hz.VH,this.crypto=new je(this,this.logger,a?.keychain),this.history=new ka(this,this.logger),this.expirer=new kd(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new hA.A(kx(kx({},h$),a?.storageOptions)),this.relayer=new jS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new j7(this,this.logger),this.verify=new kg(this,this.logger,this.storage),this.echoClient=new kj(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new kr(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new kz(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return cb(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(ig,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(ig)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(a,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let kA="client",kB=`wc@2:${kA}:`,kC="WALLETCONNECT_DEEPLINK_CHOICE",kD="Proposal expired",kE=r.SEVEN_DAYS,kF={wc_sessionPropose:{req:{ttl:r.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:r.ONE_DAY,prompt:!1,tag:1104},res:{ttl:r.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:r.ONE_DAY,prompt:!1,tag:1106},res:{ttl:r.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:r.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:r.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:r.ONE_DAY,prompt:!1,tag:1112},res:{ttl:r.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:r.ONE_DAY,prompt:!1,tag:1114},res:{ttl:r.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:r.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:r.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:r.FIVE_MINUTES,prompt:!1,tag:1119}}},kG={min:r.FIVE_MINUTES,max:r.SEVEN_DAYS},kH="IDLE",kI="ACTIVE",kJ={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},kK=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],kL="wc@1.5:auth:",kM=`${kL}:PUB_KEY`;var kN=Object.defineProperty,kO=Object.defineProperties,kP=Object.getOwnPropertyDescriptors,kQ=Object.getOwnPropertySymbols,kR=Object.prototype.hasOwnProperty,kS=Object.prototype.propertyIsEnumerable,kT=(a,b,c)=>b in a?kN(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,kU=(a,b)=>{for(var c in b||(b={}))kR.call(b,c)&&kT(a,c,b[c]);if(kQ)for(var c of kQ(b))kS.call(b,c)&&kT(a,c,b[c]);return a},kV=(a,b,c)=>kT(a,"symbol"!=typeof b?b+"":b,c);class kW extends hT{constructor(a){super(a),kV(this,"name","engine"),kV(this,"events",new o),kV(this,"initialized",!1),kV(this,"requestQueue",{state:kH,queue:[]}),kV(this,"sessionRequestQueue",{state:kH,queue:[]}),kV(this,"emittedSessionRequests",new cR({limit:500})),kV(this,"requestQueueDelay",r.ONE_SECOND),kV(this,"expectedPairingMethodMap",new Map),kV(this,"recentlyDeletedMap",new Map),kV(this,"recentlyDeletedLimit",200),kV(this,"relayMessageCache",[]),kV(this,"pendingSessions",new Map),kV(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(kF)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,r.toMiliseconds)(this.requestQueueDelay)))}),kV(this,"connect",async a=>{var b;this.isInitialized(),await this.confirmOnlineStateOrThrow();let c=kO(kU({},a),kP({requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}}));await this.isValidConnect(c),c.optionalNamespaces=function(a,b){var c,d,e,f,g,h;let i=g9(a),j=g9(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:cK(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:cK(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:cK(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}(c.requiredNamespaces,c.optionalNamespaces),c.requiredNamespaces={};let{pairingTopic:d,requiredNamespaces:e,optionalNamespaces:f,sessionProperties:g,scopedProperties:h,relays:i,authentication:j,walletPay:k}=c,l=(null==(b=j?.[0])?void 0:b.ttl)||kF.wc_sessionPropose.req.ttl||r.FIVE_MINUTES;this.validateRequestExpiry(l);let m=d,n,o=!1;try{if(m){let a=this.client.core.pairing.pairings.get(m);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),o=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${m}) failed`),a}if(!m||!o){let{topic:a,uri:b}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});m=a,n=b}if(!m){let{message:a}=hd("NO_MATCHING_KEY",`connect() pairing topic: ${m}`);throw Error(a)}let p=await this.client.core.crypto.generateKeyPair(),q=cH(l),s=kU(kO(kU(kU({requiredNamespaces:e,optionalNamespaces:f,relays:i??[{protocol:"irn"}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:q,pairingTopic:m},g&&{sessionProperties:g}),h&&{scopedProperties:h}),kP({id:(0,hW.payloadId)()})),(j||k)&&{requests:{authentication:j?.map(a=>{let{domain:b,chains:c,nonce:d,uri:e,exp:f,nbf:g,type:h,statement:i,requestId:j,resources:k,signatureTypes:l}=a;return{domain:b,chains:c,nonce:d,type:h??"caip122",aud:e,version:"1",iat:new Date().toISOString(),exp:f,nbf:g,statement:i,requestId:j,resources:k,signatureTypes:l}}),walletPay:k}}),t=cJ("session_connect",s.id),{reject:u,resolve:v,done:w}=cD(l,kD),x=({id:a})=>{a===s.id&&(this.client.events.off("proposal_expire",x),this.pendingSessions.delete(s.id),this.events.emit(t,{error:{message:kD,code:0}}))};return this.client.events.on("proposal_expire",x),this.events.once(t,({error:a,session:b})=>{this.client.events.off("proposal_expire",x),a?u(a):b&&v(b)}),await this.setProposal(s.id,s),await this.sendProposeSession({proposal:s,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:s.id}}}).catch(a=>{throw this.deleteProposal(s.id),a}),{uri:n,approval:w}}),kV(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),kV(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[ix]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError("no_internet_connection"),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError("proposal_not_found"),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError("session_approve_namespace_validation_failure"),a}let{id:f,relayProtocol:g,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:k,proposalRequestsResponses:l}=a,m=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:n,proposer:o,requiredNamespaces:p,optionalNamespaces:q}=m,r=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:n});r||(r=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:ix,properties:{topic:n,trace:[ix,"session_namespaces_validation_success"]}}));let s=await this.client.core.crypto.generateKeyPair(),t=o.publicKey,u=await this.client.core.crypto.generateSharedKey(s,t),v=kO(kU(kU(kU({relay:{protocol:g??"irn"},namespaces:h,controller:{publicKey:s,metadata:this.client.metadata},expiry:cH(kE)},i&&{sessionProperties:i}),j&&{scopedProperties:j}),k&&{sessionConfig:k}),kP({proposalRequestsResponses:l}));r.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(u,{transportType:id,internal:{skipSubscribe:!0}})}catch(a){throw r.setError("subscribe_session_topic_failure"),a}r.addTrace("subscribe_session_topic_success");let w=kO(kU({},v),kP({topic:u,requiredNamespaces:p,optionalNamespaces:q,pairingTopic:n,acknowledged:!1,self:v.controller,peer:{publicKey:o.publicKey,metadata:o.metadata},controller:s,transportType:id,authentication:l?.authentication,walletPayResult:l?.walletPay}));await this.client.session.set(u,w),r.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:u,proposal:m,pairingProposalResponse:{relay:{protocol:g??"irn"},responderPublicKey:s},sessionSettleRequest:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:kU({correlationId:f},this.getTVFApproveParams(w))}}),r.addTrace("session_approve_publish_success")}catch(a){throw this.client.logger.error(a),this.client.session.delete(u,he("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(u),a}return this.client.core.eventClient.deleteEvent({eventId:r.eventId}),await this.client.core.pairing.updateMetadata({topic:n,metadata:o.metadata}),await this.deleteProposal(f),await this.client.core.pairing.activate({topic:n}),await this.setExpiry(u,cH(kE)),{topic:u,acknowledged:()=>Promise.resolve(this.client.session.get(u))}}),kV(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&await this.sendError({id:c,topic:b,error:d,rpcOpts:kF.wc_sessionPropose.reject}),await this.deleteProposal(c)}),kV(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=cD(r.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),g=(0,hW.payloadId)(),h=(0,hW.getBigIntRpcId)().toString(),i=this.client.session.get(b).namespaces;return this.events.once(cJ("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:h}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:i}),f(a)}),{acknowledged:d}}),kV(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=(0,hW.payloadId)(),{done:d,resolve:e,reject:f}=cD(r.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(cJ("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,cH(kE)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),kV(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=kF.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===id&&await this.confirmOnlineStateOrThrow();let g=(0,hW.payloadId)(),h=(0,hW.getBigIntRpcId)().toString(),{done:i,resolve:j,reject:k}=cD(e,"Request expired. Please try again.");this.events.once(cJ("session_request",g),({error:a,result:b})=>{a?k(a):j(b)});let l="wc_sessionRequest",m=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(m)return await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:{request:kO(kU({},c),kP({expiryTimestamp:cH(e)})),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:m}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),await i();let n={request:kO(kU({},c),kP({expiryTimestamp:cH(e)})),chainId:b};return await Promise.all([new Promise(async a=>{await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:n,expiry:e,throwOnFailedPublish:!0,tvf:this.getTVFParams(g,n)}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await cM(this.client.core.storage,kC);await cL({id:g,topic:d,wcDeepLink:a})}a()}),i()]).then(a=>a[2])}),kV(this,"respond",async a=>{var b,c;this.isInitialized();let d=this.client.core.eventClient.createEvent({properties:{topic:a?.topic||(null==(c=null==(b=a?.response)?void 0:b.id)?void 0:c.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_validation_failure"),a}d.addTrace("session_request_response_validation_success");let{topic:e,response:f}=a,{id:g}=f,h=this.client.session.get(e);h.transportType===id&&await this.confirmOnlineStateOrThrow();let i=this.getAppLinkIfEnabled(h.peer.metadata,h.transportType);try{d.addTrace("session_request_response_publish_started"),(0,hW.isJsonRpcResult)(f)?await this.sendResult({id:g,topic:e,result:f.result,throwOnFailedPublish:!0,appLink:i}):(0,hW.isJsonRpcError)(f)&&await this.sendError({id:g,topic:e,error:f.error,appLink:i}),this.cleanupAfterResponse(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_publish_failure"),a}}),kV(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=(0,hW.payloadId)(),c=(0,hW.getBigIntRpcId)().toString(),{done:d,resolve:e,reject:f}=cD(r.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(cJ("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),kV(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=(0,hW.getBigIntRpcId)().toString(),f=(0,hW.payloadId)();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),kV(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:he("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=hd("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),kV(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>(function(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!cA(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=g5(d),i=c[b];cA(cg(b,i),h)&&cA(i.methods,e)&&cA(i.events,g)||(f=!1)}),f)})(b,a)))),kV(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),kV(this,"authenticate",async(a,b)=>{var c,d,e,f,g;let h;this.isInitialized(),this.isValidAuthenticate(a);let i=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),j=i?ic:id;j===id&&await this.confirmOnlineStateOrThrow();let{chains:k,statement:l="",uri:m,domain:n,nonce:o,type:p,exp:q,nbf:r,methods:s=[],expiry:t}=a,u=[...a.resources||[]],{topic:v,uri:w}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:j});this.client.logger.info({message:"Generated new pairing",pairing:{topic:v,uri:w}});let x=await this.client.core.crypto.generateKeyPair(),y=gB(x);if(await Promise.all([this.client.auth.authKeys.set(kM,{responseTopic:y,publicKey:x}),this.client.auth.pairingTopics.set(y,{topic:y,pairingTopic:v})]),await this.client.core.relayer.subscribe(y,{transportType:j}),this.client.logger.info(`sending request to new pairing topic: ${v}`),s.length>0){let a,b,{namespace:c}=ce(k[0]),h=ez(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(c,"request",s));eD(u)&&(d=h,e=u.pop(),h=ez((f=eA(d),g=eA(e),ey(f),ey(g),a=Object.keys(f.att).concat(Object.keys(g.att)).sort((a,b)=>a.localeCompare(b)),b={att:{}},a.forEach(a=>{var c,d;Object.keys((null==(c=f.att)?void 0:c[a])||{}).concat(Object.keys((null==(d=g.att)?void 0:d[a])||{})).sort((a,b)=>a.localeCompare(b)).forEach(c=>{var d,e;b.att[a]=el(((a,b)=>{for(var c in b||(b={}))eo.call(b,c)&&eq(a,c,b[c]);if(en)for(var c of en(b))ep.call(b,c)&&eq(a,c,b[c]);return a})({},b.att[a]),em({[c]:(null==(d=f.att[a])?void 0:d[c])||(null==(e=g.att[a])?void 0:e[c])}))})}),b))),u.push(h)}let z=t&&t>kF.wc_sessionAuthenticate.req.ttl?t:kF.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:p??"caip122",chains:k,statement:l,aud:m,domain:n,version:"1",nonce:o,iat:new Date().toISOString(),exp:q,nbf:r,resources:u},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:cH(z)},B={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:k,methods:[...new Set(["personal_sign",...s])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:v,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:cH(kF.wc_sessionPropose.req.ttl),id:(0,hW.payloadId)()},{done:C,resolve:D,reject:E}=cD(z,"Request expired"),F=(0,hW.payloadId)(),G=cJ("session_connect",B.id),H=cJ("session_request",F),I=async({error:a,session:b})=>{this.events.off(H,J),a?E(a):b&&D({session:b})},J=async a=>{var c,d,e;let f;if(await this.deletePendingAuthRequest(F,{message:"fulfilled",code:0}),a.error){let b=he("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(G,I),E(a.error.message))}await this.deleteProposal(B.id),this.events.off(G,I);let{cacaos:g,responder:h}=a.result,i=[],k=[];for(let a of g){await ew({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),E(he("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=eD(b.resources),d=[eu(b.iss)],e=ev(b.iss);if(c){let a=eB(c),b=eC(c);i.push(...a),d.push(...b)}for(let a of d)k.push(`${a}:${e}`)}let l=await this.client.core.crypto.generateSharedKey(x,h.publicKey);i.length>0&&(f={topic:l,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:h,controller:h.publicKey,expiry:cH(kE),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:v,namespaces:ha([...new Set(i)],[...new Set(k)]),transportType:j},await this.client.core.relayer.subscribe(l,{transportType:j}),await this.client.session.set(l,f),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:h.metadata}),f=this.client.session.get(l)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=h.metadata.redirect)&&d.linkMode&&null!=(e=h.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.session.update(l,{transportType:ic})),D({auths:g,session:f})};this.events.once(G,I),this.events.once(H,J);try{if(i){let a=(0,hW.formatJsonRpcRequest)("wc_sessionAuthenticate",A,F);this.client.core.history.set(v,a);let c=await this.client.core.crypto.encode("",a,{type:2,encoding:gy});h=gX(b,v,c)}else await Promise.all([this.sendRequest({topic:v,method:"wc_sessionAuthenticate",params:A,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:F}),this.sendRequest({topic:v,method:"wc_sessionPropose",params:B,expiry:kF.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(a){throw this.events.off(G,I),this.events.off(H,J),a}return await this.setProposal(B.id,B),await this.setAuthRequest(F,{request:kO(kU({},A),kP({verifyContext:{}})),pairingTopic:v,transportType:j}),{uri:h??w,response:C}}),kV(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(a){throw e.setError("no_internet_connection"),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${c}`);let g=f.transportType||id;g===id&&await this.confirmOnlineStateOrThrow();let h=f.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),j=gB(h),k={type:1,receiverPublicKey:h,senderPublicKey:i},l=[],m=[];for(let a of d){if(!await ew({cacao:a,projectId:this.client.core.projectId})){e.setError("invalid_cacao");let a=he("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:j,error:a,encodeOpts:k}),Error(a.message)}e.addTrace("cacaos_verified");let{p:b}=a,d=eD(b.resources),f=[eu(b.iss)],g=ev(b.iss);if(d){let a=eB(d),b=eC(d);l.push(...a),f.push(...b)}for(let a of f)m.push(`${a}:${g}`)}let n=await this.client.core.crypto.generateSharedKey(i,h);if(e.addTrace("create_authenticated_session_topic"),l?.length>0){b={topic:n,acknowledged:!0,self:{publicKey:i,metadata:this.client.metadata},peer:{publicKey:h,metadata:f.requester.metadata},controller:h,expiry:cH(kE),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:ha([...new Set(l)],[...new Set(m)]),transportType:g},e.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(n,{transportType:g})}catch(a){throw e.setError("subscribe_authenticated_session_topic_failure"),a}e.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(n,b),e.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:j,id:c,result:{cacaos:d,responder:{publicKey:i,metadata:this.client.metadata}},encodeOpts:k,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,g)})}catch(a){throw e.setError("authenticated_session_approve_publish_failure"),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),kV(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===id&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),g=gB(e);await this.sendError({id:b,topic:g,error:c,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:f},rpcOpts:kF.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.deleteProposal(b)}),kV(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return ex(b,c)}),kV(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),kV(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),kV(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,he("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(kC).catch(a=>this.client.logger.warn(a)),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=kH),await Promise.all(this.getPendingSessionRequests().filter(a=>a.topic===c).map(a=>this.deletePendingSessionRequest(a.id,he("USER_DISCONNECTED")))),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),kV(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(a,he("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),kV(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=kH,this.client.events.emit("session_request_expire",{id:a}))}),kV(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),kV(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),kV(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,cH(kF.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),kV(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=id}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),kV(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||cH(kF.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),kV(this,"sendRequest",async a=>{let b,c,{topic:d,method:e,params:f,expiry:g,relayRpcId:h,clientRpcId:i,throwOnFailedPublish:j,appLink:k,tvf:l,publishOpts:m={}}=a,n=(0,hW.formatJsonRpcRequest)(e,f,i),o=!!k;try{let a=o?gy:gx;b=await this.client.core.crypto.encode(d,n,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${d} failed`),a}if(kK.includes(e)){let a=gC(JSON.stringify(n)),d=gC(b);c=await this.client.core.verify.register({id:d,decryptedId:a})}let p=kU(kU({},kF[e].req),m);if(p.attestation=c,g&&(p.ttl=g),h&&(p.id=h),this.client.core.history.set(d,n),o){let a=gX(k,d,b);await global.Linking.openURL(a,this.client.name)}else{let a;p.tvf=kO(kU({},l),kP({correlationId:n.id})),j?(a=kU({},p.internal),p.internal=kO(a,kP({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(d,b,p)):this.client.core.relayer.publish(d,b,p).catch(a=>this.client.logger.error(a))}return n.id}),kV(this,"sendProposeSession",async a=>{let{proposal:b,publishOpts:c}=a,d=(0,hW.formatJsonRpcRequest)("wc_sessionPropose",b,b.id);this.client.core.history.set(b.pairingTopic,d);let e=await this.client.core.crypto.encode(b.pairingTopic,d,{encoding:gx}),f=gC(JSON.stringify(d)),g=gC(e),h=await this.client.core.verify.register({id:g,decryptedId:f});await this.client.core.relayer.publishCustom({payload:{pairingTopic:b.pairingTopic,sessionProposal:e},opts:kO(kU({},c),kP({publishMethod:"wc_proposeSession",attestation:h}))})}),kV(this,"sendApproveSession",async a=>{let{sessionTopic:b,pairingProposalResponse:c,proposal:d,sessionSettleRequest:e,publishOpts:f}=a,g=(0,hW.formatJsonRpcResult)(d.id,c),h=await this.client.core.crypto.encode(d.pairingTopic,g,{encoding:gx}),i=(0,hW.formatJsonRpcRequest)("wc_sessionSettle",e,f?.id),j=await this.client.core.crypto.encode(b,i,{encoding:gx});this.client.core.history.set(b,i),await this.client.core.relayer.publishCustom({payload:{sessionTopic:b,pairingTopic:d.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:j},opts:kO(kU({},f),kP({publishMethod:"wc_approveSession"}))})}),kV(this,"sendResult",async a=>{let b,c,d,{id:e,topic:f,result:g,throwOnFailedPublish:h,encodeOpts:i,appLink:j}=a,k=(0,hW.formatJsonRpcResult)(e,g),l=j&&"u">typeof(null==global?void 0:global.Linking);try{let a,c,d=l?gy:gx;b=await this.client.core.crypto.encode(f,k,(a=kU({},i||{}),c={encoding:d},kO(a,kP(c))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${f} failed`),a}try{let a=(c=await this.client.core.history.get(f,e)).request;try{d=this.getTVFParams(e,a.params,g)}catch(a){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${a?.message}`)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${f}, ${e}) failed`),a}if(l){let a=gX(j,f,b);await global.Linking.openURL(a,this.client.name)}else{let a,g=kF[c.request.method].res;g.tvf=kO(kU({},d),kP({correlationId:e})),h?(a=kU({},g.internal),g.internal=kO(a,kP({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(f,b,g)):this.client.core.relayer.publish(f,b,g).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(k)}),kV(this,"sendError",async a=>{let b,c,{id:d,topic:e,error:f,encodeOpts:g,rpcOpts:h,appLink:i}=a,j=(0,hW.formatJsonRpcError)(d,f),k=i&&"u">typeof(null==global?void 0:global.Linking);try{let a,c,d=k?gy:gx;b=await this.client.core.crypto.encode(e,j,(a=kU({},g||{}),c={encoding:d},kO(a,kP(c))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${e} failed`),a}try{c=await this.client.core.history.get(e,d)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${e}, ${d}) failed`),a}if(k){let a=gX(i,e,b);await global.Linking.openURL(a,this.client.name)}else{let a=c.request.method,d=h||kF[a].res;this.client.core.relayer.publish(e,b,d)}await this.client.core.history.resolve(j)}),kV(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;cI(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{cI(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),kV(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),kV(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),kV(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===kI)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=kI;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=kH}),kV(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),kV(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),kV(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=hd("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),kV(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),kV(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:g}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError("proposal_listener_not_found")),this.isValidConnect(kU({},c.params));let h=f.expiryTimestamp||cH(kF.wc_sessionPropose.req.ttl),i=kU({id:g,pairingTopic:b,expiryTimestamp:h,attestation:d,encryptedId:e},f);await this.setProposal(g,i);let j=await this.getVerifyContext({attestationId:d,hash:gC(JSON.stringify(c)),encryptedId:e,metadata:i.proposer.metadata});a?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:g,params:i,verifyContext:j})}catch(a){await this.sendError({id:g,topic:b,error:a,rpcOpts:kF.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),kV(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if((0,hW.isJsonRpcResult)(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if((0,hW.isJsonRpcError)(b)){await this.deleteProposal(d);let a=cJ("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),kV(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{let c,e;this.isValidSessionSettleRequest(d);let{relay:f,controller:g,expiry:h,namespaces:i,sessionProperties:j,scopedProperties:k,sessionConfig:l,proposalRequestsResponses:m}=b.params,n=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!n)return this.client.logger.error(`Pending session not found for topic ${a}`);let o=this.client.proposal.get(n.proposalId),p=(c=kU(kU(kU({topic:a,relay:f,expiry:h,namespaces:i,acknowledged:!0,pairingTopic:n.pairingTopic,requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,controller:g.publicKey,self:{publicKey:n.publicKey,metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},j&&{sessionProperties:j}),k&&{scopedProperties:k}),l&&{sessionConfig:l}),e={transportType:id,authentication:m?.authentication,walletPayResult:m?.walletPay},kO(c,kP(e)));await this.client.session.set(p.topic,p),await this.setExpiry(p.topic,p.expiry),await this.client.core.pairing.updateMetadata({topic:n.pairingTopic,metadata:p.peer.metadata}),this.pendingSessions.delete(n.proposalId),this.deleteProposal(n.proposalId,!1),this.cleanupDuplicatePairings(p),await this.sendResult({id:b.id,topic:a,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:p}),this.events.emit(cJ("session_connect",n.proposalId),{session:p})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),kV(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;(0,hW.isJsonRpcResult)(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit(cJ("session_approve",c),{})):(0,hW.isJsonRpcError)(b)&&(await this.client.session.delete(a,he("USER_DISCONNECTED")),this.events.emit(cJ("session_approve",c),{error:b.error}))}),kV(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=hw.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:he("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(kU({topic:a},c));try{hw.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0})}catch(a){throw hw.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),kV(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),kV(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=cJ("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,hW.isJsonRpcResult)(b)?this.events.emit(cJ("session_update",c),{}):(0,hW.isJsonRpcError)(b)&&this.events.emit(cJ("session_update",c),{error:b.error})}),kV(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,cH(kE)),await this.sendResult({id:c,topic:a,result:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),kV(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=cJ("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,hW.isJsonRpcResult)(b)?this.events.emit(cJ("session_extend",c),{}):(0,hW.isJsonRpcError)(b)&&this.events.emit(cJ("session_extend",c),{error:b.error})}),kV(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),kV(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=cJ("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);(0,hW.isJsonRpcResult)(b)?this.events.emit(cJ("session_ping",c),{}):(0,hW.isJsonRpcError)(b)&&this.events.emit(cJ("session_ping",c),{error:b.error})},500)}),kV(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{await this.isValidDisconnect({topic:a,reason:b.params}),this.cleanupPendingSentRequestsForTopic({topic:a,error:he("USER_DISCONNECTED")}),await this.deleteSession({topic:a,id:c})}catch(a){this.client.logger.error(a)}}),kV(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:g,encryptedId:h,transportType:i}=a,{id:j,params:k}=f;try{await this.isValidRequest(kU({topic:e},k));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:g,hash:gC(JSON.stringify((0,hW.formatJsonRpcRequest)("wc_sessionRequest",k,j))),encryptedId:h,metadata:a.peer.metadata,transportType:i}),l={id:j,topic:e,params:k,verifyContext:f};await this.setPendingSessionRequest(l),i===ic&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(l):(this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue())}catch(a){await this.sendError({id:j,topic:e,error:a}),this.client.logger.error(a)}}),kV(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=cJ("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,hW.isJsonRpcResult)(b)?this.events.emit(cJ("session_request",c),{result:b.result}):(0,hW.isJsonRpcError)(b)&&this.events.emit(cJ("session_request",c),{error:b.error})}),kV(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=hw.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(kU({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),hw.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),kV(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),(0,hW.isJsonRpcResult)(b)?this.events.emit(cJ("session_request",c),{result:b.result}):(0,hW.isJsonRpcError)(b)&&this.events.emit(cJ("session_request",c),{error:b.error})}),kV(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:g}=a;try{let{requester:a,authPayload:h,expiryTimestamp:i}=d.params,j=await this.getVerifyContext({attestationId:e,hash:gC(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:g}),k={requester:a,pairingTopic:c,id:d.id,authPayload:h,verifyContext:j,expiryTimestamp:i};await this.setAuthRequest(d.id,{request:k,pairingTopic:c,transportType:g}),g===ic&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:j})}catch(f){this.client.logger.error(f);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,g);await this.sendError({id:d.id,topic:c,error:f,encodeOpts:{type:1,receiverPublicKey:a,senderPublicKey:b},rpcOpts:kF.wc_sessionAuthenticate.autoReject,appLink:e})}}),kV(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),kV(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=kH,this.processSessionRequestQueue()},(0,r.toMiliseconds)(this.requestQueueDelay))}),kV(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{this.events.emit(cJ("session_request",a.request.id),{error:b})})}),kV(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===kI)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),kV(this,"emitSessionRequest",a=>{this.emittedSessionRequests.has(a.id)?this.client.logger.warn({id:a.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${a.id}`):(this.sessionRequestQueue.state=kI,this.emittedSessionRequests.add(a.id),this.client.events.emit("session_request",a))}),kV(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:(0,hW.formatJsonRpcRequest)("wc_sessionPropose",kO(kU({},b),kP({requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties})),b.id),attestation:b.attestation,encryptedId:b.encryptedId})}),kV(this,"isValidConnect",async a=>{let b;if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=a;if(hh(c)||await this.isValidPairingTopic(c),b=!1,h?h&&hf(h)&&h.length&&h.forEach(a=>{b=ho(a)}):b=!0,!b){let{message:a}=hd("MISSING_OR_INVALID",`connect() relays: ${h}`);throw Error(a)}if(d&&!hh(d)&&0!==hg(d)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(d,"requiredNamespaces")}if(e&&!hh(e)&&0!==hg(e)&&this.validateNamespaces(e,"optionalNamespaces"),f&&!hh(f)&&this.validateSessionProps(f,"sessionProperties"),g&&!hh(g)){this.validateSessionProps(g,"scopedProperties");let a=Object.keys(d||{}).concat(Object.keys(e||{}));if(!Object.keys(g).every(b=>a.includes(b.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(g)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),kV(this,"validateNamespaces",(a,b)=>{let c=function(a,b,c){let d=null;if(a&&hg(a)){let e,f=hm(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=cg(a,d),g=`${b} ${c}`,h=null,hf(f)&&f.length?f.forEach(a=>{h||hk(a)||(h=he("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):hk(a)||(h=he("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=hd("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}(a,"connect()",b);if(c)throw Error(c.message)}),kV(this,"isValidApprove",async a=>{if(!hp(a))throw Error(hd("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=hn(c,"approve()");if(h)throw Error(h.message);let i=hr(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!hi(d,!0)){let{message:a}=hd("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(e&&!hh(e)&&this.validateSessionProps(e,"sessionProperties"),f&&!hh(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),kV(this,"isValidReject",async a=>{if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!c||"object"!=typeof c||!c.code||!hj(c.code,!1)||!c.message||!hi(c.message,!1)){let{message:a}=hd("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),kV(this,"isValidSessionSettleRequest",a=>{let b;if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:c,controller:d,namespaces:e,expiry:f}=a;if(!ho(c)){let{message:a}=hd("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let g=(b=null,hi(d?.publicKey,!1)||(b=hd("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),b);if(g)throw Error(g.message);let h=hn(e,"onSessionSettleRequest()");if(h)throw Error(h.message);if(cI(f)){let{message:a}=hd("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),kV(this,"isValidUpdate",async a=>{if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=hn(c,"update()");if(e)throw Error(e.message);let f=hr(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),kV(this,"isValidExtend",async a=>{if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),kV(this,"isValidRequest",async a=>{var b;let c;if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:d,request:e,chainId:f,expiry:g}=a;this.checkRecentlyDeleted(d),await this.isValidSessionTopic(d);let{namespaces:h}=this.client.session.get(d);if(!hq(h,f)){let{message:a}=hd("MISSING_OR_INVALID",`request() chainId: ${f}`);throw Error(a)}if(hh(e)||!hi(e.method,!1)){let{message:a}=hd("MISSING_OR_INVALID",`request() ${JSON.stringify(e)}`);throw Error(a)}if(!(hi(b=e.method,!1)&&(c=[],Object.values(h).forEach(a=>{g5(a.accounts).includes(f)&&c.push(...a.methods)}),c).includes(b))){let{message:a}=hd("MISSING_OR_INVALID",`request() method: ${e.method}`);throw Error(a)}this.validateRequestExpiry(g)}),kV(this,"isValidRespond",async a=>{var b;if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(hh(d)||hh(d.result)&&hh(d.error)||!hj(d.id,!1)||!hi(d.jsonrpc,!1)){let{message:a}=hd("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}let e=this.client.pendingRequest.get(d.id);if(e.topic!==c){let{message:a}=hd("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${d.id}, expected topic: ${e.topic}, received topic: ${c}`);throw Error(a)}}),kV(this,"isValidPing",async a=>{if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),kV(this,"isValidEmit",async a=>{var b;let c;if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:d,event:e,chainId:f}=a;await this.isValidSessionTopic(d);let{namespaces:g}=this.client.session.get(d);if(!hq(g,f)){let{message:a}=hd("MISSING_OR_INVALID",`emit() chainId: ${f}`);throw Error(a)}if(hh(e)||!hi(e.name,!1)||!(hi(b=e.name,!1)&&(c=[],Object.values(g).forEach(a=>{g5(a.accounts).includes(f)&&c.push(...a.events)}),c).includes(b))){let{message:a}=hd("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(e)}`);throw Error(a)}}),kV(this,"isValidDisconnect",async a=>{if(!hp(a)){let{message:b}=hd("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),kV(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!hi(c,!1))throw Error("uri is required parameter");if(!hi(d,!1))throw Error("domain is required parameter");if(!hi(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>ce(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=ce(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),kV(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,g={verified:{verifyUrl:e.verifyUrl||it,validation:"UNKNOWN",origin:e.url||""}};try{if(f===ic){let a=this.getAppLinkIfEnabled(e,f);return g.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",g}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(g.verified.origin=a.origin,g.verified.isScam=a.isScam,g.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(g)}`),g}),kV(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=hd("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),kV(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),kV(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),kV(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=hd("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),kV(this,"isLinkModeEnabled",(a,b)=>{var c,d,e,f,g,h,i,j,k;return!!a&&b===ic&&(null==(d=null==(c=this.client.metadata)?void 0:c.redirect)?void 0:d.linkMode)===!0&&(null==(f=null==(e=this.client.metadata)?void 0:e.redirect)?void 0:f.universal)!==void 0&&(null==(h=null==(g=this.client.metadata)?void 0:g.redirect)?void 0:h.universal)!==""&&(null==(i=a?.redirect)?void 0:i.universal)!==void 0&&(null==(j=a?.redirect)?void 0:j.universal)!==""&&(null==(k=a?.redirect)?void 0:k.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(a.redirect.universal)&&"u">typeof(null==global?void 0:global.Linking)}),kV(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),kV(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=cN(a,"topic")||"",c=decodeURIComponent(cN(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:ic}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),kV(this,"registerLinkModeListeners",async()=>{var a;if(cP()||cu()&&null!=(a=this.client.metadata.redirect)&&a.linkMode){let a=null==global?void 0:global.Linking;if("u">typeof a){a.addEventListener("url",this.handleLinkModeMessage,this.client.name);let b=await a.getInitialURL();b&&setTimeout(()=>{this.handleLinkModeMessage({url:b})},50)}}}),kV(this,"getTVFApproveParams",a=>{try{var b,c;let d,e,f=g6(a.namespaces),g=(b=a.namespaces,d=[],Object.values(b).forEach(a=>{d.push(...a.methods)}),[...new Set(d)]),h=(c=a.namespaces,e=[],Object.values(c).forEach(a=>{e.push(...a.events)}),[...new Set(e)]),i=a.sessionProperties,j=a.scopedProperties;return{approvedChains:f,approvedMethods:g,approvedEvents:h,sessionProperties:i,scopedProperties:j}}catch(a){return this.client.logger.warn(a,"Error getting TVF approve params"),{}}}),kV(this,"getTVFParams",(a,b,c)=>{var d,e,f;if(!(null!=(d=b.request)&&d.method))return{};let g={correlationId:a,rpcMethods:[b.request.method],chainId:b.chainId};try{g.txHashes=this.extractTxHashesFromResult(b.request,c),g.contractAddresses=this.isValidContractData(b.request.params)?[null==(f=null==(e=b.request.params)?void 0:e[0])?void 0:f.to]:[]}catch(a){this.client.logger.warn(a,"Error getting TVF params")}return g}),kV(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),kV(this,"extractTxHashesFromResult",(a,b)=>{var c,d,e,f,g;try{if(!b)return[];let h=a.method,i=kJ[h];if("sui_signTransaction"===h){let a,c,d,f;return[(e=b.transactionBytes,a=new Uint8Array(Buffer.from(e,"base64")),c=Array.from("TransactionData::").map(a=>a.charCodeAt(0)),(d=new Uint8Array(c.length+a.length)).set(c),d.set(a,c.length),f=ed(d,{dkLen:32}),br.encode(f))]}if("near_signTransaction"===h)return[eh(b)];if("near_signTransactions"===h)return b.map(a=>eh(a));if("xrpl_signTransactionFor"===h||"xrpl_signTransaction"===h)return[null==(c=b.tx_json)?void 0:c.hash];if("polkadot_signTransaction"===h){let c,e,f,g;return[(d={transaction:a.params.transactionPayload,signature:b.signature},f=Uint8Array.from(Buffer.from(d.signature,"hex")),g=function({publicKey:a,signature:b,payload:c}){var d,e,f;let g,h=hx(c.method),i=128|parseInt((null==(d=c.version)?void 0:d.toString())||"4"),j=(e=c.address,g=br.decode(e)[0],42===g?0:60===g?2:1),k="00"===c.era?new Uint8Array([0]):hx(c.era);if(1!==k.length&&2!==k.length)throw Error("Invalid era length");let l=parseInt(c.nonce,16),m=new Uint8Array([255&l,l>>8&255]),n=new Uint8Array([0,...a,j,...b,...k,...m,...function(a){if(a<BigInt(1)<<BigInt(6))return new Uint8Array([Number(a<<BigInt(2))]);if(a<BigInt(1)<<BigInt(14)){let b=a<<BigInt(2)|BigInt(1);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255))])}if(a<BigInt(1)<<BigInt(30)){let b=a<<BigInt(2)|BigInt(2);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255)),Number(b>>BigInt(16)&BigInt(255)),Number(b>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(f=c.tip).startsWith("0x")?f.slice(2):f}`)),...h]);return new Uint8Array([...function(a){if(a<64)return new Uint8Array([a<<2]);if(a<16384){let b=a<<2|1;return new Uint8Array([255&b,b>>8&255])}if(a<0x40000000){let b=a<<2|2;return new Uint8Array([255&b,b>>8&255,b>>16&255,b>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(n.length+1),i,...n])}({publicKey:function(a){let b=br.decode(a);if(b.length<33)throw Error("Too short to contain a public key");return b.slice(1,33)}(d.transaction.address),signature:f,payload:d.transaction}),c=hx(Buffer.from(g).toString("hex")),e=(0,by.blake2b)(c,void 0,32),"0x"+Buffer.from(e).toString("hex"))]}if("algo_signTxn"===h)return hf(b)?b.map(a=>ei(a)):[ei(b)];if("cosmos_signDirect"===h){let a,c,d,e,f;return[(a=Buffer.from(b.signed.bodyBytes,"base64"),c=Buffer.from(b.signed.authInfoBytes,"base64"),d=Buffer.from(b.signature.signature,"base64"),(e=[]).push(Buffer.from([10])),e.push(ej(a.length)),e.push(a),e.push(Buffer.from([18])),e.push(ej(c.length)),e.push(c),e.push(Buffer.from([26])),e.push(ej(d.length)),e.push(d),f=d2(Buffer.concat(e)),Buffer.from(f).toString("hex").toUpperCase())]}if("wallet_sendCalls"===h){let a=[];try{if("string"==typeof b)return a.push(b),a;if("object"!=typeof b)return a;null!=b&&b.id&&a.push(b.id);let c=null==(g=null==(f=b?.capabilities)?void 0:f.caip345)?void 0:g.transactionHashes;c&&a.push(...c)}catch(a){console.warn("getWalletSendCallsHashes failed: ",a)}return a}if("string"==typeof b)return[b];let j=b[i.key];if(hf(j))return"solana_signAllTransactions"===h?j.map(a=>(function(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return br.encode(e)})(a)):j;if("string"==typeof j)return[j]}catch(a){this.client.logger.warn(a,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn(a,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:a}=hd("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(h3,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(kM)?this.client.auth.authKeys.get(kM):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===ic?gy:gx});(0,hW.isJsonRpcRequest)(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:gC(c)})):(0,hW.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e})),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${c}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(is,async a=>{let{topic:b,id:c}=cG(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,hd("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,hd("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(ik,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(il,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!hi(a,!1)){let{message:b}=hd("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=hd("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(cI(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=hd("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!hi(a,!1)){let{message:b}=hd("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=hd("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if(cI(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=hd("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=hd("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if(hi(a,!1)){let{message:b}=hd("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=hd("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if("number"!=typeof a){let{message:b}=hd("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=hd("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if(cI(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=hd("EXPIRED",`proposal id: ${a}`);throw Error(b)}}validateRequestExpiry(a){if(a&&(!hj(a,!1)||!(a<=kG.max)||!(a>=kG.min))){let{message:b}=hd("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${kG.min} and ${kG.max}`);throw Error(b)}}}class kX extends j4{constructor(a,b){super(a,b,"proposal",kB),this.core=a,this.logger=b}}class kY extends j4{constructor(a,b){super(a,b,"session",kB),this.core=a,this.logger=b}}class kZ extends j4{constructor(a,b){super(a,b,"request",kB,a=>a.id),this.core=a,this.logger=b}}class k$ extends j4{constructor(a,b){super(a,b,"authKeys",kL,()=>kM),this.core=a,this.logger=b}}class k_ extends j4{constructor(a,b){super(a,b,"pairingTopics",kL),this.core=a,this.logger=b}}class k0 extends j4{constructor(a,b){super(a,b,"requests",kL,a=>a.id),this.core=a,this.logger=b}}var k1=Object.defineProperty,k2=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?k1(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class k3{constructor(a,b){this.core=a,this.logger=b,k2(this,"authKeys"),k2(this,"pairingTopics"),k2(this,"requests"),this.authKeys=new k$(this.core,this.logger),this.pairingTopics=new k_(this.core,this.logger),this.requests=new k0(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var k4=Object.defineProperty,k5=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?k4(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class k6 extends hS{constructor(a){super(a),k5(this,"protocol","wc"),k5(this,"version",2),k5(this,"name",kA),k5(this,"metadata"),k5(this,"core"),k5(this,"logger"),k5(this,"events",new o.EventEmitter),k5(this,"engine"),k5(this,"session"),k5(this,"proposal"),k5(this,"pendingRequest"),k5(this,"auth"),k5(this,"signConfig"),k5(this,"on",(a,b)=>this.events.on(a,b)),k5(this,"once",(a,b)=>this.events.once(a,b)),k5(this,"off",(a,b)=>this.events.off(a,b)),k5(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),k5(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),k5(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),k5(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),k5(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||kA,this.metadata=function(a){var b,c;let d=cy();try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=co(co({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},ci(e,cj(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}(a?.metadata),this.signConfig=a?.signConfig;const b=hy({logger:a?.logger||"error",name:this.name});this.logger=b,this.core=a?.core||new kz(a),this.session=new kY(this.core,this.logger),this.proposal=new kX(this.core,this.logger),this.pendingRequest=new kZ(this.core,this.logger),this.engine=new kW(this),this.auth=new k3(this.core,this.logger)}static async init(a){let b=new k6(a);return await b.initialize(),b}get context(){return cb(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}var k7=c(93882);function k8(a){return null==a||"object"!=typeof a&&"function"!=typeof a}function k9(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function la(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let lb="[object String]",lc="[object Number]",ld="[object Boolean]",le="[object Arguments]";function lf(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function lg(a,b,c,d=new Map,e){let f=e?.(a,b,c,d);if(null!=f)return f;if(k8(a))return a;if(d.has(a))return d.get(a);if(Array.isArray(a)){let b=Array(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=lg(a[f],f,c,d,e);return Object.hasOwn(a,"index")&&(b.index=a.index),Object.hasOwn(a,"input")&&(b.input=a.input),b}if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp){let b=new RegExp(a.source,a.flags);return b.lastIndex=a.lastIndex,b}if(a instanceof Map){let b=new Map;for(let[f,g]of(d.set(a,b),a))b.set(f,lg(g,f,c,d,e));return b}if(a instanceof Set){let b=new Set;for(let f of(d.set(a,b),a))b.add(lg(f,void 0,c,d,e));return b}if("u">typeof Buffer&&Buffer.isBuffer(a))return a.subarray();if(lf(a)){let b=new(Object.getPrototypeOf(a)).constructor(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=lg(a[f],f,c,d,e);return b}if(a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);if(a instanceof DataView){let b=new DataView(a.buffer.slice(0),a.byteOffset,a.byteLength);return d.set(a,b),lh(b,a,c,d,e),b}if("u">typeof File&&a instanceof File){let b=new File([a],a.name,{type:a.type});return d.set(a,b),lh(b,a,c,d,e),b}if(a instanceof Blob){let b=new Blob([a],{type:a.type});return d.set(a,b),lh(b,a,c,d,e),b}if(a instanceof Error){let b=new a.constructor;return d.set(a,b),b.message=a.message,b.name=a.name,b.stack=a.stack,b.cause=a.cause,lh(b,a,c,d,e),b}if("object"==typeof a&&function(a){switch(la(a)){case le:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case ld:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case lc:case"[object Object]":case"[object RegExp]":case"[object Set]":case lb:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(a)){let b=Object.create(Object.getPrototypeOf(a));return d.set(a,b),lh(b,a,c,d,e),b}return a}function lh(a,b,c=a,d,e){let f=[...Object.keys(b),...k9(b)];for(let g=0;g<f.length;g++){let h=f[g],i=Object.getOwnPropertyDescriptor(a,h);(null==i||i.writable)&&(a[h]=lg(b[h],h,c,d,e))}}function li(a){var b;return b=(b,c,d,e)=>{let f;if(null!=f)return f;if("object"==typeof a)switch(Object.prototype.toString.call(a)){case lc:case lb:case ld:{let b=new a.constructor(a?.valueOf());return lh(b,a),b}case le:{let b={};return lh(b,a),b.length=a.length,b[Symbol.iterator]=a[Symbol.iterator],b}default:return}},lg(a,void 0,a,new Map,b)}function lj(a){return null!==a&&"object"==typeof a&&"[object Arguments]"===la(a)}function lk(a){return"object"==typeof a&&null!==a}function ll(){}let lm="error",ln="universal_provider",lo=`wc@2:${ln}:`,lp="https://rpc.walletconnect.org/v1/",lq="generic",lr=`${lp}bundler`,ls="call_status",lt="default_chain_changed";var lu=Object.defineProperty,lv=Object.defineProperties,lw=Object.getOwnPropertyDescriptors,lx=Object.getOwnPropertySymbols,ly=Object.prototype.hasOwnProperty,lz=Object.prototype.propertyIsEnumerable,lA=(a,b,c)=>b in a?lu(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lB=(a,b)=>{for(var c in b||(b={}))ly.call(b,c)&&lA(a,c,b[c]);if(lx)for(var c of lx(b))lz.call(b,c)&&lA(a,c,b[c]);return a},lC=(a,b)=>lv(a,lw(b));function lD(a,b,c){var d;let e=ce(a);return(null==(d=b.rpcMap)?void 0:d[e.reference])||`${lp}?chainId=${e.namespace}:${e.reference}&projectId=${c}`}function lE(a){return a.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)}function lF(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>{var c,d;return(null==(c=b?.chains)?void 0:c.length)&&(null==(d=b?.chains)?void 0:d.length)>0}))}function lG(a={},b={}){return function(a,...b){return function(a,...b){let c=b.slice(0,-1),d=b[b.length-1],e=a;for(let a=0;a<c.length;a++)e=function a(b,c,d,e){if(k8(b)&&(b=Object(b)),null==c||"object"!=typeof c)return b;if(e.has(c))return function(a){if(k8(a))return a;if(Array.isArray(a)||lf(a)||a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);let b=Object.getPrototypeOf(a),c=b.constructor;if(a instanceof Date||a instanceof Map||a instanceof Set)return new c(a);if(a instanceof RegExp){let b=new c(a);return b.lastIndex=a.lastIndex,b}if(a instanceof DataView)return new c(a.buffer.slice(0));if(a instanceof Error){let b=new c(a.message);return b.stack=a.stack,b.name=a.name,b.cause=a.cause,b}return"u">typeof File&&a instanceof File?new c([a],a.name,{type:a.type,lastModified:a.lastModified}):"object"==typeof a?Object.assign(Object.create(b),a):a}(e.get(c));if(e.set(c,b),Array.isArray(c)){c=c.slice();for(let a=0;a<c.length;a++)c[a]=c[a]??void 0}let f=[...Object.keys(c),...k9(c)];for(let g=0;g<f.length;g++){let h=f[g],i=c[h],j=b[h];if(lj(i)&&(i={...i}),lj(j)&&(j={...j}),"u">typeof Buffer&&Buffer.isBuffer(i)&&(i=li(i)),Array.isArray(i))if("object"==typeof j&&null!=j){let a=[],b=Reflect.ownKeys(j);for(let c=0;c<b.length;c++){let d=b[c];a[d]=j[d]}j=a}else j=[];let k=d(j,i,h,b,c,e);null!=k?b[h]=k:Array.isArray(i)||lk(j)&&lk(i)?b[h]=a(j,i,d,e):null==j&&function(a){if("object"!=typeof a||null==a)return!1;if(null===Object.getPrototypeOf(a))return!0;if("[object Object]"!==Object.prototype.toString.call(a)){let b=a[Symbol.toStringTag];return null!=b&&!!Object.getOwnPropertyDescriptor(a,Symbol.toStringTag)?.writable&&a.toString()===`[object ${b}]`}let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}(i)?b[h]=a({},i,d,e):null==j&&lf(i)?b[h]=li(i):(void 0===j||void 0!==i)&&(b[h]=i)}return b}(e,c[a],d,new Map);return e}(a,...b,ll)}(lF(lH(a)),lF(lH(b)))}function lH(a){var b,c,d,e,f;let g={};if(!hg(a))return g;for(let[h,i]of Object.entries(a)){let a=g7(h)?[h]:i.chains,j=i.methods||[],k=i.events||[],l=i.rpcMap||{},m=g8(h);g[m]=lC(lB(lB({},g[m]),i),{chains:cK(a,null==(b=g[m])?void 0:b.chains),methods:cK(j,null==(c=g[m])?void 0:c.methods),events:cK(k,null==(d=g[m])?void 0:d.events)}),(hg(l)||hg((null==(e=g[m])?void 0:e.rpcMap)||{}))&&(g[m].rpcMap=lB(lB({},l),null==(f=g[m])?void 0:f.rpcMap))}return g}function lI(a){return a.includes(":")?a.split(":")[2]:a}function lJ(a){let b={};for(let[c,d]of Object.entries(a)){let a=d.methods||[],e=d.events||[],f=d.accounts||[],g=g7(c)?[c]:d.chains?d.chains:lE(d.accounts);b[c]={chains:g,methods:a,events:e,accounts:f}}return b}function lK(a){return"number"==typeof a?a:a.includes("0x")?parseInt(a,16):isNaN(Number(a=a.includes(":")?a.split(":")[1]:a))?a:Number(a)}let lL={},lM=a=>lL[a],lN=(a,b)=>{lL[a]=b};var lO=Object.defineProperty,lP=Object.getOwnPropertySymbols,lQ=Object.prototype.hasOwnProperty,lR=Object.prototype.propertyIsEnumerable,lS=(a,b,c)=>b in a?lO(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lT=(a,b)=>{for(var c in b||(b={}))lQ.call(b,c)&&lS(a,c,b[c]);if(lP)for(var c of lP(b))lR.call(b,c)&&lS(a,c,b[c]);return a};let lU="eip155",lV=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],lW=a=>a&&a.startsWith("0x")?BigInt(a).toString(10):a,lX=a=>a&&a.startsWith("0x")?a:`0x${BigInt(a).toString(16)}`,lY=a=>Object.keys(a).filter(a=>lV.includes(a)).reduce((b,c)=>(b[c]=lZ(a[c]),b),{}),lZ=a=>"string"==typeof a&&function(a){try{let b=JSON.parse(a);return"object"==typeof b&&null!==b&&!Array.isArray(b)}catch{return!1}}(a)?JSON.parse(a):a;var l$=Object.defineProperty;class l_{constructor(a){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?l$(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"storage"),this.storage=a}async getItem(a){return await this.storage.getItem(a)}async setItem(a,b){return await this.storage.setItem(a,b)}async removeItem(a){return await this.storage.removeItem(a)}static getStorage(a){return d||(d=new l_(a)),d}}var l0=Object.defineProperty,l1=Object.defineProperties,l2=Object.getOwnPropertyDescriptors,l3=Object.getOwnPropertySymbols,l4=Object.prototype.hasOwnProperty,l5=Object.prototype.propertyIsEnumerable,l6=(a,b,c)=>b in a?l0(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;async function l7(a,b){let c,d=ce(a.result.capabilities.caip345.caip2),e=a.result.capabilities.caip345.transactionHashes,f=await Promise.allSettled(e.map(a=>l8(d.reference,a,b))),g=f.filter(a=>"fulfilled"===a.status).map(a=>a.value).filter(a=>a);f.filter(a=>"rejected"===a.status).forEach(a=>console.warn("Failed to fetch transaction receipt:",a.reason));let h=!g.length||g.some(a=>!a),i=g.every(a=>a?.status==="0x1"),j=g.every(a=>a?.status==="0x0"),k=g.some(a=>a?.status==="0x0");return h?c=100:i?c=200:j?c=500:k&&(c=600),{id:a.result.id,version:a.request.version,atomic:a.request.atomicRequired,chainId:a.request.chainId,capabilities:a.result.capabilities,receipts:g,status:c}}async function l8(a,b,c){return await c(parseInt(a)).request((0,hW.formatJsonRpcRequest)("eth_getTransactionReceipt",[b]))}async function l9({sendCalls:a,storage:b}){let c=await b.getItem(ls);await b.setItem(ls,l1(((a,b)=>{for(var c in b||(b={}))l4.call(b,c)&&l6(a,c,b[c]);if(l3)for(var c of l3(b))l5.call(b,c)&&l6(a,c,b[c]);return a})({},c),l2({[a.result.id]:{request:a.request,result:a.result,expiry:cH(86400)}})))}async function ma({resultId:a,storage:b}){let c=await b.getItem(ls);if(c){for(let d in delete c[a],await b.setItem(ls,c),c)cI(c[d].expiry)&&delete c[d];await b.setItem(ls,c)}}async function mb({resultId:a,storage:b}){let c=await b.getItem(ls),d=c?.[a];if(d&&!cI(d.expiry))return d;await ma({resultId:a,storage:b})}var mc=Object.defineProperty,md=Object.defineProperties,me=Object.getOwnPropertyDescriptors,mf=Object.getOwnPropertySymbols,mg=Object.prototype.hasOwnProperty,mh=Object.prototype.propertyIsEnumerable,mi=(a,b,c)=>b in a?mc(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mj=(a,b)=>{for(var c in b||(b={}))mg.call(b,c)&&mi(a,c,b[c]);if(mf)for(var c of mf(b))mh.call(b,c)&&mi(a,c,b[c]);return a},mk=(a,b,c)=>mi(a,"symbol"!=typeof b?b+"":b,c);class ml{constructor(a){mk(this,"name","eip155"),mk(this,"client"),mk(this,"chainId"),mk(this,"namespace"),mk(this,"httpProviders"),mk(this,"events"),mk(this,"storage"),this.namespace=a.namespace,this.events=lM("events"),this.client=lM("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=l_.getStorage(this.client.core.storage)}async request(a){switch(a.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(a);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(a);case"wallet_getCallsStatus":return await this.getCallStatus(a);case"wallet_sendCalls":return await this.sendCalls(a)}return this.namespace.methods.includes(a.request.method)?await this.client.request(a):this.getHttpProvider().request(a.request)}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(parseInt(a),b);let c=this.chainId;this.chainId=parseInt(a),this.events.emit(lt,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}createHttpProvider(a,b){let c=b||lD(`${this.name}:${a}`,this.namespace,this.client.core.projectId);if(!c)throw Error(`No RPC url provided for chainId: ${a}`);return new hV.F(new k7.V(c,lM("disableProviderPing")))}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=parseInt(b.includes(":")?b.split(":")[1]:b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}getHttpProvider(a){let b=a||this.chainId;return this.httpProviders[b]||(this.httpProviders=md(mj({},this.httpProviders),me({[b]:this.createHttpProvider(b)})),this.httpProviders[b])}async handleSwitchChain(a){var b,c;let d=a.request.params?null==(b=a.request.params[0])?void 0:b.chainId:"0x0",e=parseInt(d=d.startsWith("0x")?d:`0x${d}`,16);if(this.isChainApproved(e))this.setDefaultChain(`${e}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:a.topic,request:{method:a.request.method,params:[{chainId:d}]},chainId:null==(c=this.namespace.chains)?void 0:c[0]}),this.setDefaultChain(`${e}`);else throw Error(`Failed to switch to chain 'eip155:${e}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(a){return this.namespace.chains.includes(`${this.name}:${a}`)}async getCapabilities(a){var b,c,d,e,f;let g,h=null==(c=null==(b=a.request)?void 0:b.params)?void 0:c[0],i=(null==(e=null==(d=a.request)?void 0:d.params)?void 0:e[1])||[];if(!h)throw Error("Missing address parameter in `wallet_getCapabilities` request");let j=this.client.session.get(a.topic),k=(null==(f=j?.sessionProperties)?void 0:f.capabilities)||{},l=`${h}${i.join(",")}`,m=k?.[l];if(m)return m;try{g=((a,b,c)=>{let{sessionProperties:d={},scopedProperties:e={}}=a,f={};if(!hg(e)&&!hg(d))return;let g=lY(d);for(let a of c){let c=lW(a);if(!c)continue;f[lX(c)]=g;let d=e?.[`${lU}:${c}`];if(d){let a=d?.[`${lU}:${c}:${b}`];f[lX(c)]=lT(lT({},f[lX(c)]),lY(a||d))}}for(let[a,b]of Object.entries(f))0===Object.keys(b).length&&delete f[a];return Object.keys(f).length>0?f:void 0})(j,h,i)}catch(a){console.warn("Failed to extract capabilities from session",a)}if(g)return g;let n=await this.client.request(a);try{let b,c,d,e;await this.client.session.update(a.topic,{sessionProperties:(d=mj({},j.sessionProperties||{}),e={capabilities:(b=mj({},k||{}),c={[l]:n},md(b,me(c)))},md(d,me(e)))})}catch(a){console.warn("Failed to update session with capabilities",a)}return n}async getCallStatus(a){var b,c,d;let e=this.client.session.get(a.topic),f=null==(b=e.sessionProperties)?void 0:b.bundler_name;if(f){let b=this.getBundlerUrl(a.chainId,f);try{return await this.getUserOperationReceipt(b,a)}catch(a){console.warn("Failed to fetch call status from bundler",a,b)}}let g=null==(c=e.sessionProperties)?void 0:c.bundler_url;if(g)try{return await this.getUserOperationReceipt(g,a)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,g)}let h=await mb({resultId:null==(d=a.request.params)?void 0:d[0],storage:this.storage});if(h)try{return await l7(h,this.getHttpProvider.bind(this))}catch(a){console.warn("Failed to fetch call status from stored send calls",a,h)}if(this.namespace.methods.includes(a.request.method))return await this.client.request(a);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(a,b){var c;let d=new URL(a),e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,hW.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(c=b.request.params)?void 0:c[0]]))});if(!e.ok)throw Error(`Failed to fetch user operation receipt - ${e.status}`);return await e.json()}getBundlerUrl(a,b){return`${lr}?projectId=${this.client.core.projectId}&chainId=${a}&bundler=${b}`}async sendCalls(a){var b,c,d;let e=await this.client.request(a),f=null==(b=a.request.params)?void 0:b[0],g=e?.id,h=e?.capabilities||{},i=null==(c=h?.caip345)?void 0:c.caip2,j=null==(d=h?.caip345)?void 0:d.transactionHashes;return g&&i&&null!=j&&j.length&&await l9({sendCalls:{request:f,result:e},storage:this.storage}),e}}var mm=Object.defineProperty,mn=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?mm(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class mo{constructor(a){mn(this,"name",lq),mn(this,"client"),mn(this,"httpProviders"),mn(this,"events"),mn(this,"namespace"),mn(this,"chainId"),this.namespace=a.namespace,this.events=lM("events"),this.client=lM("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(a.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(a.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(a.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(a.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider(a.chainId).request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b);let c=this.chainId;this.chainId=a,this.events.emit(lt,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getNamespaceName(){let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return ce(a).namespace}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){var a,b;let c={};return null==(b=null==(a=this.namespace)?void 0:a.accounts)||b.forEach(a=>{var b,d;let e=ce(a),f=null==(d=null==(b=this.namespace)?void 0:b.rpcMap)?void 0:d[`${e.namespace}:${e.reference}`];c[e.reference]=this.createHttpProvider(a,f)}),c}getHttpProvider(a){let b=ce(a).reference,c=this.httpProviders[b];if(typeof c>"u")throw Error(`JSON-RPC provider for ${a} not found`);return c}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||lD(a,this.namespace,this.client.core.projectId);if(!c)throw Error(`No RPC url provided for chainId: ${a}`);return new hV.F(new k7.A(c,lM("disableProviderPing")))}}var mp=Object.defineProperty,mq=Object.defineProperties,mr=Object.getOwnPropertyDescriptors,ms=Object.getOwnPropertySymbols,mt=Object.prototype.hasOwnProperty,mu=Object.prototype.propertyIsEnumerable,mv=(a,b,c)=>b in a?mp(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mw=(a,b)=>{for(var c in b||(b={}))mt.call(b,c)&&mv(a,c,b[c]);if(ms)for(var c of ms(b))mu.call(b,c)&&mv(a,c,b[c]);return a},mx=(a,b,c)=>mv(a,"symbol"!=typeof b?b+"":b,c);class my{constructor(a){var b,c;mx(this,"client"),mx(this,"namespaces"),mx(this,"optionalNamespaces"),mx(this,"sessionProperties"),mx(this,"scopedProperties"),mx(this,"events",new o),mx(this,"rpcProviders",{}),mx(this,"session"),mx(this,"providerOpts"),mx(this,"logger"),mx(this,"uri"),mx(this,"disableProviderPing",!1),mx(this,"connectParams"),this.providerOpts=a,this.logger=hy({logger:null!=(b=a.logger)?b:lm,name:null!=(c=this.providerOpts.name)?c:ln}),this.disableProviderPing=a?.disableProviderPing||!1}static async init(a){let b=new my(a);return await b.initialize(),b}async request(a,b,c){let[d,e]=this.validateChain(b);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(d).request({request:mw({},a),chainId:`${d}:${e}`,topic:this.session.topic,expiry:c})}sendAsync(a,b,c,d){let e=new Date().getTime();this.request(a,c,d).then(a=>b(null,(0,hW.formatJsonRpcResult)(e,a))).catch(a=>b(a,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var a;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(a=this.session)?void 0:a.topic,reason:he("USER_DISCONNECTED")}),await this.cleanup()}async connect(a){if(!this.client)throw Error("Sign Client not initialized");if(this.connectParams=a,this.setNamespaces(a),this.cleanupPendingPairings(),!a.skipPairing)return await this.pair(a.pairingTopic)}async authenticate(a,b){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(a),await this.cleanupPendingPairings();let{uri:c,response:d}=await this.client.authenticate(a,b);c&&(this.uri=c,this.events.emit("display_uri",c));let e=await d();if(this.session=e.session,this.session){let a=lJ(this.session.namespaces);this.namespaces=lG(this.namespaces,a),await this.persist("namespaces",this.namespaces),this.onConnect()}return e}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}removeListener(a,b){this.events.removeListener(a,b)}off(a,b){this.events.off(a,b)}get isWalletConnect(){return!0}async pair(a){var b,c;let{uri:d,approval:e}=await this.client.connect({pairingTopic:a,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:null==(b=this.connectParams)?void 0:b.authentication,walletPay:null==(c=this.connectParams)?void 0:c.walletPay});d&&(this.uri=d,this.events.emit("display_uri",d));let f=await e();this.session=f;let g=lJ(f.namespaces);return this.namespaces=lG(this.namespaces,g),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(a,b){try{if(!this.session)return;let[c,d]=this.validateChain(a);this.getProvider(c).setDefaultChain(d,b)}catch(a){if(!/Please call connect/.test(a.message))throw a}}async cleanupPendingPairings(a={}){try{this.logger.info("Cleaning up inactive pairings...");let b=this.client.pairing.getAll();if(!hf(b))return;for(let c of b)a.deletePairings?this.client.core.expirer.set(c.topic,0):await this.client.core.relayer.subscriber.unsubscribe(c.topic);this.logger.info(`Inactive pairings cleared: ${b.length}`)}catch(a){this.logger.warn(a,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var a,b;if(this.client=this.providerOpts.client||await k6.init({core:this.providerOpts.core,logger:this.providerOpts.logger||lm,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(c){throw this.logger.error(c,"Failed to get session"),Error(`The provided session: ${null==(b=null==(a=this.providerOpts)?void 0:a.session)?void 0:b.topic} doesn't exist in the Sign client`)}else{let a=this.client.session.getAll();this.session=a[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let a=[...new Set(Object.keys(this.session.namespaces).map(a=>g8(a)))];lN("client",this.client),lN("events",this.events),lN("disableProviderPing",this.disableProviderPing),a.forEach(a=>{if(!this.session)return;let b=function(a,b){let c=Object.keys(b.namespaces).filter(b=>b.includes(a));if(!c.length)return[];let d=[];return c.forEach(a=>{let c=b.namespaces[a].accounts;d.push(...c)}),d}(a,this.session);if(b?.length===0)return;let c=lE(b),d=mq(mw({},lG(this.namespaces,this.optionalNamespaces)[a]),mr({accounts:b,chains:c}));"eip155"===a?this.rpcProviders[a]=new ml({namespace:d}):this.rpcProviders[a]=new mo({namespace:d})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",a=>{var b;let{topic:c}=a;c===(null==(b=this.session)?void 0:b.topic)&&this.events.emit("session_ping",a)}),this.client.on("session_event",a=>{var b;let{params:c,topic:d}=a;if(d!==(null==(b=this.session)?void 0:b.topic))return;let{event:e}=c;if("accountsChanged"===e.name){let a=e.data;a&&hf(a)&&this.events.emit("accountsChanged",a.map(lI))}else if("chainChanged"===e.name){let a=c.chainId,b=c.event.data,d=g8(a),e=lK(a)!==lK(b)?`${d}:${lK(b)}`:a;this.onChainChanged({currentCaipChainId:e})}else this.events.emit(e.name,e.data);this.events.emit("session_event",a)}),this.client.on("session_update",({topic:a,params:b})=>{var c,d;if(a!==(null==(c=this.session)?void 0:c.topic))return;let{namespaces:e}=b,f=null==(d=this.client)?void 0:d.session.get(a);this.session=mq(mw({},f),mr({namespaces:e})),this.onSessionUpdate(),this.events.emit("session_update",{topic:a,params:b})}),this.client.on("session_delete",async a=>{var b;a.topic===(null==(b=this.session)?void 0:b.topic)&&(await this.cleanup(),this.events.emit("session_delete",a),this.events.emit("disconnect",mq(mw({},he("USER_DISCONNECTED")),mr({data:a.topic}))))}),this.on(lt,a=>{this.onChainChanged(mq(mw({},a),mr({internal:!0})))})}getProvider(a){return this.rpcProviders[a]||this.rpcProviders[lq]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(a=>{var b;this.getProvider(a).updateNamespace(null==(b=this.session)?void 0:b.namespaces[a])})}setNamespaces(a){let{namespaces:b={},optionalNamespaces:c={},sessionProperties:d,scopedProperties:e}=a;this.optionalNamespaces=lG(b,c),this.sessionProperties=d,this.scopedProperties=e}validateChain(a){let[b,c]=a?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[b,c];if(b&&!Object.keys(this.namespaces||{}).map(a=>g8(a)).includes(b))throw Error(`Namespace '${b}' is not configured. Please call connect() first with namespace config.`);if(b&&c)return[b,c];let d=g8(Object.keys(this.namespaces)[0]),e=this.rpcProviders[d].getDefaultChain();return[d,e]}async requestAccounts(){let[a]=this.validateChain();return await this.getProvider(a).requestAccounts()}async onChainChanged({currentCaipChainId:a,previousCaipChainId:b,internal:c=!1}){if(!this.namespaces)return;let[d,e]=this.validateChain(a);e&&(this.updateNamespaceChain(d,e),c?(this.events.emit("chainChanged",e),this.emitAccountsChangedOnChainChange({namespace:d,currentCaipChainId:a,previousCaipChainId:b})):this.getProvider(d).setDefaultChain(e),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:a,currentCaipChainId:b,previousCaipChainId:c}){var d,e;try{if(c===b)return;let f=null==(e=null==(d=this.session)?void 0:d.namespaces[a])?void 0:e.accounts;if(!f)return;let g=f.filter(a=>a.includes(`${b}:`)).map(lI);if(!hf(g))return;this.events.emit("accountsChanged",g)}catch(a){this.logger.warn(a,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(a,b){if(!this.namespaces)return;let c=this.namespaces[a]?a:`${a}:${b}`;this.namespaces[c]?this.namespaces[c]&&(this.namespaces[c].defaultChain=b):this.namespaces[c]={chains:[],methods:[],events:[],defaultChain:b}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(a,b){var c;let d=(null==(c=this.session)?void 0:c.topic)||"";await this.client.core.storage.setItem(`${lo}/${a}${d}`,b)}async getFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";return await this.client.core.storage.getItem(`${lo}/${a}${c}`)}async deleteFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";await this.client.core.storage.removeItem(`${lo}/${a}${c}`)}async cleanupStorage(){var a;try{if((null==(a=this.client)?void 0:a.session.length)>0)return;for(let a of(await this.client.core.storage.getKeys()))a.startsWith(lo)&&await this.client.core.storage.removeItem(a)}catch(a){this.logger.warn(a,"Failed to cleanup storage")}}}let mz=["eth_sendTransaction","personal_sign"],mA=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],mB=["chainChanged","accountsChanged"],mC=["chainChanged","accountsChanged","message","disconnect","connect"],mD=async()=>{let{createAppKit:a}=await c.e(9697).then(c.bind(c,79697));return a};var mE=Object.defineProperty,mF=Object.defineProperties,mG=Object.getOwnPropertyDescriptors,mH=Object.getOwnPropertySymbols,mI=Object.prototype.hasOwnProperty,mJ=Object.prototype.propertyIsEnumerable,mK=(a,b,c)=>b in a?mE(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mL=(a,b)=>{for(var c in b||(b={}))mI.call(b,c)&&mK(a,c,b[c]);if(mH)for(var c of mH(b))mJ.call(b,c)&&mK(a,c,b[c]);return a},mM=(a,b,c)=>mK(a,"symbol"!=typeof b?b+"":b,c);function mN(a){return Number(a[0].split(":")[1])}function mO(a){return`0x${a.toString(16)}`}class mP{constructor(){mM(this,"events",new o.EventEmitter),mM(this,"namespace","eip155"),mM(this,"accounts",[]),mM(this,"signer"),mM(this,"chainId",1),mM(this,"modal"),mM(this,"rpc"),mM(this,"STORAGE_KEY","wc@2:ethereum_provider:"),mM(this,"on",(a,b)=>(this.events.on(a,b),this)),mM(this,"once",(a,b)=>(this.events.once(a,b),this)),mM(this,"removeListener",(a,b)=>(this.events.removeListener(a,b),this)),mM(this,"off",(a,b)=>(this.events.off(a,b),this)),mM(this,"parseAccount",a=>this.isCompatibleChainId(a)?this.parseAccountId(a).address:a),this.signer={},this.rpc={}}static async init(a){let b=new mP;return await b.initialize(a),b}async request(a,b){return await this.signer.request(a,this.formatChainId(this.chainId),b)}sendAsync(a,b,c){this.signer.sendAsync(a,b,this.formatChainId(this.chainId),c)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(a){var b;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts(a);let{required:c,optional:d}=function(a){let{chains:b,optionalChains:c,methods:d,optionalMethods:e,events:f,optionalEvents:g,rpcMap:h}=a;if(!hf(b))throw Error("Invalid chains");let i={chains:b,methods:d||mz,events:f||mB,rpcMap:mL({},b.length?{[mN(b)]:h[mN(b)]}:{})},j=f?.filter(a=>!mB.includes(a)),k=d?.filter(a=>!mz.includes(a));if(!c&&!g&&!e&&!(null!=j&&j.length)&&!(null!=k&&k.length))return{required:b.length?i:void 0};let l={chains:[...new Set(j?.length&&k?.length||!c?i.chains.concat(c||[]):c)],methods:[...new Set(i.methods.concat(null!=e&&e.length?e:mA))],events:[...new Set(i.events.concat(null!=g&&g.length?g:mC))],rpcMap:h};return{required:b.length?i:void 0,optional:c.length?l:void 0}}(this.rpc);try{let b=await new Promise(async(b,e)=>{var f,g;let h,i;this.rpc.showQrModal&&(null==(f=this.modal)||f.open(),null==(g=this.modal)||g.subscribeState(a=>{a.open||this.signer.session||(this.signer.abortPairingAttempt(),e(Error("Connection request reset. Please try again.")))}));let j=null!=a&&a.scopedProperties?{[this.namespace]:a.scopedProperties}:void 0;await this.signer.connect((h=mL({namespaces:mL({},c&&{[this.namespace]:c})},d&&{optionalNamespaces:{[this.namespace]:d}}),i={pairingTopic:a?.pairingTopic,scopedProperties:j},mF(h,mG(i)))).then(a=>{b(a)}).catch(a=>{var b;null==(b=this.modal)||b.showErrorMessage("Unable to connect"),e(Error(a.message))})});if(!b)return;let e=cf(b.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:e),this.setAccounts(e),this.events.emit("connect",{chainId:mO(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{null==(b=this.modal)||b.close()}}async authenticate(a,b){var c;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:a?.chains});try{let c=await new Promise(async(c,d)=>{var e,f;let g,h;this.rpc.showQrModal&&(null==(e=this.modal)||e.open(),null==(f=this.modal)||f.subscribeState(a=>{a.open||this.signer.session||(this.signer.abortPairingAttempt(),d(Error("Connection request reset. Please try again.")))})),await this.signer.authenticate((g=mL({},a),h={chains:this.rpc.chains},mF(g,mG(h))),b).then(a=>{c(a)}).catch(a=>{var b;null==(b=this.modal)||b.showErrorMessage("Unable to connect"),d(Error(a.message))})}),d=c.session;if(d){let a=cf(d.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:a),this.setAccounts(a),this.events.emit("connect",{chainId:mO(this.chainId)})}return c}catch(a){throw this.signer.logger.error(a),a}finally{null==(c=this.modal)||c.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",a=>{let{params:b}=a,{event:c}=b;"accountsChanged"===c.name?(this.accounts=this.parseAccounts(c.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===c.name?this.setChainId(this.formatChainId(c.data)):this.events.emit(c.name,c.data),this.events.emit("session_event",a)}),this.signer.on("accountsChanged",a=>{this.accounts=this.parseAccounts(a),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",a=>{let b=parseInt(a);this.chainId=b,this.events.emit("chainChanged",mO(this.chainId)),this.persist()}),this.signer.on("session_update",a=>{this.events.emit("session_update",a)}),this.signer.on("session_delete",a=>{this.reset(),this.events.emit("session_delete",a),this.events.emit("disconnect",mF(mL({},he("USER_DISCONNECTED")),mG({data:a.topic,name:"USER_DISCONNECTED"})))}),this.signer.on("display_uri",a=>{this.events.emit("display_uri",a)})}switchEthereumChain(a){this.request({method:"wallet_switchEthereumChain",params:[{chainId:a.toString(16)}]})}isCompatibleChainId(a){return"string"==typeof a&&a.startsWith(`${this.namespace}:`)}formatChainId(a){return`${this.namespace}:${a}`}parseChainId(a){return Number(a.split(":")[1])}setChainIds(a){let b=a.filter(a=>this.isCompatibleChainId(a)).map(a=>this.parseChainId(a));b.length&&(this.chainId=b[0],this.events.emit("chainChanged",mO(this.chainId)),this.persist())}setChainId(a){if(this.isCompatibleChainId(a)){let b=this.parseChainId(a);this.chainId=b,this.switchEthereumChain(b)}}parseAccountId(a){let[b,c,d]=a.split(":");return{chainId:`${b}:${c}`,address:d}}setAccounts(a){this.accounts=a.filter(a=>this.parseChainId(this.parseAccountId(a).chainId)===this.chainId).map(a=>this.parseAccountId(a).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(a){var b,c;let d=null!=(b=a?.chains)?b:[],e=null!=(c=a?.optionalChains)?c:[],f=d.concat(e);if(!f.length)throw Error("No chains specified in either `chains` or `optionalChains`");let g=d.length?a?.methods||mz:[],h=d.length?a?.events||mB:[],i=a?.optionalMethods||[],j=a?.optionalEvents||[],k=a?.rpcMap||this.buildRpcMap(f,a.projectId),l=a?.qrModalOptions||void 0;return{chains:d?.map(a=>this.formatChainId(a)),optionalChains:e.map(a=>this.formatChainId(a)),methods:g,events:h,optionalMethods:i,optionalEvents:j,rpcMap:k,showQrModal:!!(null!=a&&a.showQrModal),qrModalOptions:l,projectId:a.projectId,metadata:a.metadata}}buildRpcMap(a,b){let c={};return a.forEach(a=>{c[a]=this.getRpcUrl(a,b)}),c}async initialize(a){var b;if(this.rpc=this.getRpcConfig(a),this.chainId=this.rpc.chains.length?mN(this.rpc.chains):mN(this.rpc.optionalChains),this.signer=await my.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:a.disableProviderPing,relayUrl:a.relayUrl,storage:a.storage,storageOptions:a.storageOptions,customStoragePrefix:a.customStoragePrefix,telemetryEnabled:a.telemetryEnabled,logger:a.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let a;try{let c,d,e,f,g=await mD(),{convertWCMToAppKitOptions:h}=await Promise.resolve().then(function(){return m_}),i=h((c=mL({},this.rpc.qrModalOptions),d={chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId},mF(c,mG(d))));if(!i.networks.length)throw Error("No networks found for WalletConnect");a=g((e=mL({},i),f={universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:(null==(b=this.rpc.qrModalOptions)?void 0:b.enableMobileFullScreen)===!0},mF(e,mG(f))))}catch(a){throw console.warn(a),Error("To use QR modal, please install @reown/appkit package")}if(a)try{this.modal=a}catch(a){throw this.signer.logger.error(a),Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(a){if(!a)return;let{chains:b,optionalChains:c,rpcMap:d}=a;b&&hf(b)&&(this.rpc.chains=b.map(a=>this.formatChainId(a)),b.forEach(a=>{this.rpc.rpcMap[a]=d?.[a]||this.getRpcUrl(a)})),c&&hf(c)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=c?.map(a=>this.formatChainId(a)),c.forEach(a=>{this.rpc.rpcMap[a]=d?.[a]||this.getRpcUrl(a)}))}getRpcUrl(a,b){var c;return(null==(c=this.rpc.rpcMap)?void 0:c[a])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${a}&projectId=${b||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let a=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),b=this.session.namespaces[`${this.namespace}:${a}`]?this.session.namespaces[`${this.namespace}:${a}`]:this.session.namespaces[this.namespace];this.setChainIds(a?[this.formatChainId(a)]:b?.accounts),this.setAccounts(b?.accounts)}catch(a){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(a),await this.disconnect().catch(a=>this.signer.logger.warn(a))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(a){return"string"==typeof a||a instanceof String?[this.parseAccount(a)]:a.map(a=>this.parseAccount(a))}}let mQ=mP;var mR=Object.defineProperty,mS=Object.defineProperties,mT=Object.getOwnPropertyDescriptors,mU=Object.getOwnPropertySymbols,mV=Object.prototype.hasOwnProperty,mW=Object.prototype.propertyIsEnumerable,mX=(a,b,c)=>b in a?mR(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mY=(a,b)=>{for(var c in b||(b={}))mV.call(b,c)&&mX(a,c,b[c]);if(mU)for(var c of mU(b))mW.call(b,c)&&mX(a,c,b[c]);return a};let mZ=a=>{let[b,c]=a.split(":");return m$({id:c,caipNetworkId:a,chainNamespace:b,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function m$(a){return mY({formatters:void 0,fees:void 0,serializers:void 0},a)}var m_=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function(a){var b,c,d,e,f,g,h;let i=null==(b=a.chains)?void 0:b.map(mZ).filter(Boolean);if(0===i.length)throw Error("At least one chain must be specified");let j=i.find(b=>{var c;return b.id===(null==(c=a.defaultChain)?void 0:c.id)}),k={projectId:a.projectId,networks:i,themeMode:a.themeMode,themeVariables:function(a){if(a)return{"--w3m-font-family":a["--wcm-font-family"],"--w3m-accent":a["--wcm-accent-color"],"--w3m-color-mix":a["--wcm-background-color"],"--w3m-z-index":a["--wcm-z-index"]?Number(a["--wcm-z-index"]):void 0,"--w3m-qr-color":a["--wcm-accent-color"],"--w3m-font-size-master":a["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":a["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}(a.themeVariables),chainImages:a.chainImages,connectorImages:a.walletImages,defaultNetwork:j,metadata:mS(mY({},a.metadata),mT({name:(null==(c=a.metadata)?void 0:c.name)||"WalletConnect",description:(null==(d=a.metadata)?void 0:d.description)||"Connect to WalletConnect-compatible wallets",url:(null==(e=a.metadata)?void 0:e.url)||"https://walletconnect.org",icons:(null==(f=a.metadata)?void 0:f.icons)||["https://walletconnect.org/walletconnect-logo.png"]})),showWallets:!0,featuredWalletIds:"NONE"===a.explorerRecommendedWalletIds?[]:Array.isArray(a.explorerRecommendedWalletIds)?a.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===a.explorerExcludedWalletIds?[]:Array.isArray(a.explorerExcludedWalletIds)?a.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(g=a.mobileWallets)&&g.length||null!=(h=a.desktopWallets)&&h.length){let b=[...(a.mobileWallets||[]).map(a=>({id:a.id,name:a.name,links:a.links})),...(a.desktopWallets||[]).map(a=>({id:a.id,name:a.name,links:{native:a.links.native,universal:a.links.universal}}))],c=[...k.featuredWalletIds||[],...k.excludeWalletIds||[]],d=b.filter(a=>!c.includes(a.id));d.length&&(k.customWallets=d)}return k},defineChain:m$})},80257:(a,b,c)=>{"use strict";function d(a){return"object"==typeof a&&"id"in a&&"jsonrpc"in a&&"2.0"===a.jsonrpc}function e(a){return d(a)&&"method"in a}function f(a){return d(a)&&(g(a)||h(a))}function g(a){return"result"in a}function h(a){return"error"in a}c.d(b,{U$:()=>h,p3:()=>e,tq:()=>f,xT:()=>g})},80327:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});let d=c(4457);d.__exportStar(c(97195),b),d.__exportStar(c(61478),b)},80999:(a,b,c)=>{"use strict";c.d(b,{A:()=>z});let d=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,e=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,f=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function g(a,b){var c;return"__proto__"===a||"constructor"===a&&b&&"object"==typeof b&&"prototype"in b?void(c=a,console.warn(`[destr] Dropping "${c}" key to prevent prototype pollution.`)):b}function h(a,b={}){if("string"!=typeof a)return a;if('"'===a[0]&&'"'===a[a.length-1]&&-1===a.indexOf("\\"))return a.slice(1,-1);let c=a.trim();if(c.length<=9)switch(c.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return NaN;case"infinity":return 1/0;case"-infinity":return-1/0}if(!f.test(a)){if(b.strict)throw SyntaxError("[destr] Invalid JSON");return a}try{if(d.test(a)||e.test(a)){if(b.strict)throw Error("[destr] Possible prototype pollution");return JSON.parse(a,g)}return JSON.parse(a)}catch(c){if(b.strict)throw c;return a}}function i(a,...b){try{var c;return(c=a(...b))&&"function"==typeof c.then?c:Promise.resolve(c)}catch(a){return Promise.reject(a)}}function j(a){let b,c;if(b=typeof a,null===a||"object"!==b&&"function"!==b)return String(a);if(!(c=Object.getPrototypeOf(a))||c.isPrototypeOf(Object)||Array.isArray(a))return JSON.stringify(a);if("function"==typeof a.toJSON)return j(a.toJSON());throw Error("[unstorage] Cannot stringify value!")}let k="base64:";function l(a){return a&&a.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function m(a){return(a=l(a))?a+":":""}function n(a,b,c){return a.watch?a.watch((a,d)=>b(a,c+d)):()=>{}}async function o(a){"function"==typeof a.dispose&&await i(a.dispose)}var p=c(81801),q=c(13149);class r{constructor(){this.indexedDb=function(a={}){let b,c={mounts:{"":a.driver||(b=new Map,{name:"memory",getInstance:()=>b,hasItem:a=>b.has(a),getItem:a=>b.get(a)??null,getItemRaw:a=>b.get(a)??null,setItem(a,c){b.set(a,c)},setItemRaw(a,c){b.set(a,c)},removeItem(a){b.delete(a)},getKeys:()=>[...b.keys()],clear(){b.clear()},dispose(){b.clear()}})},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},d=a=>{for(let b of c.mountpoints)if(a.startsWith(b))return{base:b,relativeKey:a.slice(b.length),driver:c.mounts[b]};return{base:"",relativeKey:a,driver:c.mounts[""]}},e=(a,b)=>c.mountpoints.filter(c=>c.startsWith(a)||b&&a.startsWith(c)).map(b=>({relativeBase:a.length>b.length?a.slice(b.length):void 0,mountpoint:b,driver:c.mounts[b]})),f=(a,b)=>{if(c.watching)for(let d of(b=l(b),c.watchListeners))d(a,b)},g=async()=>{if(!c.watching)for(let a in c.watching=!0,c.mounts)c.unwatch[a]=await n(c.mounts[a],f,a)},p=async()=>{if(c.watching){for(let a in c.unwatch)await c.unwatch[a]();c.unwatch={},c.watching=!1}},q=(a,b,c)=>{let e=new Map,f=a=>{let b=e.get(a.base);return b||(b={driver:a.driver,base:a.base,items:[]},e.set(a.base,b)),b};for(let c of a){let a="string"==typeof c,e=l(a?c:c.key),g=a?void 0:c.value,h=a||!c.options?b:{...b,...c.options},i=d(e);f(i).items.push({key:e,value:g,relativeKey:i.relativeKey,options:h})}return Promise.all([...e.values()].map(a=>c(a))).then(a=>a.flat())},r={hasItem(a,b={}){let{relativeKey:c,driver:e}=d(a=l(a));return i(e.hasItem,c,b)},getItem(a,b={}){let{relativeKey:c,driver:e}=d(a=l(a));return i(e.getItem,c,b).then(a=>h(a))},getItems:(a,b={})=>q(a,b,a=>a.driver.getItems?i(a.driver.getItems,a.items.map(a=>({key:a.relativeKey,options:a.options})),b).then(b=>b.map(b=>({key:function(...a){return l(a.join(":"))}(a.base,b.key),value:h(b.value)}))):Promise.all(a.items.map(b=>i(a.driver.getItem,b.relativeKey,b.options).then(a=>({key:b.key,value:h(a)}))))),getItemRaw(a,b={}){let{relativeKey:c,driver:e}=d(a=l(a));return e.getItemRaw?i(e.getItemRaw,c,b):i(e.getItem,c,b).then(a=>{var b;return"string"==typeof a&&a.startsWith(k)?(b=a.slice(k.length),globalThis.Buffer?Buffer.from(b,"base64"):Uint8Array.from(globalThis.atob(b),a=>a.codePointAt(0))):a})},async setItem(a,b,c={}){if(void 0===b)return r.removeItem(a);let{relativeKey:e,driver:g}=d(a=l(a));g.setItem&&(await i(g.setItem,e,j(b),c),g.watch||f("update",a))},async setItems(a,b){await q(a,b,async a=>{if(a.driver.setItems)return i(a.driver.setItems,a.items.map(a=>({key:a.relativeKey,value:j(a.value),options:a.options})),b);a.driver.setItem&&await Promise.all(a.items.map(b=>i(a.driver.setItem,b.relativeKey,j(b.value),b.options)))})},async setItemRaw(a,b,c={}){if(void 0===b)return r.removeItem(a,c);let{relativeKey:e,driver:g}=d(a=l(a));if(g.setItemRaw)await i(g.setItemRaw,e,b,c);else{var h;if(!g.setItem)return;await i(g.setItem,e,"string"==typeof b?b:k+(h=b,globalThis.Buffer?Buffer.from(h).toString("base64"):globalThis.btoa(String.fromCodePoint(...h))),c)}g.watch||f("update",a)},async removeItem(a,b={}){"boolean"==typeof b&&(b={removeMeta:b});let{relativeKey:c,driver:e}=d(a=l(a));e.removeItem&&(await i(e.removeItem,c,b),(b.removeMeta||b.removeMata)&&await i(e.removeItem,c+"$",b),e.watch||f("remove",a))},async getMeta(a,b={}){"boolean"==typeof b&&(b={nativeOnly:b});let{relativeKey:c,driver:e}=d(a=l(a)),f=Object.create(null);if(e.getMeta&&Object.assign(f,await i(e.getMeta,c,b)),!b.nativeOnly){let a=await i(e.getItem,c+"$",b).then(a=>h(a));a&&"object"==typeof a&&("string"==typeof a.atime&&(a.atime=new Date(a.atime)),"string"==typeof a.mtime&&(a.mtime=new Date(a.mtime)),Object.assign(f,a))}return f},setMeta(a,b,c={}){return this.setItem(a+"$",b,c)},removeMeta(a,b={}){return this.removeItem(a+"$",b)},async getKeys(a,b={}){let c=e(a=m(a),!0),d=[],f=[],g=!0;for(let a of c){for(let c of(a.driver.flags?.maxDepth||(g=!1),await i(a.driver.getKeys,a.relativeBase,b))){let b=a.mountpoint+l(c);d.some(a=>b.startsWith(a))||f.push(b)}d=[a.mountpoint,...d.filter(b=>!b.startsWith(a.mountpoint))]}let h=void 0!==b.maxDepth&&!g;return f.filter(c=>{var d;return(!h||function(a,b){if(void 0===b)return!0;let c=0,d=a.indexOf(":");for(;d>-1;)c++,d=a.indexOf(":",d+1);return c<=b}(c,b.maxDepth))&&((d=a)?c.startsWith(d)&&"$"!==c[c.length-1]:"$"!==c[c.length-1])})},async clear(a,b={}){a=m(a),await Promise.all(e(a,!1).map(async a=>a.driver.clear?i(a.driver.clear,a.relativeBase,b):a.driver.removeItem?Promise.all((await a.driver.getKeys(a.relativeBase||"",b)).map(c=>a.driver.removeItem(c,b))):void 0))},async dispose(){await Promise.all(Object.values(c.mounts).map(a=>o(a)))},watch:async a=>(await g(),c.watchListeners.push(a),async()=>{c.watchListeners=c.watchListeners.filter(b=>b!==a),0===c.watchListeners.length&&await p()}),async unwatch(){c.watchListeners=[],await p()},mount(a,b){if((a=m(a))&&c.mounts[a])throw Error(`already mounted at ${a}`);return a&&(c.mountpoints.push(a),c.mountpoints.sort((a,b)=>b.length-a.length)),c.mounts[a]=b,c.watching&&Promise.resolve(n(b,f,a)).then(b=>{c.unwatch[a]=b}).catch(console.error),r},async unmount(a,b=!0){(a=m(a))&&c.mounts[a]&&(c.watching&&a in c.unwatch&&(c.unwatch[a]?.(),delete c.unwatch[a]),b&&await o(c.mounts[a]),c.mountpoints=c.mountpoints.filter(b=>b!==a),delete c.mounts[a])},getMount(a=""){let b=d(a=l(a)+":");return{driver:b.driver,base:b.base}},getMounts:(a="",b={})=>e(a=l(a),b.parents).map(a=>({driver:a.driver,base:a.mountpoint})),keys:(a,b={})=>r.getKeys(a,b),get:(a,b={})=>r.getItem(a,b),set:(a,b,c={})=>r.setItem(a,b,c),has:(a,b={})=>r.hasItem(a,b),del:(a,b={})=>r.removeItem(a,b),remove:(a,b={})=>r.removeItem(a,b)};return r}({driver:((a={})=>{let b,c=a.base&&a.base.length>0?`${a.base}:`:"";return a.dbName&&a.storeName&&(b=(0,p.y$)(a.dbName,a.storeName)),{name:"idb-keyval",options:a,hasItem:async a=>!(typeof await (0,p.Jt)(c+a,b)>"u"),getItem:async a=>await (0,p.Jt)(c+a,b)??null,setItem:(a,d)=>(0,p.hZ)(c+a,d,b),removeItem:a=>(0,p.yH)(c+a,b),getKeys:()=>(0,p.HP)(b),clear:()=>(0,p.IU)(b)}})({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(a=>[a.key,a.value])}async getItem(a){let b=await this.indexedDb.getItem(a);if(null!==b)return b}async setItem(a,b){await this.indexedDb.setItem(a,(0,q.h)(b))}async removeItem(a){await this.indexedDb.removeItem(a)}}var s="u">typeof globalThis?globalThis:"u">typeof window?window:"u">typeof global?global:"u">typeof self?self:{},t={exports:{}};function u(a){var b;return[a[0],(0,q.j)(null!=(b=a[1])?b:"")]}function v(){}v.prototype.getItem=function(a){return this.hasOwnProperty(a)?String(this[a]):null},v.prototype.setItem=function(a,b){this[a]=String(b)},v.prototype.removeItem=function(a){delete this[a]},v.prototype.clear=function(){let a=this;Object.keys(a).forEach(function(b){a[b]=void 0,delete a[b]})},v.prototype.key=function(a){return a=a||0,Object.keys(this)[a]},v.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),"u">typeof s&&s.localStorage?t.exports=s.localStorage:"u">typeof window&&window.localStorage?t.exports=window.localStorage:t.exports=new v;class w{constructor(){this.localStorage=t.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(u)}async getItem(a){let b=this.localStorage.getItem(a);if(null!==b)return(0,q.j)(b)}async setItem(a,b){this.localStorage.setItem(a,(0,q.h)(b))}async removeItem(a){this.localStorage.removeItem(a)}}let x=async(a,b,c)=>{let d="wc_storage_version",e=await b.getItem(d);if(e&&e>=1)return void c(b);let f=await a.getKeys();if(!f.length)return void c(b);let g=[];for(;f.length;){let c=f.shift();if(!c)continue;let d=c.toLowerCase();if(d.includes("wc@")||d.includes("walletconnect")||d.includes("wc_")||d.includes("wallet_connect")){let d=await a.getItem(c);await b.setItem(c,d),g.push(c)}}await b.setItem(d,1),c(b),y(a,g)},y=async(a,b)=>{b.length&&b.forEach(async b=>{await a.removeItem(b)})};class z{constructor(){this.initialized=!1,this.setInitialized=a=>{this.storage=a,this.initialized=!0};const a=new w;this.storage=a;try{const b=new r;x(a,b,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(a){return await this.initialize(),this.storage.getItem(a)}async setItem(a,b){return await this.initialize(),this.storage.setItem(a,b)}async removeItem(a){return await this.initialize(),this.storage.removeItem(a)}async initialize(){this.initialized||await new Promise(a=>{let b=setInterval(()=>{this.initialized&&(clearInterval(b),a())},20)})}}},81801:(a,b,c)=>{"use strict";let d;function e(a){return new Promise((b,c)=>{a.oncomplete=a.onsuccess=()=>b(a.result),a.onabort=a.onerror=()=>c(a.error)})}function f(a,b){let c=indexedDB.open(a);c.onupgradeneeded=()=>c.result.createObjectStore(b);let d=e(c);return(a,c)=>d.then(d=>c(d.transaction(b,a).objectStore(b)))}function g(){return d||(d=f("keyval-store","keyval")),d}function h(a,b=g()){return b("readonly",b=>e(b.get(a)))}function i(a,b,c=g()){return c("readwrite",c=>(c.put(b,a),e(c.transaction)))}function j(a,b=g()){return b("readwrite",b=>(b.delete(a),e(b.transaction)))}function k(a=g()){return a("readwrite",a=>(a.clear(),e(a.transaction)))}function l(a=g()){return a("readonly",a=>{var b;if(a.getAllKeys)return e(a.getAllKeys());let c=[];return(b=a=>c.push(a.key),a.openCursor().onsuccess=function(){this.result&&(b(this.result),this.result.continue())},e(a.transaction)).then(()=>c)})}c.d(b,{HP:()=>l,IU:()=>k,Jt:()=>h,hZ:()=>i,y$:()=>f,yH:()=>j})},82015:(a,b,c)=>{"use strict";let d,e;c.d(b,{Cq:()=>by,FA:()=>bA,TZ:()=>bz,UF:()=>bx});var f,g=c(34613),h=c(13149);function i(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function j(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}let k="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,l=a=>new DataView(a.buffer,a.byteOffset,a.byteLength);function m(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("utf8ToBytes expected string, got "+typeof a);return new Uint8Array(new TextEncoder().encode(a))}(a)),i(a),a}class n{clone(){return this._cloneInto()}}function o(a=32){if(k&&"function"==typeof k.getRandomValues)return k.getRandomValues(new Uint8Array(a));if(k&&"function"==typeof k.randomBytes)return k.randomBytes(a);throw Error("crypto.getRandomValues must be defined")}class p extends n{constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=l(this.buffer)}update(a){j(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=m(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=l(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){j(this),function(a,b){i(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=l(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let k=h/4,m=this.get();if(k>m.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<k;a++)g.setUint32(4*a,m[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let q=BigInt(0x100000000-1),r=BigInt(32),s=(a,b,c)=>a>>>c,t=(a,b,c)=>a<<32-c|b>>>c,u=(a,b,c)=>a>>>c|b<<32-c,v=(a,b,c)=>a<<32-c|b>>>c,w=(a,b,c)=>a<<64-c|b>>>c-32,x=(a,b,c)=>a>>>c-32|b<<64-c,y=function(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}},z=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),A=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,B=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),C=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,D=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,E=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),[F,G]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&q),l:Number(a>>r&q)}:{h:0|Number(a>>r&q),l:0|Number(a&q)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),H=new Uint32Array(80),I=new Uint32Array(80);class J extends p{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)H[c]=a.getUint32(b),I[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|H[a-15],c=0|I[a-15],d=u(b,c,1)^u(b,c,8)^s(b,c,7),e=v(b,c,1)^v(b,c,8)^t(b,c,7),f=0|H[a-2],g=0|I[a-2],h=u(f,g,19)^w(f,g,61)^s(f,g,6),i=B(e,v(f,g,19)^x(f,g,61)^t(f,g,6),I[a-7],I[a-16]),j=C(i,d,h,H[a-7],H[a-16]);H[a]=0|j,I[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=u(k,l,14)^u(k,l,18)^w(k,l,41),s=v(k,l,14)^v(k,l,18)^x(k,l,41),t=k&m^~k&o,B=E(r,s,l&n^~l&p,G[a],I[a]),C=D(B,q,b,t,F[a],H[a]),J=0|B,K=u(c,d,28)^w(c,d,34)^w(c,d,39),L=v(c,d,28)^x(c,d,34)^x(c,d,39),M=c&e^c&g^e&g,N=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=y(0|i,0|j,0|C,0|J)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let O=z(J,L,N);c=A(O,C,K,M),d=0|O}({h:c,l:d}=y(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=y(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=y(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=y(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=y(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=y(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=y(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=y(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){H.fill(0),I.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let K=(f=()=>new J,(d=a=>f().update(m(a)).digest()).outputLen=(e=f()).outputLen,d.blockLen=e.blockLen,d.create=()=>f(),d),L=BigInt(0),M=BigInt(1),N=BigInt(2);function O(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function P(a){if(!O(a))throw Error("Uint8Array expected")}function Q(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}let R=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function S(a){P(a);let b="";for(let c=0;c<a.length;c++)b+=R[a[c]];return b}function T(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?L:BigInt("0x"+a)}function U(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function V(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=U(a.charCodeAt(e)),f=U(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function W(a){return P(a),T(S(Uint8Array.from(a).reverse()))}function X(a,b){return V(a.toString(16).padStart(2*b,"0"))}function Y(a,b){return X(a,b).reverse()}function Z(a,b,c){let d;if("string"==typeof b)try{d=V(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(O(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function $(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];P(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let _=a=>"bigint"==typeof a&&L<=a;function aa(a,b,c,d){if(!(_(b)&&_(c)&&_(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let ab={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||O(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function ac(a,b,c={}){let d=(b,c,d)=>{let e=ab[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if(!(d&&void 0===f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function ad(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let ae=BigInt(0),af=BigInt(1),ag=BigInt(2),ah=BigInt(3),ai=BigInt(4),aj=BigInt(5),ak=BigInt(8);function al(a,b){let c=a%b;return c>=ae?c:b+c}function am(a,b,c){let d=a;for(;b-- >ae;)d*=d,d%=c;return d}function an(a,b){if(a===ae)throw Error("invert: expected non-zero number");if(b<=ae)throw Error("invert: expected positive modulus, got "+b);let c=al(a,b),d=b,e=ae,f=af;for(;c!==ae;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==af)throw Error("invert: does not exist");return al(e,b)}let ao=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ap(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function aq(a,b,c=!1,d={}){let e;if(a<=ae)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=ap(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:(N<<BigInt(f-1))-M,ZERO:ae,ONE:af,create:b=>al(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return ae<=b&&b<a},is0:a=>a===ae,isOdd:a=>(a&af)===af,neg:b=>al(-b,a),eql:(a,b)=>a===b,sqr:b=>al(b*b,a),add:(b,c)=>al(b+c,a),sub:(b,c)=>al(b-c,a),mul:(b,c)=>al(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<ae)throw Error("invalid exponent, negatives unsupported");if(c===ae)return a.ONE;if(c===af)return b;let d=a.ONE,e=b;for(;c>ae;)c&af&&(d=a.mul(d,e)),e=a.sqr(e),c>>=af;return d})(h,a,b),div:(b,c)=>al(b*an(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>an(b,a),sqrt:d.sqrt||(b=>(e||(e=function(a){if(a%ai===ah){let b=(a+af)/ai;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%ak===aj){let b=(a-aj)/ak;return function(a,c){let d=a.mul(c,ag),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,ag),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-af)/ag;for(b=a-af,c=0;b%ag===ae;b/=ag,c++);for(d=ag;d<a&&function(a,b,c){if(b<ae)throw Error("invalid exponent, negatives unsupported");if(c<=ae)throw Error("invalid modulus");if(c===af)return ae;let d=af;for(;b>ae;)b&af&&(d=d*a%c),a=a*a%c,b>>=af;return d}(d,e,a)!==a-af;d++)if(d>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===c){let b=(a+af)/ai;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+af)/ag;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,af<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a)),e(h,b))),invertBatch:a=>{let b,c,d;return b=Array(a.length),c=a.reduce((a,c,d)=>h.is0(c)?a:(b[d]=a,h.mul(a,c)),h.ONE),d=h.inv(c),a.reduceRight((a,c,d)=>h.is0(c)?a:(b[d]=h.mul(a,b[d]),h.mul(a,c)),d),b},cmov:(a,b,c)=>c?b:a,toBytes:a=>c?Y(a,g):X(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?W(a):T(S(a))}});return Object.freeze(h)}let ar=BigInt(0),as=BigInt(1);function at(a,b){let c=b.negate();return a?c:b}function au(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function av(a,b){return au(a,b),{windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}}let aw=new WeakMap,ax=new WeakMap;function ay(a){return ax.get(a)||1}let az=BigInt(0),aA=BigInt(1),aB=BigInt(2),aC=BigInt(8),aD={zip215:!0};BigInt(0),BigInt(1);let aE=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),aF=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);let aG=BigInt(1),aH=BigInt(2);BigInt(3);let aI=BigInt(5),aJ=BigInt(8),aK=aq(aE,void 0,!0),aL=function(a){var b;let c,d=(ac(a.Fp,ao.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),ac(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),c=Object.freeze({...ap(a.n,a.nBitLength),...a,p:a.Fp.ORDER}),ac(a,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...c})),{Fp:e,n:f,prehash:g,hash:h,randomBytes:i,nByteLength:j,h:k}=d,l=aB<<BigInt(8*j)-aA,m=e.create,n=aq(d.n,d.nBitLength),o=d.uvRatio||((a,b)=>{try{return{isValid:!0,value:e.sqrt(a*e.inv(b))}}catch{return{isValid:!1,value:az}}}),p=d.adjustScalarBytes||(a=>a),q=d.domain||((a,b,c)=>{if(Q("phflag",c),b.length||c)throw Error("Contexts/pre-hash are not supported");return a});function r(a,b){aa("coordinate "+a,b,az,l)}function s(a){if(!(a instanceof v))throw Error("ExtendedPoint expected")}let t=ad((a,b)=>{let{ex:c,ey:d,ez:f}=a,g=a.is0();null==b&&(b=g?aC:e.inv(f));let h=m(c*b),i=m(d*b),j=m(f*b);if(g)return{x:az,y:aA};if(j!==aA)throw Error("invZ was invalid");return{x:h,y:i}}),u=ad(a=>{let{a:b,d:c}=d;if(a.is0())throw Error("bad point: ZERO");let{ex:e,ey:f,ez:g,et:h}=a,i=m(e*e),j=m(f*f),k=m(g*g),l=m(k*k),n=m(i*b);if(m(k*m(n+j))!==m(l+m(c*m(i*j))))throw Error("bad point: equation left != right (1)");if(m(e*f)!==m(g*h))throw Error("bad point: equation left != right (2)");return!0});class v{constructor(a,b,c,d){this.ex=a,this.ey=b,this.ez=c,this.et=d,r("x",a),r("y",b),r("z",c),r("t",d),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(a){if(a instanceof v)throw Error("extended point not allowed");let{x:b,y:c}=a||{};return r("x",b),r("y",c),new v(b,c,aA,m(b*c))}static normalizeZ(a){let b=e.invertBatch(a.map(a=>a.ez));return a.map((a,c)=>a.toAffine(b[c])).map(v.fromAffine)}static msm(a,b){return function(a,b,c,d){if(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})}(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b),c.length!==d.length)throw Error("arrays of points and scalars must have equal length");let e=a.ZERO,f=function(a){let b;for(b=0;a>L;a>>=M,b+=1);return b}(BigInt(c.length)),g=f>12?f-3:f>4?f-2:f?2:1,h=(1<<g)-1,i=Array(h+1).fill(e),j=Math.floor((b.BITS-1)/g)*g,k=e;for(let a=j;a>=0;a-=g){i.fill(e);for(let b=0;b<d.length;b++){let e=Number(d[b]>>BigInt(a)&BigInt(h));i[e]=i[e].add(c[b])}let b=e;for(let a=i.length-1,c=e;a>0;a--)c=c.add(i[a]),b=b.add(c);if(k=k.add(b),0!==a)for(let a=0;a<g;a++)k=k.double()}return k}(v,n,a,b)}_setWindowSize(a){y.setWindowSize(this,a)}assertValidity(){u(this)}equals(a){s(a);let{ex:b,ey:c,ez:d}=this,{ex:e,ey:f,ez:g}=a,h=m(b*g),i=m(e*d),j=m(c*g),k=m(f*d);return h===i&&j===k}is0(){return this.equals(v.ZERO)}negate(){return new v(m(-this.ex),this.ey,this.ez,m(-this.et))}double(){let{a:a}=d,{ex:b,ey:c,ez:e}=this,f=m(b*b),g=m(c*c),h=m(aB*m(e*e)),i=m(a*f),j=b+c,k=m(m(j*j)-f-g),l=i+g,n=l-h,o=i-g,p=m(k*n),q=m(l*o),r=m(k*o);return new v(p,q,m(n*l),r)}add(a){s(a);let{a:b,d:c}=d,{ex:e,ey:f,ez:g,et:h}=this,{ex:i,ey:j,ez:k,et:l}=a;if(b===BigInt(-1)){let a=m((f-e)*(j+i)),b=m((f+e)*(j-i)),c=m(b-a);if(c===az)return this.double();let d=m(g*aB*l),n=m(h*aB*k),o=n+d,p=b+a,q=n-d,r=m(o*c),s=m(p*q),t=m(o*q);return new v(r,s,m(c*p),t)}let n=m(e*i),o=m(f*j),p=m(h*c*l),q=m(g*k),r=m((e+f)*(i+j)-n-o),t=q-p,u=q+p,w=m(o-b*n),x=m(r*t),y=m(u*w),z=m(r*w);return new v(x,y,m(t*u),z)}subtract(a){return this.add(a.negate())}wNAF(a){return y.wNAFCached(this,a,v.normalizeZ)}multiply(a){aa("scalar",a,aA,f);let{p:b,f:c}=this.wNAF(a);return v.normalizeZ([b,c])[0]}multiplyUnsafe(a,b=v.ZERO){return aa("scalar",a,az,f),a===az?x:this.is0()||a===aA?this:y.wNAFCachedUnsafe(this,a,v.normalizeZ,b)}isSmallOrder(){return this.multiplyUnsafe(k).is0()}isTorsionFree(){return y.unsafeLadder(this,f).is0()}toAffine(a){return t(this,a)}clearCofactor(){let{h:a}=d;return a===aA?this:this.multiplyUnsafe(a)}static fromHex(a,b=!1){let{d:c,a:f}=d,g=e.BYTES;a=Z("pointHex",a,g),Q("zip215",b);let h=a.slice(),i=a[g-1];h[g-1]=-129&i;let j=W(h);aa("pointHex.y",j,az,b?l:e.ORDER);let k=m(j*j),{isValid:n,value:p}=o(m(k-aA),m(c*k-f));if(!n)throw Error("Point.fromHex: invalid y coordinate");let q=(p&aA)===aA,r=(128&i)!=0;if(!b&&p===az&&r)throw Error("Point.fromHex: x=0 and x_0=1");return r!==q&&(p=m(-p)),v.fromAffine({x:p,y:j})}static fromPrivateKey(a){return z(a).point}toRawBytes(){let{x:a,y:b}=this.toAffine(),c=Y(b,e.BYTES);return c[c.length-1]|=a&aA?128:0,c}toHex(){return S(this.toRawBytes())}}v.BASE=new v(d.Gx,d.Gy,aA,m(d.Gx*d.Gy)),v.ZERO=new v(az,aA,aA,az);let{BASE:w,ZERO:x}=v,y=(b=8*j,{constTimeNegate:at,hasPrecomputes:a=>1!==ay(a),unsafeLadder(a,b,c=v.ZERO){let d=a;for(;b>ar;)b&as&&(c=c.add(d)),d=d.double(),b>>=as;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=av(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let{windows:e,windowSize:f}=av(a,b),g=v.ZERO,h=v.BASE,i=BigInt(2**a-1),j=2**a,k=BigInt(a);for(let a=0;a<e;a++){let b=a*f,e=Number(d&i);d>>=k,e>f&&(e-=j,d+=as);let l=b+Math.abs(e)-1,m=a%2!=0,n=e<0;0===e?h=h.add(at(m,c[b])):g=g.add(at(n,c[l]))}return{p:g,f:h}},wNAFUnsafe(a,c,d,e=v.ZERO){let{windows:f,windowSize:g}=av(a,b),h=BigInt(2**a-1),i=2**a,j=BigInt(a);for(let a=0;a<f;a++){let b=a*g;if(d===ar)break;let f=Number(d&h);if(d>>=j,f>g&&(f-=i,d+=as),0===f)continue;let k=c[b+Math.abs(f)-1];f<0&&(k=k.negate()),e=e.add(k)}return e},getPrecomputes(a,b,c){let d=aw.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&aw.set(b,c(d))),d},wNAFCached(a,b,c){let d=ay(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=ay(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){au(c,b),ax.set(a,c),aw.delete(a)}});function z(a){let b=e.BYTES;a=Z("private key",a,b);let c=Z("hashed private key",h(a),2*b),d=p(c.slice(0,b)),g=c.slice(b,2*b),i=al(W(d),f),j=w.multiply(i),k=j.toRawBytes();return{head:d,prefix:g,scalar:i,point:j,pointBytes:k}}function A(a=new Uint8Array,...b){return al(W(h(q($(...b),Z("context",a),!!g))),f)}return w._setWindowSize(8),{CURVE:d,getPublicKey:function(a){return z(a).pointBytes},sign:function(a,b,c={}){a=Z("message",a),g&&(a=g(a));let{prefix:d,scalar:h,pointBytes:i}=z(b),j=A(c.context,d,a),k=w.multiply(j).toRawBytes(),l=al(j+A(c.context,k,i,a)*h,f);return aa("signature.s",l,az,f),Z("result",$(k,Y(l,e.BYTES)),2*e.BYTES)},verify:function(a,b,c,d=aD){let f,h,i,{context:j,zip215:k}=d,l=e.BYTES;a=Z("signature",a,2*l),b=Z("message",b),c=Z("publicKey",c,l),void 0!==k&&Q("zip215",k),g&&(b=g(b));let m=W(a.slice(l,2*l));try{f=v.fromHex(c,k),h=v.fromHex(a.slice(0,l),k),i=w.multiplyUnsafe(m)}catch{return!1}if(!k&&f.isSmallOrder())return!1;let n=A(j,h.toRawBytes(),f.toRawBytes(),b);return h.add(f.multiplyUnsafe(n)).subtract(i).clearCofactor().equals(v.ZERO)},ExtendedPoint:v,utils:{getExtendedPublicKey:z,randomPrivateKey:()=>i(e.BYTES),precompute:(a=8,b=v.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}}({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:aK,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:aJ,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:K,randomBytes:o,adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a},uvRatio:function(a,b){var c;let d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=al(b*b*b,aE),s=(c=a*al(r*r*b,aE),d=BigInt(10),e=BigInt(20),f=BigInt(40),g=BigInt(80),i=am(h=c*c%aE*c%aE,aH,aE)*h%aE,j=am(i,aG,aE)*c%aE,k=am(j,aI,aE)*j%aE,l=am(k,d,aE)*k%aE,m=am(l,e,aE)*l%aE,n=am(m,f,aE)*m%aE,o=am(n,g,aE)*n%aE,p=am(o,g,aE)*n%aE,q=am(p,d,aE)*k%aE,{pow_p_5_8:am(q,aH,aE)*c%aE,b2:h}).pow_p_5_8,t=al(a*r*s,aE),u=al(b*t*t,aE),v=t,w=al(t*aF,aE),x=u===a,y=u===al(-a,aE),z=u===al(-a*aF,aE);return x&&(t=v),(y||z)&&(t=w),(al(t,aE)&af)===af&&(t=al(-t,aE)),{isValid:x||y,value:t}}}),aM="base64url",aN="utf8",aO="utf8",aP="base58btc";function aQ(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function aR(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?aQ(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function aS(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=aR(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return aQ(c)}var aT=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let aU=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class aV{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class aW{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return aY(this,a)}}class aX{constructor(a){this.decoders=a}or(a){return aY(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let aY=(a,b)=>new aX({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class aZ{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new aV(a,b,c),this.decoder=new aW(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let a$=({name:a,prefix:b,encode:c,decode:d})=>new aZ(a,b,c,d),a_=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=aT(c,b);return a$({prefix:a,name:b,encode:d,decode:a=>aU(e(a))})},a0=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>a$({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var a1=Object.freeze({__proto__:null,identity:a$({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),a2=Object.freeze({__proto__:null,base2:a0({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),a3=Object.freeze({__proto__:null,base8:a0({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),a4=Object.freeze({__proto__:null,base10:a_({prefix:"9",name:"base10",alphabet:"0123456789"})}),a5=Object.freeze({__proto__:null,base16:a0({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:a0({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),a6=Object.freeze({__proto__:null,base32:a0({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:a0({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:a0({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:a0({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:a0({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:a0({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:a0({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:a0({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:a0({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),a7=Object.freeze({__proto__:null,base36:a_({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:a_({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),a8=Object.freeze({__proto__:null,base58btc:a_({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:a_({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),a9=Object.freeze({__proto__:null,base64:a0({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:a0({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:a0({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:a0({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let ba=Array.from("\uD83D\uDE80\uD83E\uDE90☄\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09☀\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02❤\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09☺\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E✌✨\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D❣\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33✋\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13⭐✅\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6✔\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90☹\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20☝\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B⚽\uD83E\uDD19☕\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81⚡\uD83C\uDF1E\uD83C\uDF88❌✊\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C✈\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74▶➡❓\uD83D\uDC8E\uD83D\uDCB8⬇\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A⚠\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37☎\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51❄\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),bb=ba.reduce((a,b,c)=>(a[c]=b,a),[]),bc=ba.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var bd=Object.freeze({__proto__:null,base256emoji:a$({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=bb[b],"")},decode:function(a){let b=[];for(let c of a){let a=bc[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function be(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,be.bytes=c-d+1,b}var bf=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let bg=(a,b,c=0)=>(be(a,b,c),b),bh=(a,b)=>{let c=b.byteLength,d=bf(a),e=d+bf(c),f=new Uint8Array(e+c);return bg(a,f,0),bg(c,f,d),f.set(b,e),new bi(a,c,b,f)};class bi{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let bj=({name:a,code:b,encode:c})=>new bk(a,b,c);class bk{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?bh(this.code,b):b.then(a=>bh(this.code,a))}throw Error("Unknown type, must be binary type")}}let bl=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var bm=Object.freeze({__proto__:null,sha256:bj({name:"sha2-256",code:18,encode:bl("SHA-256")}),sha512:bj({name:"sha2-512",code:19,encode:bl("SHA-512")})}),bn=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:aU,digest:a=>bh(0,aU(a))}});new TextEncoder,new TextDecoder;let bo={...a1,...a2,...a3,...a4,...a5,...a6,...a7,...a8,...a9,...bd};function bp(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...bm,...bn});let bq=bp("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),br=bp("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=aR((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),bs={utf8:bq,"utf-8":bq,hex:bo.base16,latin1:br,ascii:br,binary:br,...bo};function bt(a,b="utf8"){let c=bs[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}function bu(a,b="utf8"){let c=bs[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?aQ(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function bv(a){return(0,h.j)(bt(bu(a,aM),aN))}function bw(a){return bt(bu((0,h.h)(a),aN),aM)}function bx(a){return["did:key","z"+bt(aS([bu("K36",aP),a]),aP)].join(":")}function by(a){let b=a.split(".");return{header:bv(b[0]),payload:bv(b[1]),signature:bu(b[2],aM),data:bu(b.slice(0,2).join("."),aO)}}function bz(a=o(32)){let b=aL.getPublicKey(a);return{secretKey:aS([a,b]),publicKey:b}}async function bA(a,b,c,d,e=(0,g.fromMiliseconds)(Date.now())){let f={alg:"EdDSA",typ:"JWT"},h={iss:bx(d.publicKey),sub:a,aud:b,iat:e,exp:e+c},i=bu([bw((j={header:f,payload:h}).header),bw(j.payload)].join("."),aO);var j,k={header:f,payload:h,signature:aL.sign(i,d.secretKey.slice(0,32))};return[bw(k.header),bw(k.payload),bt(k.signature,aM)].join(".")}},84116:(a,b,c)=>{"use strict";b.g=void 0;let d=c(44161);b.g=function(){let a,b,c;try{a=d.getDocumentOrThrow(),b=d.getLocationOrThrow()}catch(a){return null}function e(...b){let c=a.getElementsByTagName("meta");for(let a=0;a<c.length;a++){let d=c[a],e=["itemprop","property","name"].map(a=>d.getAttribute(a)).filter(a=>!!a&&b.includes(a));if(e.length&&e){let a=d.getAttribute("content");if(a)return a}}return""}let f=((c=e("name","og:site_name","og:title","twitter:title"))||(c=a.title),c),g=e("description","og:description","twitter:description","keywords"),h=b.origin;return{description:g,url:h,icons:function(){let c=a.getElementsByTagName("link"),d=[];for(let a=0;a<c.length;a++){let e=c[a],f=e.getAttribute("rel");if(f&&f.toLowerCase().indexOf("icon")>-1){let a=e.getAttribute("href");if(a)if(-1===a.toLowerCase().indexOf("https:")&&-1===a.toLowerCase().indexOf("http:")&&0!==a.indexOf("//")){let c=b.protocol+"//"+b.host;if(0===a.indexOf("/"))c+=a;else{let d=b.pathname.split("/");d.pop(),c+=d.join("/")+"/"+a}d.push(c)}else if(0===a.indexOf("//")){let c=b.protocol+a;d.push(c)}else d.push(a)}}return d}(),name:f}}},85341:(a,b,c)=>{"use strict";c.d(b,{kF:()=>f});class d{}class e extends d{constructor(){super()}}class f extends e{constructor(a){super()}}},93120:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.fromMiliseconds=b.toMiliseconds=void 0;let d=c(80327);b.toMiliseconds=function(a){return a*d.ONE_THOUSAND},b.fromMiliseconds=function(a){return Math.floor(a/d.ONE_THOUSAND)}},93882:(a,b,c)=>{"use strict";c.d(b,{A:()=>r,V:()=>r});var d=c(94735),e=c(60460),f=c.n(e),g=c(13149),h=c(10272),i=Object.defineProperty,j=Object.defineProperties,k=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(a,b,c)=>b in a?i(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,p=(a,b)=>{for(var c in b||(b={}))m.call(b,c)&&o(a,c,b[c]);if(l)for(var c of l(b))n.call(b,c)&&o(a,c,b[c]);return a};let q={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};class r{constructor(a,b=!1){if(this.url=a,this.disableProviderPing=b,this.events=new d.EventEmitter,this.isAvailable=!1,this.registering=!1,!(0,h.isHttpUrl)(a))throw Error(`Provided URL is not compatible with HTTP connection: ${a}`);this.url=a,this.disableProviderPing=b}get connected(){return this.isAvailable}get connecting(){return this.registering}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async open(a=this.url){await this.register(a)}async close(){if(!this.isAvailable)throw Error("Connection already closed");this.onClose()}async send(a){this.isAvailable||await this.register();try{let b,c,d=(0,g.h)(a),e=await (await f()(this.url,(b=p({},q),c={body:d},j(b,k(c))))).json();this.onPayload({data:e})}catch(b){this.onError(a.id,b)}}async register(a=this.url){if(!(0,h.isHttpUrl)(a))throw Error(`Provided URL is not compatible with HTTP connection: ${a}`);if(this.registering){let a=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=a||this.events.listenerCount("open")>=a)&&this.events.setMaxListeners(a+1),new Promise((a,b)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),b(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return b(Error("HTTP connection is missing or invalid"));a()})})}this.url=a,this.registering=!0;try{if(!this.disableProviderPing){let b,c,d=(0,g.h)({id:1,jsonrpc:"2.0",method:"test",params:[]});await f()(a,(b=p({},q),c={body:d},j(b,k(c))))}this.onOpen()}catch(b){let a=this.parseError(b);throw this.events.emit("register_error",a),this.onClose(),a}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(a){if(typeof a.data>"u")return;let b="string"==typeof a.data?(0,g.j)(a.data):a.data;this.events.emit("payload",b)}onError(a,b){let c=this.parseError(b),d=c.message||c.toString(),e=(0,h.formatJsonRpcError)(a,d);this.events.emit("payload",e)}parseError(a,b=this.url){return(0,h.parseConnectionError)(a,b,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}}},94466:(a,b)=>{"use strict";function c(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function d(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}Object.defineProperty(b,"__esModule",{value:!0}),b.isBrowser=b.isNode=b.isReactNative=void 0,b.isReactNative=c,b.isNode=d,b.isBrowser=function(){return!c()&&!d()}},96867:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});let d=c(4457);d.__exportStar(c(28032),b),d.__exportStar(c(93120),b)},97109:(a,b,c)=>{"use strict";c.d(b,{Uf:()=>g,XW:()=>h,fO:()=>e,jf:()=>f,zR:()=>d});let d="INTERNAL_ERROR",e="SERVER_ERROR",f=[-32700,-32600,-32601,-32602,-32603],g={PARSE_ERROR:{code:-32700,message:"Parse error"},INVALID_REQUEST:{code:-32600,message:"Invalid Request"},METHOD_NOT_FOUND:{code:-32601,message:"Method not found"},INVALID_PARAMS:{code:-32602,message:"Invalid params"},[d]:{code:-32603,message:"Internal error"},[e]:{code:-32e3,message:"Server error"}},h=e},97195:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ONE_THOUSAND=b.ONE_HUNDRED=void 0,b.ONE_HUNDRED=100,b.ONE_THOUSAND=1e3},99731:(a,b,c)=>{let d=c(60976);function e(a,b,c){let d=a[b]+a[c],e=a[b+1]+a[c+1];d>=0x100000000&&e++,a[b]=d,a[b+1]=e}function f(a,b,c,d){let e=a[b]+c;c<0&&(e+=0x100000000);let f=a[b+1]+d;e>=0x100000000&&f++,a[b]=e,a[b+1]=f}function g(a,b){return a[b]^a[b+1]<<8^a[b+2]<<16^a[b+3]<<24}function h(a,b,c,d,g,h){let i=l[g],j=l[g+1],m=l[h],n=l[h+1];e(k,a,b),f(k,a,i,j);let o=k[d]^k[a],p=k[d+1]^k[a+1];k[d]=p,k[d+1]=o,e(k,c,d),o=k[b]^k[c],p=k[b+1]^k[c+1],k[b]=o>>>24^p<<8,k[b+1]=p>>>24^o<<8,e(k,a,b),f(k,a,m,n),o=k[d]^k[a],p=k[d+1]^k[a+1],k[d]=o>>>16^p<<16,k[d+1]=p>>>16^o<<16,e(k,c,d),o=k[b]^k[c],p=k[b+1]^k[c+1],k[b]=p>>>31^o<<1,k[b+1]=o>>>31^p<<1}let i=new Uint32Array([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),j=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(a){return 2*a})),k=new Uint32Array(32),l=new Uint32Array(32);function m(a,b){let c=0;for(c=0;c<16;c++)k[c]=a.h[c],k[c+16]=i[c];for(k[24]=k[24]^a.t,k[25]=k[25]^a.t/0x100000000,b&&(k[28]=~k[28],k[29]=~k[29]),c=0;c<32;c++)l[c]=g(a.b,4*c);for(c=0;c<12;c++)h(0,8,16,24,j[16*c+0],j[16*c+1]),h(2,10,18,26,j[16*c+2],j[16*c+3]),h(4,12,20,28,j[16*c+4],j[16*c+5]),h(6,14,22,30,j[16*c+6],j[16*c+7]),h(0,10,20,30,j[16*c+8],j[16*c+9]),h(2,12,22,24,j[16*c+10],j[16*c+11]),h(4,14,16,26,j[16*c+12],j[16*c+13]),h(6,8,18,28,j[16*c+14],j[16*c+15]);for(c=0;c<16;c++)a.h[c]=a.h[c]^k[c]^k[c+16]}let n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function o(a,b,c,d){if(0===a||a>64)throw Error("Illegal output length, expected 0 < length <= 64");if(b&&b.length>64)throw Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(c&&16!==c.length)throw Error("Illegal salt, expected Uint8Array with length is 16");if(d&&16!==d.length)throw Error("Illegal personal, expected Uint8Array with length is 16");let e={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:a};n.fill(0),n[0]=a,b&&(n[1]=b.length),n[2]=1,n[3]=1,c&&n.set(c,32),d&&n.set(d,48);for(let a=0;a<16;a++)e.h[a]=i[a]^g(n,4*a);return b&&(p(e,b),e.c=128),e}function p(a,b){for(let c=0;c<b.length;c++)128===a.c&&(a.t+=a.c,m(a,!1),a.c=0),a.b[a.c++]=b[c]}function q(a){for(a.t+=a.c;a.c<128;)a.b[a.c++]=0;m(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c);return b}function r(a,b,c,e,f){c=c||64,a=d.normalizeInput(a),e&&(e=d.normalizeInput(e)),f&&(f=d.normalizeInput(f));let g=o(c,b,e,f);return p(g,a),q(g)}a.exports={blake2b:r,blake2bHex:function(a,b,c,e,f){let g=r(a,b,c,e,f);return d.toHex(g)},blake2bInit:o,blake2bUpdate:p,blake2bFinal:q}}};